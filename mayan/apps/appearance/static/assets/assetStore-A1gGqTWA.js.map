{"version":3,"file":"assetStore-A1gGqTWA.js","sources":["../../src/stores/assetStore.ts"],"sourcesContent":["import { defineStore } from 'pinia'\r\nimport { ref, computed } from 'vue'\r\nimport { assetService } from '@/services/assetService'\r\nimport type { Asset, GetAssetsParams, PaginatedResponse } from '@/types/api'\r\nimport { formatApiError } from '@/utils/errors'\r\nimport type { AxiosProgressEvent } from 'axios'\r\n\r\ninterface UploadOptions {\r\n  onUploadProgress?: (event: AxiosProgressEvent) => void\r\n  signal?: AbortSignal\r\n}\r\nexport const useAssetStore = defineStore(\r\n  'asset',\r\n  () => {\r\n    // State\r\n    const assets = ref<Asset[]>([])\r\n    const totalCount = ref(0)\r\n    const currentPage = ref(1)\r\n    const pageSize = ref(50)\r\n    const isLoading = ref(false)\r\n    const error = ref<string | null>(null)\r\n    const selectedAssets = ref<Asset[]>([])\r\n    const currentAsset = ref<Asset | null>(null)\r\n    const sortBy = ref<string>('-date_added')\r\n    const filters = ref<GetAssetsParams>({})\r\n\r\n    // Getters\r\n    const hasNextPage = computed(() => {\r\n      const totalPages = Math.ceil(totalCount.value / pageSize.value)\r\n      return currentPage.value < totalPages\r\n    })\r\n\r\n    const hasPreviousPage = computed(() => {\r\n      return currentPage.value > 1\r\n    })\r\n\r\n    const totalPages = computed(() => {\r\n      return Math.ceil(totalCount.value / pageSize.value)\r\n    })\r\n\r\n    const selectedCount = computed(() => selectedAssets.value.length)\r\n\r\n    const currentPageAssets = computed(() => assets.value)\r\n\r\n    // Actions\r\n    async function fetchAssets(params?: GetAssetsParams) {\r\n      isLoading.value = true\r\n      error.value = null\r\n\r\n      try {\r\n        const queryParams: GetAssetsParams = {\r\n          page: currentPage.value,\r\n          page_size: pageSize.value,\r\n          sort: sortBy.value,\r\n          ...filters.value,\r\n          ...params\r\n        }\r\n\r\n        const response: PaginatedResponse<Asset> = await assetService.getAssets(\r\n          queryParams\r\n        )\r\n\r\n        assets.value = response.results\r\n        totalCount.value = response.count\r\n\r\n        // Update current page if provided\r\n        if (params?.page) {\r\n          currentPage.value = params.page\r\n        }\r\n      } catch (err) {\r\n        error.value = formatApiError(err)\r\n        assets.value = []\r\n        totalCount.value = 0\r\n        throw err\r\n      } finally {\r\n        isLoading.value = false\r\n      }\r\n    }\r\n\r\n    async function getAssetDetail(id: number) {\r\n      isLoading.value = true\r\n      error.value = null\r\n\r\n      try {\r\n        const asset = await assetService.getAsset(id)\r\n        currentAsset.value = asset\r\n        return asset\r\n      } catch (err) {\r\n        error.value = formatApiError(err)\r\n        currentAsset.value = null\r\n        throw err\r\n      } finally {\r\n        isLoading.value = false\r\n      }\r\n    }\r\n\r\n    function nextPage() {\r\n      if (hasNextPage.value) {\r\n        currentPage.value++\r\n        fetchAssets()\r\n      }\r\n    }\r\n\r\n    function previousPage() {\r\n      if (hasPreviousPage.value) {\r\n        currentPage.value--\r\n        fetchAssets()\r\n      }\r\n    }\r\n\r\n    function setPage(page: number) {\r\n      if (page >= 1 && page <= totalPages.value) {\r\n        currentPage.value = page\r\n        fetchAssets()\r\n      }\r\n    }\r\n\r\n    function setPageSize(size: number) {\r\n      pageSize.value = Math.min(Math.max(size, 1), 100) // Clamp between 1 and 100\r\n      currentPage.value = 1 // Reset to first page\r\n      fetchAssets()\r\n    }\r\n\r\n    function selectAsset(asset: Asset, multiSelect = false) {\r\n      const index = selectedAssets.value.findIndex((a) => a.id === asset.id)\r\n\r\n      if (index === -1) {\r\n        if (multiSelect) {\r\n          selectedAssets.value.push(asset)\r\n        } else {\r\n          selectedAssets.value = [asset]\r\n        }\r\n      } else {\r\n        selectedAssets.value.splice(index, 1)\r\n      }\r\n    }\r\n\r\n    function selectAll() {\r\n      selectedAssets.value = [...assets.value]\r\n    }\r\n\r\n    function clearSelection() {\r\n      selectedAssets.value = []\r\n    }\r\n\r\n    function setSortBy(sort: string) {\r\n      sortBy.value = sort\r\n      currentPage.value = 1\r\n      fetchAssets()\r\n    }\r\n\r\n    function applyFilters(newFilters: GetAssetsParams) {\r\n      filters.value = { ...filters.value, ...newFilters }\r\n      currentPage.value = 1\r\n      fetchAssets()\r\n    }\r\n\r\n    function clearFilters() {\r\n      filters.value = {}\r\n      currentPage.value = 1\r\n      fetchAssets()\r\n    }\r\n\r\n    function refresh() {\r\n      fetchAssets()\r\n    }\r\n\r\n    // Initialize - fetch first page on store creation (optional)\r\n    // fetchAssets() // Uncomment if you want auto-fetch on store init\r\n\r\n    async function uploadAsset(\r\n      formData: FormData,\r\n      options?: UploadOptions\r\n    ): Promise<Asset> {\r\n      return assetService.uploadAsset(formData, {\r\n        onUploadProgress: options?.onUploadProgress,\r\n        signal: options?.signal\r\n      })\r\n    }\r\n\r\n    return {\r\n      // State\r\n      assets,\r\n      totalCount,\r\n      currentPage,\r\n      pageSize,\r\n      isLoading,\r\n      error,\r\n      selectedAssets,\r\n      currentAsset,\r\n      sortBy,\r\n      filters,\r\n\r\n      // Getters\r\n      hasNextPage,\r\n      hasPreviousPage,\r\n      totalPages,\r\n      selectedCount,\r\n      currentPageAssets,\r\n\r\n      // Actions\r\n      fetchAssets,\r\n      getAssetDetail,\r\n      nextPage,\r\n      previousPage,\r\n      setPage,\r\n      setPageSize,\r\n      selectAsset,\r\n      selectAll,\r\n      clearSelection,\r\n      setSortBy,\r\n      applyFilters,\r\n      clearFilters,\r\n      refresh,\r\n      uploadAsset\r\n    }\r\n  },\r\n  {\r\n    persist: {\r\n      paths: ['pageSize', 'sortBy', 'filters'] // Persist user preferences\r\n    }\r\n  }\r\n)\r\n\r\n"],"names":["useAssetStore","defineStore","assets","ref","totalCount","currentPage","pageSize","isLoading","error","selectedAssets","currentAsset","sortBy","filters","hasNextPage","computed","totalPages","Math","ceil","value","hasPreviousPage","selectedCount","length","currentPageAssets","fetchAssets","params","__async","this","queryParams","__spreadValues","page","page_size","sort","response","assetService","getAssets","results","count","err","formatApiError","getAssetDetail","id","asset","getAsset","nextPage","previousPage","setPage","setPageSize","size","min","max","selectAsset","multiSelect","index","findIndex","a","push","splice","selectAll","clearSelection","setSortBy","applyFilters","newFilters","clearFilters","refresh","uploadAsset","formData","options","onUploadProgress","signal","persist","paths"],"mappings":"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"}
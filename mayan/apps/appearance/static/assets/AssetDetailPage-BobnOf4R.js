var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,r=(t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,i=(e,t,s)=>r(e,"symbol"!=typeof t?t+"":t,s),o=(e,t,s)=>new Promise((a,n)=>{var l=e=>{try{i(s.next(e))}catch(t){n(t)}},r=e=>{try{i(s.throw(e))}catch(t){n(t)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(l,r);i((s=s.apply(e,t)).next())});import{b as u,r as d,c,z as m,e as v,j as p,i as x,t as h,f,u as k,F as y,h as b,m as g,v as w,p as _,q as C,l as A,s as j,A as I,C as M,k as S,a as z,w as $,n as D,G as O,B,x as P}from"./vue-vendor-B11yH1L4.js";import{u as V}from"./assetStore-A1gGqTWA.js";import{a as H,c as E,e as R,d as U,u as N,h as L,b as W,j as T,t as K}from"./index-CEUju959.js";import{_ as q}from"./Badge.vue_vue_type_script_setup_true_lang-Bp_czRtF.js";import"./utils-vendor-BYNnTNyD.js";const F=new class{getComments(e){return o(this,null,function*(){return(yield H.get(`/v4/dam/assets/${e}/comments/`)).results||[]})}createComment(e,t){return o(this,null,function*(){return H.post(`/v4/dam/assets/${e}/comments/`,t)})}updateComment(e,t,s){return o(this,null,function*(){return H.put(`/v4/dam/assets/${e}/comments/${t}/`,s)})}deleteComment(e,t){return o(this,null,function*(){return H.delete(`/v4/dam/assets/${e}/comments/${t}/`)})}createReply(e,i,u){return o(this,null,function*(){return H.post(`/v4/dam/assets/${e}/comments/`,(o=((e,t)=>{for(var s in t||(t={}))n.call(t,s)&&r(e,s,t[s]);if(a)for(var s of a(t))l.call(t,s)&&r(e,s,t[s]);return e})({},u),t(o,s({parent_id:i}))));var o})}};const J=new class{constructor(){i(this,"ws",null),i(this,"reconnectAttempts",0),i(this,"maxReconnectAttempts",5),i(this,"reconnectDelay",1e3),i(this,"eventHandlers",new Map),i(this,"isConnecting",!1)}connect(){var e;if((null==(e=this.ws)?void 0:e.readyState)!==WebSocket.OPEN&&!this.isConnecting){this.isConnecting=!0;try{const e="ws://localhost:8000/ws";this.ws=new WebSocket(e),this.ws.onopen=()=>{this.isConnecting=!1,this.reconnectAttempts=0,this.emit("connected",{})},this.ws.onmessage=e=>{try{const t=JSON.parse(e.data);this.handleMessage(t)}catch(t){}},this.ws.onerror=e=>{this.isConnecting=!1},this.ws.onclose=()=>{this.isConnecting=!1,this.ws=null,this.emit("disconnected",{}),this.reconnectAttempts<this.maxReconnectAttempts&&(this.reconnectAttempts++,setTimeout(()=>{this.connect()},this.reconnectDelay*this.reconnectAttempts))}}catch(t){this.isConnecting=!1}}}disconnect(){this.ws&&(this.ws.close(),this.ws=null),this.reconnectAttempts=this.maxReconnectAttempts}on(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new Set),this.eventHandlers.get(e).add(t),()=>{this.off(e,t)}}off(e,t){const s=this.eventHandlers.get(e);s&&s.delete(t)}subscribeToAsset(e){var t;(null==(t=this.ws)?void 0:t.readyState)===WebSocket.OPEN&&this.ws.send(JSON.stringify({type:"subscribe",channel:`asset:${e}`}))}unsubscribeFromAsset(e){var t;(null==(t=this.ws)?void 0:t.readyState)===WebSocket.OPEN&&this.ws.send(JSON.stringify({type:"unsubscribe",channel:`asset:${e}`}))}handleMessage(e){const{type:t,data:s}=e,a=this.eventHandlers.get(t);a&&a.forEach(e=>{try{e(s)}catch(t){}})}emit(e,t){"connected"!==e&&"disconnected"!==e&&this.handleMessage({type:e,data:t})}get isConnected(){var e;return(null==(e=this.ws)?void 0:e.readyState)===WebSocket.OPEN||!1}simulateEvent(e,t){this.handleMessage({type:e,data:t})}},G={class:"comment-item"},Q={class:"flex gap-3"},X={class:"flex-shrink-0"},Y={key:0,class:"w-10 h-10 rounded-full bg-neutral-200 dark:bg-neutral-200 overflow-hidden"},Z=["src","alt"],ee={key:1,class:"w-10 h-10 rounded-full bg-primary-500 flex items-center justify-center text-white font-semibold"},te={class:"flex-1"},se={class:"bg-neutral-50 dark:bg-neutral-50 rounded-lg p-3"},ae={class:"flex items-center justify-between mb-2"},ne={class:"flex items-center gap-2"},le={class:"font-semibold text-sm text-neutral-900 dark:text-neutral-900"},re={class:"text-xs text-neutral-600 dark:text-neutral-600"},ie={key:0,class:"text-xs text-neutral-500 dark:text-neutral-500 italic"},oe={key:0,class:"flex items-center gap-1"},ue={key:0,class:"text-sm text-neutral-900 dark:text-neutral-900 whitespace-pre-wrap"},de={key:0,class:"text-primary-500 font-medium"},ce={key:1},me={key:1,class:"space-y-2"},ve=["onKeydown"],pe={class:"flex justify-end gap-2"},xe={key:2,class:"mt-2 flex items-center gap-4"},he={key:0,class:"mt-3 ml-4 space-y-3 border-l-2 border-neutral-200 dark:border-neutral-200 pl-4"},fe=U(u({__name:"CommentItem",props:{comment:{},currentUserId:{}},emits:["reply","edit","delete"],setup(e,{emit:t}){const s=e,a=t,n=d(!1),l=d(""),r=c(()=>s.currentUserId&&s.comment.author_id===s.currentUserId),i=c(()=>{const e=s.comment.text,t=[],a=/@(\w+)/g;let n,l=0;for(;null!==(n=a.exec(e));)n.index>l&&t.push({type:"text",text:e.substring(l,n.index)}),t.push({type:"mention",text:n[1]}),l=n.index+n[0].length;return l<e.length&&t.push({type:"text",text:e.substring(l)}),t.length>0?t:[{type:"text",text:e}]});function o(){l.value=s.comment.text,n.value=!0}function u(){n.value=!1,l.value=""}function S(){l.value.trim()&&l.value!==s.comment.text&&a("edit",s.comment,l.value.trim()),n.value=!1}function z(){a("reply",s.comment)}function $(){confirm("Вы уверены, что хотите удалить этот комментарий?")&&a("delete",s.comment)}return(t,s)=>{const a=m("CommentItem",!0);return p(),v("div",G,[x("div",Q,[x("div",X,[e.comment.author_avatar?(p(),v("div",Y,[x("img",{src:e.comment.author_avatar,alt:e.comment.author,class:"w-full h-full object-cover"},null,8,Z)])):(p(),v("div",ee,h(e.comment.author.charAt(0).toUpperCase()),1))]),x("div",te,[x("div",se,[x("div",ae,[x("div",ne,[x("span",le,h(e.comment.author),1),x("span",re,h(k(E)(e.comment.created_date)),1),e.comment.edited?(p(),v("span",ie," (отредактировано) ")):f("",!0)]),r.value?(p(),v("div",oe,[n.value?f("",!0):(p(),v("button",{key:0,class:"text-xs text-neutral-600 dark:text-neutral-600 hover:text-primary-500",onClick:o}," Редактировать ")),x("button",{class:"text-xs text-neutral-600 dark:text-neutral-600 hover:text-error",onClick:$}," Удалить ")])):f("",!0)]),n.value?(p(),v("div",me,[g(x("textarea",{"onUpdate:modelValue":s[0]||(s[0]=e=>l.value=e),class:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-300 rounded-md resize-none focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-0 dark:text-neutral-900",rows:"3",onKeydown:[_(u,["esc"]),_(C(S,["ctrl"]),["enter"]),_(C(S,["meta"]),["enter"])]},null,40,ve),[[w,l.value]]),x("div",pe,[A(R,{variant:"outline",size:"sm",onClick:u},{default:j(()=>[...s[4]||(s[4]=[I(" Отмена ",-1)])]),_:1}),A(R,{variant:"primary",size:"sm",onClick:S},{default:j(()=>[...s[5]||(s[5]=[I(" Сохранить ",-1)])]),_:1})])])):(p(),v("div",ue,[(p(!0),v(y,null,b(i.value,(e,t)=>(p(),v("span",{key:t},["mention"===e.type?(p(),v("span",de," @"+h(e.text),1)):(p(),v("span",ce,h(e.text),1))]))),128))])),n.value?f("",!0):(p(),v("div",xe,[x("button",{class:"text-xs text-neutral-600 dark:text-neutral-600 hover:text-primary-500",onClick:z}," Ответить ")]))]),e.comment.replies&&e.comment.replies.length>0?(p(),v("div",he,[(p(!0),v(y,null,b(e.comment.replies,n=>(p(),M(a,{key:n.id,comment:n,"current-user-id":e.currentUserId,onReply:s[1]||(s[1]=e=>t.$emit("reply",e)),onEdit:s[2]||(s[2]=e=>t.$emit("edit",e,e)),onDelete:s[3]||(s[3]=e=>t.$emit("delete",e))},null,8,["comment","current-user-id"]))),128))])):f("",!0)])])])}}}),[["__scopeId","data-v-e51a1306"]]),ke={class:"comments-thread"},ye={class:"flex items-center justify-between mb-4"},be={class:"text-lg font-semibold text-neutral-900 dark:text-neutral-900"},ge={class:"mb-6"},we={class:"flex gap-3"},_e={class:"flex-1"},Ce=["placeholder","onKeydown"],Ae={key:0,class:"mt-2 flex items-center gap-2 text-sm text-neutral-600 dark:text-neutral-600"},je={key:1,class:"mt-2"},Ie={class:"bg-white dark:bg-neutral-0 border border-neutral-300 dark:border-neutral-300 rounded-md shadow-lg max-h-40 overflow-y-auto"},Me=["onClick"],Se={class:"mt-2 flex justify-end gap-2"},ze={key:0,class:"space-y-4"},$e={key:1,class:"text-center py-8 text-neutral-600 dark:text-neutral-600"},De={key:2,class:"text-center py-4"},Oe=U(u({__name:"CommentsThread",props:{assetId:{},initialComments:{}},emits:["comment-added","comment-updated","comment-deleted"],setup(e,{emit:t}){const s=e,a=t,n=N(),l=d(s.initialComments||[]),r=d(""),i=d(null),u=d(!1),m=d(!1),k=d([]),D=d(""),O=d(["admin","user1","user2","designer","manager"]),B=c(()=>{var e;return null==(e=n.user)?void 0:e.id}),P=c(()=>l.value.filter(e=>!e.parent_id)),V=c(()=>{const e=t=>{var s;return 1+((null==(s=t.replies)?void 0:s.reduce((t,s)=>t+e(s),0))||0)};return P.value.reduce((t,s)=>t+e(s),0)});function H(e){const t=e.target,s=t.value,a=t.selectionStart,n=s.substring(0,a).match(/@(\w*)$/);if(n){D.value=n[1];const e=D.value.toLowerCase();k.value=O.value.filter(t=>t.toLowerCase().startsWith(e)&&t.toLowerCase()!==e)}else k.value=[]}function E(){return o(this,null,function*(){var e;if(r.value.trim()&&!u.value){u.value=!0;try{const t=function(e){const t=/@(\w+)/g,s=[];let a;for(;null!==(a=t.exec(e));)s.push(a[1]);return[...new Set(s)]}(r.value),n={text:r.value.trim(),mentions:t,parent_id:null==(e=i.value)?void 0:e.id},o=yield F.createComment(s.assetId,n);if(i.value){const e=U(l.value,i.value.id);e&&(e.replies||(e.replies=[]),e.replies.push(o)),i.value=null}else l.value.push(o);r.value="",a("comment-added",o)}catch(t){}finally{u.value=!1}}})}function U(e,t){for(const s of e){if(s.id===t)return s;if(s.replies){const e=U(s.replies,t);if(e)return e}}return null}function L(e){i.value=e,setTimeout(()=>{const e=document.querySelector("textarea");null==e||e.focus()},100)}function W(){i.value=null}function T(e,t){return o(this,null,function*(){try{const n=yield F.updateComment(s.assetId,e.id,{text:t}),r=U(l.value,e.id);r&&(r.text=n.text,r.updated_date=n.updated_date,r.edited=!0),a("comment-updated",n)}catch(n){}})}function K(e){return o(this,null,function*(){if(confirm("Вы уверены, что хотите удалить этот комментарий?"))try{if(yield F.deleteComment(s.assetId,e.id),e.parent_id){const t=U(l.value,e.parent_id);if(null==t?void 0:t.replies){const s=t.replies.findIndex(t=>t.id===e.id);-1!==s&&t.replies.splice(s,1)}}else{const t=l.value.findIndex(t=>t.id===e.id);-1!==t&&l.value.splice(t,1)}a("comment-deleted",e.id)}catch(t){}})}return S(()=>o(this,null,function*(){s.initialComments||(yield function(){return o(this,null,function*(){m.value=!0;try{l.value=yield F.getComments(s.assetId)}catch(e){}finally{m.value=!1}})}()),J.subscribeToAsset(s.assetId);const e=J.on("comment_added",e=>{if(e.asset_id===s.assetId){const t=e.comment;if(t.parent_id){const e=U(l.value,t.parent_id);e&&(e.replies||(e.replies=[]),e.replies.push(t))}else l.value.push(t)}}),t=J.on("comment_updated",e=>{if(e.asset_id===s.assetId){const t=e.comment,s=U(l.value,t.id);s&&(s.text=t.text,s.updated_date=t.updated_date,s.edited=!0)}}),a=J.on("comment_deleted",e=>{if(e.asset_id===s.assetId){const t=e.comment_id;if(e.parent_id){const s=U(l.value,e.parent_id);if(null==s?void 0:s.replies){const e=s.replies.findIndex(e=>e.id===t);-1!==e&&s.replies.splice(e,1)}}else{const e=l.value.findIndex(e=>e.id===t);-1!==e&&l.value.splice(e,1)}}});window.__commentUnsubscribers=[e,t,a]})),z(()=>{J.unsubscribeFromAsset(s.assetId);const e=window.__commentUnsubscribers;e&&(e.forEach(e=>e()),delete window.__commentUnsubscribers)}),$(()=>s.initialComments,e=>{e&&(l.value=e)}),(e,t)=>(p(),v("div",ke,[x("div",ye,[x("h3",be," Комментарии ("+h(V.value)+") ",1)]),x("div",ge,[x("div",we,[x("div",_e,[g(x("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e),placeholder:i.value?`Ответить ${i.value.author}...`:"Добавить комментарий...",class:"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-300 rounded-md resize-none focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-neutral-0 dark:text-neutral-900",rows:"3",onKeydown:[_(C(E,["ctrl"]),["enter"]),_(C(E,["meta"]),["enter"])],onInput:H},null,40,Ce),[[w,r.value]]),i.value?(p(),v("div",Ae,[x("span",null,"Ответ на комментарий от "+h(i.value.author),1),x("button",{class:"text-primary-500 hover:text-primary-600",onClick:W}," Отмена ")])):f("",!0),k.value.length>0?(p(),v("div",je,[x("div",Ie,[(p(!0),v(y,null,b(k.value,e=>(p(),v("button",{key:e,class:"w-full text-left px-4 py-2 hover:bg-neutral-100 dark:hover:bg-neutral-100 text-sm",onClick:t=>function(e){const t=document.querySelector("textarea");if(!t)return;const s=r.value,a=t.selectionStart,n=s.substring(0,a).match(/@(\w*)$/);if(n){const l=a-n[0].length;r.value=s.substring(0,l)+`@${e} `+s.substring(a),k.value=[],D.value="",setTimeout(()=>{t.focus();const s=l+`@${e} `.length;t.setSelectionRange(s,s)},0)}}(e)}," @"+h(e),9,Me))),128))])])):f("",!0)])]),x("div",Se,[i.value?(p(),M(R,{key:0,variant:"outline",size:"sm",onClick:W},{default:j(()=>[...t[1]||(t[1]=[I(" Отмена ",-1)])]),_:1})):f("",!0),A(R,{variant:"primary",size:"sm",disabled:!r.value.trim()||u.value,loading:u.value,onClick:E},{default:j(()=>[I(h(i.value?"Ответить":"Отправить"),1)]),_:1},8,["disabled","loading"])])]),l.value.length>0?(p(),v("div",ze,[(p(!0),v(y,null,b(P.value,e=>(p(),M(fe,{key:e.id,comment:e,"current-user-id":B.value,onReply:L,onEdit:T,onDelete:K},null,8,["comment","current-user-id"]))),128))])):(p(),v("div",$e,[...t[2]||(t[2]=[x("svg",{class:"mx-auto h-12 w-12 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[x("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1),x("p",null,"Пока нет комментариев. Будьте первым!",-1)])])),m.value?(p(),v("div",De,[...t[3]||(t[3]=[x("div",{class:"animate-spin h-6 w-6 mx-auto text-primary-500"},null,-1)])])):f("",!0)]))}}),[["__scopeId","data-v-d8e135b4"]]),Be={class:"version-history"},Pe={class:"flex items-center justify-between mb-4"},Ve={class:"text-lg font-semibold text-neutral-900 dark:text-neutral-900"},He={key:0,class:"space-y-2"},Ee={class:"flex items-start justify-between"},Re={class:"flex-1"},Ue={class:"flex items-center gap-2 mb-2"},Ne={class:"font-medium text-neutral-900 dark:text-neutral-900"},Le={class:"text-sm text-neutral-600 dark:text-neutral-600 space-y-1"},We={class:"flex items-center gap-4"},Te={key:0},Ke={class:"flex items-center gap-2 ml-4"},qe={key:1,class:"text-center py-8 text-neutral-600 dark:text-neutral-600"},Fe={key:2,class:"text-center py-4"},Je=U(u({__name:"VersionHistory",props:{assetId:{},initialVersions:{},canRestore:{type:Boolean,default:!0}},emits:["version-download","version-restore"],setup(e,{emit:t}){const s=e,a=t;N();const n=d(s.initialVersions||[]),l=d(!1);function r(){return o(this,null,function*(){l.value=!0;try{const e=yield L.getAsset(s.assetId);e.version_history&&(n.value=e.version_history)}catch(e){}finally{l.value=!1}})}return S(()=>o(this,null,function*(){s.initialVersions||(yield r())})),$(()=>s.initialVersions,e=>{e&&(n.value=e)}),(t,i)=>(p(),v("div",Be,[x("div",Pe,[x("h3",Ve," История версий ("+h(n.value.length)+") ",1)]),n.value.length>0?(p(),v("div",He,[(p(!0),v(y,null,b(n.value,(t,n)=>(p(),v("div",{key:t.id,class:D(["p-4 rounded-lg border transition-colors",t.is_current?"bg-primary-50 dark:bg-primary-50 border-primary-300 dark:border-primary-300":"bg-neutral-50 dark:bg-neutral-50 border-neutral-300 dark:border-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-100"])},[x("div",Ee,[x("div",Re,[x("div",Ue,[x("span",Ne,h(t.filename),1),t.is_current?(p(),M(q,{key:0,variant:"success",size:"sm"},{default:j(()=>[...i[0]||(i[0]=[I(" Текущая версия ",-1)])]),_:1})):0===n?(p(),M(q,{key:1,variant:"info",size:"sm"},{default:j(()=>[...i[1]||(i[1]=[I(" Последняя ",-1)])]),_:1})):f("",!0)]),x("div",Le,[x("div",We,[x("span",null,h(k(W)(t.uploaded_date)),1),t.uploaded_by?(p(),v("span",Te,"• "+h(t.uploaded_by),1)):f("",!0),x("span",null,"• "+h(k(T)(t.size)),1)])])]),x("div",Ke,[A(R,{variant:"outline",size:"sm",onClick:e=>function(e){if(e.download_url)window.open(e.download_url,"_blank");else{const t=`/api/v4/dam/assets/${s.assetId}/versions/${e.id}/download/`;window.open(t,"_blank")}a("version-download",e)}(t)},{default:j(()=>[...i[2]||(i[2]=[x("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[x("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),I(" Скачать ",-1)])]),_:1},8,["onClick"]),!t.is_current&&e.canRestore?(p(),M(R,{key:0,variant:"primary",size:"sm",onClick:e=>function(e){return o(this,null,function*(){if(confirm(`Вы уверены, что хотите восстановить версию "${e.filename}"?`))try{e.restore_url?yield fetch(e.restore_url,{method:"POST"}):yield L.updateAsset(s.assetId,{version_id:e.id}),yield r(),a("version-restore",e)}catch(t){}})}(t)},{default:j(()=>[...i[3]||(i[3]=[x("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[x("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),I(" Восстановить ",-1)])]),_:1},8,["onClick"])):f("",!0)])])],2))),128))])):(p(),v("div",qe,[...i[4]||(i[4]=[x("svg",{class:"mx-auto h-12 w-12 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[x("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),x("p",null,"История версий пуста",-1)])])),l.value?(p(),v("div",Fe,[...i[5]||(i[5]=[x("div",{class:"animate-spin h-6 w-6 mx-auto text-primary-500"},null,-1)])])):f("",!0)]))}}),[["__scopeId","data-v-0e51fb74"]]),Ge={class:"metadata-panel"},Qe={class:"mb-6"},Xe={class:"space-y-2 text-sm"},Ye={class:"flex justify-between"},Ze={class:"text-neutral-900 dark:text-neutral-900 font-medium"},et={key:0,class:"flex justify-between"},tt={class:"text-neutral-900 dark:text-neutral-900"},st={class:"flex justify-between"},at={class:"text-neutral-900 dark:text-neutral-900"},nt={class:"flex justify-between"},lt={class:"text-neutral-900 dark:text-neutral-900"},rt={class:"flex justify-between"},it={class:"text-neutral-900 dark:text-neutral-900"},ot={key:1,class:"flex justify-between"},ut={class:"text-neutral-900 dark:text-neutral-900 font-mono text-xs"},dt={key:0,class:"mb-6"},ct={class:"space-y-2 text-sm"},mt={key:0,class:"flex justify-between"},vt={class:"text-neutral-900 dark:text-neutral-900"},pt={key:1,class:"flex justify-between"},xt={class:"text-neutral-900 dark:text-neutral-900"},ht={key:2,class:"flex justify-between"},ft={class:"text-neutral-900 dark:text-neutral-900"},kt={key:3,class:"flex justify-between"},yt={class:"text-neutral-900 dark:text-neutral-900"},bt={key:4,class:"flex justify-between"},gt={class:"text-neutral-900 dark:text-neutral-900"},wt={key:1,class:"mb-6"},_t={key:0,class:"space-y-3"},Ct={key:0},At={class:"flex flex-wrap gap-2"},jt={key:1},It={class:"text-sm text-neutral-900 dark:text-neutral-900"},Mt={key:2},St={class:"flex gap-2"},zt=["title"],$t={key:3},Dt={class:"space-y-1"},Ot={class:"text-neutral-900 dark:text-neutral-900"},Bt={class:"text-neutral-600 dark:text-neutral-600"},Pt={key:1,class:"text-sm text-neutral-600 dark:text-neutral-600"},Vt={key:2,class:"text-sm text-neutral-600 dark:text-neutral-600"},Ht={class:"mb-6"},Et={class:"mb-6"},Rt={class:"border-t border-neutral-300 dark:border-neutral-300 pt-4"},Ut={class:"flex flex-col gap-2"},Nt=U(u({__name:"MetadataPanel",props:{asset:{}},emits:["download","share","version-select","comment-added","comment-updated","comment-deleted","version-download","version-restore"],setup(e,{emit:t}){const s=e,a=t;function n(e){a("comment-added",e)}function l(e){a("comment-updated",e)}function r(e){a("comment-deleted",e)}function i(e){a("version-download",e)}function o(e){a("version-restore",e),a("version-select",e.id)}const u=c(()=>s.asset&&"file_details"in s.asset?s.asset.file_details:null),d=c(()=>s.asset&&"ai_analysis"in s.asset&&s.asset.ai_analysis?s.asset.ai_analysis:null),m=c(()=>s.asset&&"comments"in s.asset&&s.asset.comments?s.asset.comments:[]),g=c(()=>s.asset&&"version_history"in s.asset&&s.asset.version_history?s.asset.version_history:[]),w=c(()=>{var e,t;return(null==(t=null==(e=s.asset)?void 0:e.mime_type)?void 0:t.startsWith("image/"))||!1}),_=c(()=>{if(!w.value||!s.asset)return null;const e=s.asset.metadata||{},t=u.value;let a=null;return e.dimensions?a=e.dimensions:e.width&&e.height?a={width:e.width,height:e.height}:t&&"width"in t&&"height"in t&&(a={width:t.width,height:t.height}),{dimensions:a,dpi:e.dpi||e.resolution||null,color_space:e.color_space||e.colorProfile||null,camera:e.camera||e.make||null,exposure:e.exposure||e.exposureTime||null}});return(t,s)=>{var a,c,C,S,z;return p(),v("div",Ge,[x("section",Qe,[s[8]||(s[8]=x("h3",{class:"text-sm font-semibold text-neutral-900 dark:text-neutral-900 mb-3"}," Информация о файле ",-1)),x("div",Xe,[x("div",Ye,[s[2]||(s[2]=x("span",{class:"text-neutral-600 dark:text-neutral-600"},"Название:",-1)),x("span",Ze,h((null==(a=e.asset)?void 0:a.label)||"N/A"),1)]),u.value?(p(),v("div",et,[s[3]||(s[3]=x("span",{class:"text-neutral-600 dark:text-neutral-600"},"Имя файла:",-1)),x("span",tt,h(u.value.filename),1)])):f("",!0),x("div",st,[s[4]||(s[4]=x("span",{class:"text-neutral-600 dark:text-neutral-600"},"Размер:",-1)),x("span",at,h(e.asset?k(T)(e.asset.size):"N/A"),1)]),x("div",nt,[s[5]||(s[5]=x("span",{class:"text-neutral-600 dark:text-neutral-600"},"Тип:",-1)),x("span",lt,h((null==(c=e.asset)?void 0:c.mime_type)||"N/A"),1)]),x("div",rt,[s[6]||(s[6]=x("span",{class:"text-neutral-600 dark:text-neutral-600"},"Добавлено:",-1)),x("span",it,h(e.asset?k(W)(e.asset.date_added):"N/A"),1)]),(null==(C=u.value)?void 0:C.checksum)?(p(),v("div",ot,[s[7]||(s[7]=x("span",{class:"text-neutral-600 dark:text-neutral-600"},"Checksum:",-1)),x("span",ut,h(k(K)(u.value.checksum,16)),1)])):f("",!0)])]),w.value&&_.value?(p(),v("section",dt,[s[14]||(s[14]=x("h3",{class:"text-sm font-semibold text-neutral-900 dark:text-neutral-900 mb-3"}," Информация об изображении ",-1)),x("div",ct,[_.value.dimensions?(p(),v("div",mt,[s[9]||(s[9]=x("span",{class:"text-neutral-600 dark:text-neutral-600"},"Размеры:",-1)),x("span",vt,h(_.value.dimensions.width)+" × "+h(_.value.dimensions.height)+" px ",1)])):f("",!0),_.value.dpi?(p(),v("div",pt,[s[10]||(s[10]=x("span",{class:"text-neutral-600 dark:text-neutral-600"},"DPI:",-1)),x("span",xt,h(_.value.dpi),1)])):f("",!0),_.value.color_space?(p(),v("div",ht,[s[11]||(s[11]=x("span",{class:"text-neutral-600 dark:text-neutral-600"},"Цветовое пространство:",-1)),x("span",ft,h(_.value.color_space),1)])):f("",!0),_.value.camera?(p(),v("div",kt,[s[12]||(s[12]=x("span",{class:"text-neutral-600 dark:text-neutral-600"},"Камера:",-1)),x("span",yt,h(_.value.camera),1)])):f("",!0),_.value.exposure?(p(),v("div",bt,[s[13]||(s[13]=x("span",{class:"text-neutral-600 dark:text-neutral-600"},"Экспозиция:",-1)),x("span",gt,h(_.value.exposure),1)])):f("",!0)])])):f("",!0),d.value?(p(),v("section",wt,[s[20]||(s[20]=x("h3",{class:"text-sm font-semibold text-neutral-900 dark:text-neutral-900 mb-3"}," AI Анализ ",-1)),"completed"===d.value.status?(p(),v("div",_t,[d.value.tags&&d.value.tags.length>0?(p(),v("div",Ct,[s[15]||(s[15]=x("div",{class:"text-xs font-medium text-neutral-600 dark:text-neutral-600 mb-2"}," Теги: ",-1)),x("div",At,[(p(!0),v(y,null,b(d.value.tags,e=>(p(),M(q,{key:e,variant:"info",size:"sm"},{default:j(()=>[I(h(e),1)]),_:2},1024))),128))])])):f("",!0),d.value.ai_description?(p(),v("div",jt,[s[16]||(s[16]=x("div",{class:"text-xs font-medium text-neutral-600 dark:text-neutral-600 mb-2"}," Описание: ",-1)),x("p",It,h(d.value.ai_description),1)])):f("",!0),d.value.colors&&d.value.colors.length>0?(p(),v("div",Mt,[s[17]||(s[17]=x("div",{class:"text-xs font-medium text-neutral-600 dark:text-neutral-600 mb-2"}," Доминирующие цвета: ",-1)),x("div",St,[(p(!0),v(y,null,b(d.value.colors,(e,t)=>(p(),v("div",{key:t,class:"w-8 h-8 rounded border border-neutral-300 dark:border-neutral-300",style:O({backgroundColor:e}),title:e},null,12,zt))),128))])])):f("",!0),d.value.objects_detected&&d.value.objects_detected.length>0?(p(),v("div",$t,[s[18]||(s[18]=x("div",{class:"text-xs font-medium text-neutral-600 dark:text-neutral-600 mb-2"}," Обнаруженные объекты: ",-1)),x("div",Dt,[(p(!0),v(y,null,b(d.value.objects_detected,(e,t)=>(p(),v("div",{key:t,class:"flex items-center justify-between text-sm"},[x("span",Ot,h(e.name),1),x("span",Bt,h(Math.round(100*e.confidence))+"% ",1)]))),128))])])):f("",!0)])):"processing"===d.value.status?(p(),v("div",Pt,[...s[19]||(s[19]=[x("div",{class:"flex items-center gap-2"},[x("div",{class:"animate-spin h-4 w-4 border-2 border-primary-500 border-t-transparent rounded-full"}),x("span",null,"Анализ выполняется...")],-1)])])):(p(),v("div",Vt," AI анализ недоступен "))])):f("",!0),x("section",Ht,[(null==(S=e.asset)?void 0:S.id)?(p(),M(Je,{key:0,"asset-id":e.asset.id,"initial-versions":g.value,onVersionDownload:i,onVersionRestore:o},null,8,["asset-id","initial-versions"])):f("",!0)]),x("section",Et,[(null==(z=e.asset)?void 0:z.id)?(p(),M(Oe,{key:0,"asset-id":e.asset.id,"initial-comments":m.value,onCommentAdded:n,onCommentUpdated:l,onCommentDeleted:r},null,8,["asset-id","initial-comments"])):f("",!0)]),x("section",Rt,[x("div",Ut,[A(R,{variant:"primary",size:"md",class:"w-full",onClick:s[0]||(s[0]=e=>t.$emit("download"))},{default:j(()=>[...s[21]||(s[21]=[x("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[x("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),I(" Скачать ",-1)])]),_:1}),A(R,{variant:"outline",size:"md",class:"w-full",onClick:s[1]||(s[1]=e=>t.$emit("share"))},{default:j(()=>[...s[22]||(s[22]=[x("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[x("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.552 3.546a2 2 0 002.938-2.187l.546-2.59A4.998 4.998 0 0017 12c0-.482-.114-.938-.316-1.342m0 2.684L12.448 8.454a2 2 0 00-2.938-2.187l-.546 2.59A4.998 4.998 0 007 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684"})],-1),I(" Поделиться ",-1)])]),_:1})])])])}}}),[["__scopeId","data-v-70de0a47"]]),Lt={class:"asset-detail-page"},Wt={key:0,class:"p-8 text-center"},Tt={key:1,class:"p-8 text-center"},Kt={class:"max-w-md mx-auto"},qt={class:"mt-2 text-sm text-neutral-600 dark:text-neutral-600"},Ft={key:2,class:"asset-detail-content"},Jt={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Gt={class:"lg:col-span-2"},Qt={class:"bg-neutral-50 dark:bg-neutral-50 rounded-lg p-4"},Xt={class:"relative w-full bg-neutral-100 dark:bg-neutral-100 rounded-lg overflow-hidden",style:{"aspect-ratio":"16/9","min-height":"400px"}},Yt=["src","alt"],Zt=["src"],es={key:2,class:"w-full h-full flex items-center justify-center"},ts={key:3,class:"absolute bottom-4 right-4 flex gap-2"},ss={key:4,class:"absolute top-1/2 left-4 transform -translate-y-1/2"},as={key:5,class:"absolute top-1/2 right-4 transform -translate-y-1/2"},ns={class:"mt-4"},ls={class:"text-2xl font-bold text-neutral-900 dark:text-neutral-900"},rs={key:0,class:"mt-2 flex flex-wrap gap-2"},is={class:"lg:col-span-1"},os={class:"bg-neutral-0 dark:bg-neutral-0 border border-neutral-300 dark:border-neutral-300 rounded-lg sticky top-4 max-h-[calc(100vh-8rem)] overflow-y-auto"},us=U(u({__name:"AssetDetailPage",setup(e){const t=B(),s=P(),a=V(),n=d(1),l=d(!1),r=c(()=>{const e=a.currentAsset;return e&&(e.preview_url||e.thumbnail_url)||""}),i=c(()=>{var e;const t=a.currentAsset;return t&&(null==(e=t.mime_type)?void 0:e.startsWith("image/"))||!1}),u=c(()=>{var e;const t=a.currentAsset;return t&&(null==(e=t.mime_type)?void 0:e.startsWith("video/"))||!1}),m=c(()=>[]),g=c(()=>a.currentAsset?m.value.findIndex(e=>{var t;return e.id===(null==(t=a.currentAsset)?void 0:t.id)}):-1),w=c(()=>{const e=g.value;return e>0?m.value[e-1]:null}),_=c(()=>{const e=g.value;return e>=0&&e<m.value.length-1?m.value[e+1]:null});function C(){const e=parseInt(t.params.id,10);e&&a.getAssetDetail(e)}function $(){const e=a.currentAsset;if(!e)return;const t=e.preview_url||e.thumbnail_url;t&&window.open(t,"_blank")}function D(){}function O(e){}function H(e){const s=parseInt(t.params.id,10);s&&a.getAssetDetail(s)}function E(e){const s=parseInt(t.params.id,10);s&&a.getAssetDetail(s)}function R(e){const s=parseInt(t.params.id,10);s&&a.getAssetDetail(s)}function U(e){}function N(e){const s=parseInt(t.params.id,10);s&&a.getAssetDetail(s)}function L(){l.value=!0}function W(){n.value=Math.min(n.value+.25,3)}function T(){n.value=Math.max(n.value-.25,.5)}function K(){n.value=1}function F(e){s.push(`/dam/assets/${e}`)}function J(e){"ArrowLeft"===e.key&&w.value?F(w.value.id):"ArrowRight"===e.key&&_.value&&F(_.value.id)}return S(()=>o(this,null,function*(){const e=parseInt(t.params.id,10);!e||a.currentAsset&&a.currentAsset.id===e||(yield a.getAssetDetail(e)),document.addEventListener("keydown",J)})),z(()=>{document.removeEventListener("keydown",J)}),(e,t)=>(p(),v("div",Lt,[k(a).isLoading&&!k(a).currentAsset?(p(),v("div",Wt,[...t[2]||(t[2]=[x("div",{class:"animate-spin h-8 w-8 mx-auto text-primary-500"},null,-1),x("p",{class:"mt-4 text-neutral-600 dark:text-neutral-600"},"Загрузка...",-1)])])):k(a).error&&!k(a).currentAsset?(p(),v("div",Tt,[x("div",Kt,[t[3]||(t[3]=x("svg",{class:"mx-auto h-12 w-12 text-error",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[x("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t[4]||(t[4]=x("h3",{class:"mt-4 text-lg font-medium text-neutral-900 dark:text-neutral-900"}," Ошибка загрузки ",-1)),x("p",qt,h(k(a).error),1),x("button",{class:"mt-4 px-4 py-2 bg-primary-500 text-white rounded-md hover:bg-primary-600 transition-colors",onClick:C}," Попробовать снова ")])])):k(a).currentAsset?(p(),v("div",Ft,[x("div",Jt,[x("div",Gt,[x("div",Qt,[x("div",Xt,[i.value?(p(),v("img",{key:0,src:r.value,alt:k(a).currentAsset.label,class:"w-full h-full object-contain",onError:L},null,40,Yt)):u.value?(p(),v("video",{key:1,src:r.value,controls:"",class:"w-full h-full object-contain"}," Ваш браузер не поддерживает видео. ",8,Zt)):(p(),v("div",es,[x("div",{class:"text-center"},[t[5]||(t[5]=x("svg",{class:"mx-auto h-16 w-16 text-neutral-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[x("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})],-1)),t[6]||(t[6]=x("p",{class:"mt-4 text-neutral-600 dark:text-neutral-600"}," Предпросмотр недоступен для этого типа файла ",-1)),x("button",{class:"mt-4 px-4 py-2 bg-primary-500 text-white rounded-md hover:bg-primary-600 transition-colors",onClick:$}," Скачать файл ")])])),i.value?(p(),v("div",ts,[x("button",{class:"p-2 bg-white dark:bg-neutral-800 rounded-md shadow-md hover:bg-neutral-100 dark:hover:bg-neutral-700 transition-colors",onClick:T,"aria-label":"Уменьшить"},[...t[7]||(t[7]=[x("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[x("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"})],-1)])]),x("button",{class:"p-2 bg-white dark:bg-neutral-800 rounded-md shadow-md hover:bg-neutral-100 dark:hover:bg-neutral-700 transition-colors",onClick:W,"aria-label":"Увеличить"},[...t[8]||(t[8]=[x("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[x("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6m3-3H7"})],-1)])]),x("button",{class:"p-2 bg-white dark:bg-neutral-800 rounded-md shadow-md hover:bg-neutral-100 dark:hover:bg-neutral-700 transition-colors",onClick:K,"aria-label":"Сбросить масштаб"},[...t[9]||(t[9]=[x("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[x("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])])])):f("",!0),m.value.length>0?(p(),v("div",ss,[w.value?(p(),v("button",{key:0,class:"p-2 bg-white dark:bg-neutral-800 rounded-full shadow-md hover:bg-neutral-100 dark:hover:bg-neutral-700 transition-colors",onClick:t[0]||(t[0]=e=>F(w.value.id)),"aria-label":"Предыдущий актив"},[...t[10]||(t[10]=[x("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[x("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])])):f("",!0)])):f("",!0),m.value.length>0?(p(),v("div",as,[_.value?(p(),v("button",{key:0,class:"p-2 bg-white dark:bg-neutral-800 rounded-full shadow-md hover:bg-neutral-100 dark:hover:bg-neutral-700 transition-colors",onClick:t[1]||(t[1]=e=>F(_.value.id)),"aria-label":"Следующий актив"},[...t[11]||(t[11]=[x("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[x("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])])):f("",!0)])):f("",!0)]),x("div",ns,[x("h1",ls,h(k(a).currentAsset.label),1),k(a).currentAsset.tags&&k(a).currentAsset.tags.length>0?(p(),v("p",rs,[(p(!0),v(y,null,b(k(a).currentAsset.tags,e=>(p(),M(q,{key:e,variant:"info",size:"sm"},{default:j(()=>[I(h(e),1)]),_:2},1024))),128))])):f("",!0)])])]),x("div",is,[x("div",os,[A(Nt,{asset:k(a).currentAsset,onDownload:$,onShare:D,onVersionSelect:O,onCommentAdded:H,onCommentUpdated:E,onCommentDeleted:R,onVersionDownload:U,onVersionRestore:N},null,8,["asset"])])])])])):f("",!0)]))}}),[["__scopeId","data-v-32d78888"]]);export{us as default};
//# sourceMappingURL=AssetDetailPage-BobnOf4R.js.map

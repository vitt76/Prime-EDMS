{"version":3,"file":"distributionStore-PebOb9Xr.js","sources":["../../src/services/distributionService.ts","../../src/stores/distributionStore.ts"],"sourcesContent":["import { apiService } from './apiService'\nimport type {\n  Publication,\n  CreatePublicationRequest,\n  UpdatePublicationRequest,\n  PaginatedResponse,\n  ShareLink,\n  PublicationAnalytics\n} from '@/types/api'\n\nclass DistributionService {\n  /**\n   * Get paginated list of publications\n   */\n  async getPublications(params?: {\n    page?: number\n    page_size?: number\n    status?: Publication['status']\n    search?: string\n  }): Promise<PaginatedResponse<Publication>> {\n    const queryParams: Record<string, string | number> = {}\n\n    if (params?.page) {\n      queryParams.page = params.page\n    }\n    if (params?.page_size) {\n      queryParams.page_size = params.page_size\n    }\n    if (params?.status) {\n      queryParams.status = params.status\n    }\n    if (params?.search) {\n      queryParams.search = params.search\n    }\n\n    const searchParams = new URLSearchParams()\n    Object.entries(queryParams).forEach(([key, value]) => {\n      searchParams.append(key, String(value))\n    })\n\n    const endpoint =\n      searchParams.toString().length > 0\n        ? `/v4/distribution/publications/?${searchParams}`\n        : '/v4/distribution/publications/'\n\n    return apiService.get<PaginatedResponse<Publication>>(endpoint, undefined, false)\n  }\n\n  /**\n   * Get single publication by ID\n   */\n  async getPublication(id: number): Promise<Publication> {\n    return apiService.get<Publication>(\n      `/v4/distribution/publications/${id}/`,\n      undefined,\n      true // Cache publication details for 5 minutes\n    )\n  }\n\n  /**\n   * Create a new publication\n   */\n  async createPublication(\n    publication: CreatePublicationRequest\n  ): Promise<Publication> {\n    return apiService.post<Publication>(\n      '/v4/distribution/publications/',\n      publication\n    )\n  }\n\n  /**\n   * Update an existing publication\n   */\n  async updatePublication(\n    id: number,\n    publication: UpdatePublicationRequest\n  ): Promise<Publication> {\n    return apiService.put<Publication>(\n      `/v4/distribution/publications/${id}/`,\n      publication\n    )\n  }\n\n  /**\n   * Delete a publication\n   */\n  async deletePublication(id: number): Promise<void> {\n    return apiService.delete<void>(`/v4/distribution/publications/${id}/`)\n  }\n\n  /**\n   * Publish a publication\n   */\n  async publishPublication(id: number): Promise<Publication> {\n    return apiService.post<Publication>(\n      `/v4/distribution/publications/${id}/publish/`\n    )\n  }\n\n  /**\n   * Get share links for a publication\n   */\n  async getShareLinks(publicationId: number): Promise<ShareLink[]> {\n    const response = await apiService.get<PaginatedResponse<ShareLink>>(\n      `/v4/distribution/publications/${publicationId}/links/`\n    )\n    return response.results || []\n  }\n\n  /**\n   * Create a share link for a publication\n   */\n  async createShareLink(\n    publicationId: number,\n    options?: {\n      expires_at?: string\n      password?: string\n      permissions?: {\n        view: boolean\n        download: boolean\n      }\n    }\n  ): Promise<ShareLink> {\n    return apiService.post<ShareLink>(\n      `/v4/distribution/publications/${publicationId}/links/`,\n      options\n    )\n  }\n\n  /**\n   * Delete a share link\n   */\n  async deleteShareLink(\n    publicationId: number,\n    linkId: number\n  ): Promise<void> {\n    return apiService.delete<void>(\n      `/v4/distribution/publications/${publicationId}/links/${linkId}/`\n    )\n  }\n\n  /**\n   * Get available channels\n   */\n  async getChannels(): Promise<Publication['channels']> {\n    const response = await apiService.get<PaginatedResponse<Publication['channels'][0]>>(\n      '/v4/distribution/channels/'\n    )\n    return response.results || []\n  }\n\n  /**\n   * Get analytics for a publication\n   */\n  async getPublicationAnalytics(publicationId: number): Promise<PublicationAnalytics> {\n    return apiService.get<PublicationAnalytics>(\n      `/v4/distribution/publications/${publicationId}/analytics/`,\n      undefined,\n      true // Cache analytics for 5 minutes\n    )\n  }\n\n  /**\n   * Get public publication using token (portal access)\n   */\n  async getPublicationByToken(token: string): Promise<Publication> {\n    return apiService.get<Publication>(\n      `/v4/distribution/publications/portal/${token}/`,\n      undefined,\n      false\n    )\n  }\n\n  /**\n   * Track a view for the public publication\n   */\n  async trackPublicView(token: string): Promise<void> {\n    await apiService.post<void>(\n      `/v4/distribution/publications/portal/${token}/events/`,\n      { event: 'view' }\n    )\n  }\n\n  /**\n   * Track a download for a public asset\n   */\n  async trackPublicDownload(token: string, assetId?: number): Promise<void> {\n    await apiService.post<void>(\n      `/v4/distribution/publications/portal/${token}/events/`,\n      {\n        event: 'download',\n        asset_id: assetId\n      }\n    )\n  }\n}\n\nexport const distributionService = new DistributionService()\n\n","import { defineStore } from 'pinia'\r\nimport { ref, computed } from 'vue'\r\nimport { distributionService } from '@/services/distributionService'\r\nimport type { Publication, PaginatedResponse } from '@/types/api'\r\nimport { formatApiError } from '@/utils/errors'\r\n\r\nexport const useDistributionStore = defineStore(\r\n  'distribution',\r\n  () => {\r\n    // State\r\n    const publications = ref<Publication[]>([])\r\n    const totalCount = ref(0)\r\n    const currentPage = ref(1)\r\n    const pageSize = ref(20)\r\n    const isLoading = ref(false)\r\n    const error = ref<string | null>(null)\r\n    const currentPublication = ref<Publication | null>(null)\r\n    const filters = ref<{\r\n      status?: Publication['status']\r\n      search?: string\r\n    }>({})\r\n\r\n    // Getters\r\n    const hasNextPage = computed(() => {\r\n      const totalPages = Math.ceil(totalCount.value / pageSize.value)\r\n      return currentPage.value < totalPages\r\n    })\r\n\r\n    const hasPreviousPage = computed(() => {\r\n      return currentPage.value > 1\r\n    })\r\n\r\n    const totalPages = computed(() => {\r\n      return Math.ceil(totalCount.value / pageSize.value)\r\n    })\r\n\r\n    // Actions\r\n    async function fetchPublications(params?: {\r\n      page?: number\r\n      page_size?: number\r\n      status?: Publication['status']\r\n      search?: string\r\n    }) {\r\n      isLoading.value = true\r\n      error.value = null\r\n\r\n      try {\r\n        const queryParams = {\r\n          page: currentPage.value,\r\n          page_size: pageSize.value,\r\n          ...filters.value,\r\n          ...params\r\n        }\r\n\r\n        const response: PaginatedResponse<Publication> = await distributionService.getPublications(\r\n          queryParams\r\n        )\r\n\r\n        publications.value = response.results\r\n        totalCount.value = response.count\r\n\r\n        if (params?.page) {\r\n          currentPage.value = params.page\r\n        }\r\n      } catch (err) {\r\n        error.value = formatApiError(err)\r\n        publications.value = []\r\n        totalCount.value = 0\r\n        throw err\r\n      } finally {\r\n        isLoading.value = false\r\n      }\r\n    }\r\n\r\n    async function getPublication(id: number) {\r\n      isLoading.value = true\r\n      error.value = null\r\n\r\n      try {\r\n        const publication = await distributionService.getPublication(id)\r\n        currentPublication.value = publication\r\n        return publication\r\n      } catch (err) {\r\n        error.value = formatApiError(err)\r\n        currentPublication.value = null\r\n        throw err\r\n      } finally {\r\n        isLoading.value = false\r\n      }\r\n    }\r\n\r\n    async function createPublication(publication: Parameters<typeof distributionService.createPublication>[0]) {\r\n      isLoading.value = true\r\n      error.value = null\r\n\r\n      try {\r\n        const newPublication = await distributionService.createPublication(publication)\r\n        publications.value.unshift(newPublication)\r\n        totalCount.value++\r\n        return newPublication\r\n      } catch (err) {\r\n        error.value = formatApiError(err)\r\n        throw err\r\n      } finally {\r\n        isLoading.value = false\r\n      }\r\n    }\r\n\r\n    async function updatePublication(\r\n      id: number,\r\n      publication: Parameters<typeof distributionService.updatePublication>[1]\r\n    ) {\r\n      isLoading.value = true\r\n      error.value = null\r\n\r\n      try {\r\n        const updated = await distributionService.updatePublication(id, publication)\r\n        const index = publications.value.findIndex((p) => p.id === id)\r\n        if (index !== -1) {\r\n          publications.value[index] = updated\r\n        }\r\n        if (currentPublication.value?.id === id) {\r\n          currentPublication.value = updated\r\n        }\r\n        return updated\r\n      } catch (err) {\r\n        error.value = formatApiError(err)\r\n        throw err\r\n      } finally {\r\n        isLoading.value = false\r\n      }\r\n    }\r\n\r\n    async function deletePublication(id: number) {\r\n      isLoading.value = true\r\n      error.value = null\r\n\r\n      try {\r\n        await distributionService.deletePublication(id)\r\n        publications.value = publications.value.filter((p) => p.id !== id)\r\n        totalCount.value--\r\n        if (currentPublication.value?.id === id) {\r\n          currentPublication.value = null\r\n        }\r\n      } catch (err) {\r\n        error.value = formatApiError(err)\r\n        throw err\r\n      } finally {\r\n        isLoading.value = false\r\n      }\r\n    }\r\n\r\n    async function publishPublication(id: number) {\r\n      isLoading.value = true\r\n      error.value = null\r\n\r\n      try {\r\n        const published = await distributionService.publishPublication(id)\r\n        const index = publications.value.findIndex((p) => p.id === id)\r\n        if (index !== -1) {\r\n          publications.value[index] = published\r\n        }\r\n        if (currentPublication.value?.id === id) {\r\n          currentPublication.value = published\r\n        }\r\n        return published\r\n      } catch (err) {\r\n        error.value = formatApiError(err)\r\n        throw err\r\n      } finally {\r\n        isLoading.value = false\r\n      }\r\n    }\r\n\r\n    function setPage(page: number) {\r\n      if (page >= 1 && page <= totalPages.value) {\r\n        currentPage.value = page\r\n        fetchPublications()\r\n      }\r\n    }\r\n\r\n    function setPageSize(size: number) {\r\n      pageSize.value = Math.min(Math.max(size, 1), 100)\r\n      currentPage.value = 1\r\n      fetchPublications()\r\n    }\r\n\r\n    function applyFilters(newFilters: typeof filters.value) {\r\n      filters.value = { ...filters.value, ...newFilters }\r\n      currentPage.value = 1\r\n      fetchPublications()\r\n    }\r\n\r\n    function clearFilters() {\r\n      filters.value = {}\r\n      currentPage.value = 1\r\n      fetchPublications()\r\n    }\r\n\r\n    function refresh() {\r\n      fetchPublications()\r\n    }\r\n\r\n    return {\r\n      // State\r\n      publications,\r\n      totalCount,\r\n      currentPage,\r\n      pageSize,\r\n      isLoading,\r\n      error,\r\n      currentPublication,\r\n      filters,\r\n\r\n      // Getters\r\n      hasNextPage,\r\n      hasPreviousPage,\r\n      totalPages,\r\n\r\n      // Actions\r\n      fetchPublications,\r\n      getPublication,\r\n      createPublication,\r\n      updatePublication,\r\n      deletePublication,\r\n      publishPublication,\r\n      setPage,\r\n      setPageSize,\r\n      applyFilters,\r\n      clearFilters,\r\n      refresh\r\n    }\r\n  },\r\n  {\r\n    persist: {\r\n      paths: ['pageSize', 'filters'] // Persist user preferences\r\n    }\r\n  }\r\n)\r\n\r\n"],"names":["distributionService","getPublications","params","__async","this","queryParams","page","page_size","status","search","searchParams","URLSearchParams","Object","entries","forEach","key","value","append","String","endpoint","toString","length","apiService","get","getPublication","id","createPublication","publication","post","updatePublication","put","deletePublication","delete","publishPublication","getShareLinks","publicationId","results","createShareLink","options","deleteShareLink","linkId","getChannels","getPublicationAnalytics","getPublicationByToken","token","trackPublicView","event","trackPublicDownload","assetId","asset_id","useDistributionStore","defineStore","publications","ref","totalCount","currentPage","pageSize","isLoading","error","currentPublication","filters","hasNextPage","computed","totalPages","Math","ceil","hasPreviousPage","fetchPublications","__spreadValues","response","count","err","formatApiError","newPublication","unshift","updated","index","findIndex","p","_a","filter","published","setPage","setPageSize","size","min","max","applyFilters","newFilters","clearFilters","refresh","persist","paths"],"mappings":"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"}
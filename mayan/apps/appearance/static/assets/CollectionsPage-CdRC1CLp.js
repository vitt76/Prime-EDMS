var e=Object.defineProperty,l=Object.defineProperties,t=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,n=(l,t,o)=>t in l?e(l,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[t]=o,s=(e,l)=>{for(var t in l||(l={}))i.call(l,t)&&n(e,t,l[t]);if(o)for(var t of o(l))a.call(l,t)&&n(e,t,l[t]);return e},r=(e,o)=>l(e,t(o)),c=(e,l,t)=>new Promise((o,i)=>{var a=e=>{try{s(t.next(e))}catch(l){i(l)}},n=e=>{try{s(t.throw(e))}catch(l){i(l)}},s=e=>e.done?o(e.value):Promise.resolve(e.value).then(a,n);s((t=t.apply(e,l)).next())});import{d as u,r as d,c as v,b as p,e as f,i as h,F as m,h as _,z as y,j as g,l as C,p as b,q as k,n as w,t as x,s as M,C as N,f as S,T as j,k as D,P as $,m as E,v as I,A as B,w as T,B as O,x as V}from"./vue-vendor-B11yH1L4.js";import{w as z,a as P,u as F,k as A,f as H,d as L,e as q}from"./index-CEUju959.js";import{e as R}from"./errorHandling-B5S82HA9.js";import{B as U}from"./Breadcrumbs-CYyEtqIv.js";import{_ as K}from"./Modal.vue_vue_type_script_setup_true_lang-Cpe0tIsY.js";import{_ as W}from"./Input.vue_vue_type_script_setup_true_lang--8g8gQXi.js";import{_ as G}from"./Select.vue_vue_type_script_setup_true_lang-8BshTy_O.js";import{D as Y}from"./DeleteConfirmModal-FrXl2jew.js";import"./utils-vendor-BYNnTNyD.js";const J=new class{getCollections(){return c(this,arguments,function*(e={}){const l=yield z(()=>P.get("/v4/collections/",{params:e}));if(!l.success)throw l.error;return l.data})}getCollection(e,l=!1){return c(this,null,function*(){const t=yield z(()=>P.get(`/v4/collections/${e}/`,{params:l?{include_tree:!0}:{}}));if(!t.success)throw t.error;return t.data})}createCollection(e){return c(this,null,function*(){const l=yield z(()=>P.post("/v4/collections/",e));if(!l.success)throw l.error;return l.data})}updateCollection(e,l){return c(this,null,function*(){const t=yield z(()=>P.patch(`/v4/collections/${e}/`,l));if(!t.success)throw t.error;return t.data})}deleteCollection(e){return c(this,null,function*(){const l=yield z(()=>P.delete(`/v4/collections/${e}/`));if(!l.success)throw l.error})}moveCollection(e,l){return c(this,null,function*(){const t=yield z(()=>P.post(`/v4/collections/${e}/move/`,{parent_id:l}));if(!t.success)throw t.error;return t.data})}getCollectionAssets(e){return c(this,null,function*(){const l=e,{collection_id:t}=l,n=((e,l)=>{var t={};for(var n in e)i.call(e,n)&&l.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&o)for(var n of o(e))l.indexOf(n)<0&&a.call(e,n)&&(t[n]=e[n]);return t})(l,["collection_id"]),s=yield z(()=>P.get(`/v4/collections/${t}/assets/`,{params:n}));if(!s.success)throw s.error;return s.data})}addAssetsToCollection(e,l,t){return c(this,null,function*(){const o=yield z(()=>P.post(`/v4/collections/${e}/assets/`,{asset_ids:l,position:t}));if(!o.success)throw o.error})}removeAssetsFromCollection(e,l){return c(this,null,function*(){const t=yield z(()=>P.delete(`/v4/collections/${e}/assets/`,{data:{asset_ids:l}}));if(!t.success)throw t.error})}reorderCollectionAssets(e,l){return c(this,null,function*(){const t=yield z(()=>P.post(`/v4/collections/${e}/assets/reorder/`,{asset_ids:l}));if(!t.success)throw t.error})}searchCollections(e){return c(this,arguments,function*(e,l={}){const t=yield z(()=>P.get("/v4/collections/search/",{params:s({q:e},l)}));if(!t.success)throw t.error;return t.data})}getCollectionTree(e){return c(this,null,function*(){const l=yield z(()=>P.get("/v4/collections/tree/",{params:e?{parent_id:e}:{}}));if(!l.success)throw l.error;return l.data})}duplicateCollection(e,l,t){return c(this,null,function*(){const o=yield z(()=>P.post(`/v4/collections/${e}/duplicate/`,{name:l,parent_id:t}));if(!o.success)throw o.error;return o.data})}getCollectionStats(e){return c(this,null,function*(){const l=yield z(()=>P.get(`/v4/collections/${e}/stats/`));if(!l.success)throw l.error;return l.data})}exportCollection(e,l="zip"){return c(this,null,function*(){const t=yield z(()=>P.post(`/v4/collections/${e}/export/`,{format:l}));if(!t.success)throw t.error;return t.data.download_url})}shareCollection(e,l){return c(this,null,function*(){const t=yield z(()=>P.post(`/v4/collections/${e}/share/`,l));if(!t.success)throw t.error;return t.data})}getCollectionShares(e){return c(this,null,function*(){const l=yield z(()=>P.get(`/v4/collections/${e}/shares/`));if(!l.success)throw l.error;return l.data})}revokeCollectionShare(e,l){return c(this,null,function*(){const t=yield z(()=>P.delete(`/v4/collections/${e}/shares/${l}/`));if(!t.success)throw t.error})}bulkDelete(e){return c(this,null,function*(){const l=yield z(()=>P.post("/v4/collections/bulk/delete/",{collection_ids:e}));if(!l.success)throw l.error})}bulkMove(e,l){return c(this,null,function*(){const t=yield z(()=>P.post("/v4/collections/bulk/move/",{collection_ids:e,parent_id:l}));if(!t.success)throw t.error})}},Q=u("collections",()=>{const e=F(),l=A(),t=d({collections:0,collection:0}),o=e=>{var l;const o=(null!=(l=t.value[e])?l:0)+1;return t.value=r(s({},t.value),{[e]:o}),o},i=(e,l)=>t.value[e]===l,a=(e,t)=>{const o=H(t),i=R(t);return l.addNotification({type:"error",title:`${e} Error`,message:o,meta:i?{code:i}:void 0}),o},n=d([]),u=d(null),p=d([]),f=d([]),h=d(0),m=d([]),_=d([]),y=d([]),g=d([]),C=d([]),b=d(new Set),k=d(null),w=d(!1),x=d(null),M=d(null),N=v(()=>e.hasPermission.value("collections.create")),S=v(()=>e.hasPermission.value("collections.delete")),j=v(()=>e.hasPermission.value("collections.edit")),D=v(()=>e.hasPermission.value("collections.share")),$=v(()=>n.value.filter(e=>null===e.parent_id)),E=v(()=>{const e=[],l=t=>{for(const o of t)e.push(o.collection),o.children.length>0&&l(o.children)};return l(p.value),e}),I=v(()=>e=>{const l=[];if(!n.value.find(l=>l.id===e))return l;const t=(e,o)=>{const i=n.value.find(l=>l.id===e);i&&(i.parent_id&&t(i.parent_id,o-1),l.push({id:i.id,name:i.name,level:o}))};return t(e,0),l});function B(e){return c(this,null,function*(){const l=Date.now();if(M.value&&l-M.value<3e5&&n.value.length>0)return;const t="collections",s=o(t);w.value=!0,x.value=null;try{const l=yield J.getCollections(e);if(!i(t,s))return;n.value=l.results,h.value=l.count,M.value=Date.now(),p.value=T(n.value)}catch(r){if(!i(t,s))return;const e=a("Collections list fetch",r);throw x.value=e,n.value=[],h.value=0,p.value=[],r}finally{i(t,s)&&(w.value=!1)}})}function T(e){const l=[...e].sort((e,l)=>e.name.localeCompare(l.name)),t=new Map;l.forEach(e=>t.set(e.id,e));const o=(e,t)=>l.filter(l=>l.parent_id===e).map(e=>({collection:e,children:o(e.id,t+1),level:t}));return o(null,0)}function O(){M.value=null}return{collections:n,currentCollection:u,collectionsTree:p,selectedCollections:f,totalCollectionsCount:h,favorites:m,recentCollections:_,sharedWithMe:y,myUploads:g,publicCollections:C,expandedNodes:b,draggedCollection:k,isLoading:w,error:x,lastFetchTime:M,canCreateCollection:N,canDeleteCollection:S,canEditCollection:j,canShareCollection:D,rootCollections:$,flattenedTree:E,breadcrumbs:I,fetchCollections:B,fetchCollection:function(e){return c(this,null,function*(){const l="collection",t=o(l);w.value=!0,x.value=null;try{const o=yield J.getCollection(e);if(!i(l,t))return o;u.value=o;const a=n.value.findIndex(l=>l.id===e);return-1!==a?n.value[a]=o:n.value.push(o),p.value=T(n.value),o}catch(s){if(!i(l,t))throw s;const e=a("Collection fetch",s);throw x.value=e,u.value=null,s}finally{i(l,t)&&(w.value=!1)}})},createCollection:function(e){return c(this,null,function*(){w.value=!0,x.value=null;try{const l=yield J.createCollection(e);return n.value.push(l),h.value++,p.value=T(n.value),O(),l}catch(l){throw x.value=H(l),l}finally{w.value=!1}})},updateCollection:function(e,l){return c(this,null,function*(){var t;w.value=!0,x.value=null;try{const o=yield J.updateCollection(e,l),i=n.value.findIndex(l=>l.id===e);return-1!==i&&(n.value[i]=o),(null==(t=u.value)?void 0:t.id)===e&&(u.value=o),p.value=T(n.value),O(),void 0!==l.is_favorite&&(l.is_favorite?m.value.find(l=>l.id===e)||m.value.push(o):m.value=m.value.filter(l=>l.id!==e)),O(),o}catch(o){throw x.value=H(o),o}finally{w.value=!1}})},deleteCollection:function(e){return c(this,null,function*(){var l;w.value=!0,x.value=null;try{yield J.deleteCollection(e);const t=e=>{n.value=n.value.filter(l=>l.id!==e);n.value.filter(l=>l.parent_id===e).forEach(e=>t(e.id))};t(e),h.value=n.value.length,(null==(l=u.value)?void 0:l.id)===e&&(u.value=null),f.value=f.value.filter(l=>l!==e),m.value=m.value.filter(l=>l.id!==e),p.value=T(n.value)}catch(t){throw x.value=H(t),t}finally{w.value=!1}})},moveCollection:function(e,l,t){return c(this,null,function*(){w.value=!0,x.value=null;try{const o=void 0!==t?t:l,i=yield J.moveCollection(e,{collection_id:e,new_parent_id:o}),a=n.value.findIndex(l=>l.id===e);return-1!==a&&(n.value[a]=i),p.value=T(n.value),O(),i}catch(o){throw x.value=H(o),o}finally{w.value=!1}})},bulkCollectionOperation:function(e){return c(this,null,function*(){if(e.ids.length>50)throw new Error("Maximum 50 collections allowed per bulk operation");w.value=!0,x.value=null;try{const l=yield J.bulkOperation(e);return O(),yield B(),l}catch(l){throw x.value=H(l),l}finally{w.value=!1}})},toggleFavorite:function(e){return c(this,null,function*(){var l;w.value=!0,x.value=null;try{const t=yield J.toggleFavorite(e),o=n.value.findIndex(l=>l.id===e);return-1!==o&&(n.value[o]=t),(null==(l=u.value)?void 0:l.id)===e&&(u.value=t),t.is_favorite?m.value.find(l=>l.id===e)||m.value.push(t):m.value=m.value.filter(l=>l.id!==e),O(),t}catch(t){throw x.value=H(t),t}finally{w.value=!1}})},fetchSpecialCollections:function(){return c(this,null,function*(){w.value=!0,x.value=null;try{const e=yield J.getSpecialCollections();m.value=e.favorites,_.value=e.recent,y.value=e.shared_with_me,g.value=e.my_uploads,C.value=e.public_collections}catch(e){const l=a("Special collections fetch",e);throw x.value=l,m.value=[],_.value=[],y.value=[],g.value=[],C.value=[],e}finally{w.value=!1}})},expandNode:function(e){b.value.add(e)},collapseNode:function(e){b.value.delete(e)},toggleNodeExpanded:function(e){b.value.has(e)?b.value.delete(e):b.value.add(e)},isNodeExpanded:function(e){return b.value.has(e)},setDraggedCollection:function(e){k.value=e},selectCollections:function(e){f.value=e},clearSelection:function(){f.value=[]},toggleSelection:function(e){const l=f.value.indexOf(e);-1===l?f.value.push(e):f.value.splice(l,1)},setCurrentCollection:function(e){u.value=e},buildCollectionTree:T,clearError:function(){x.value=null},invalidateCache:O}},{persist:{paths:["expandedNodes"]}}),X={class:"collection-tree"},Z={class:"collection-tree__list",role:"tree","aria-label":"Collections tree"},ee=["aria-expanded","aria-level"],le={class:"collection-tree__row"},te=["onClick","aria-label","data-testid"],oe={class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},ie={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},ae={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},ne={key:1,class:"collection-tree__spacer"},se=["onClick","onDragstart","onDragover","onDrop","onKeydown","aria-label","aria-selected","data-testid"],re={class:"collection-tree__name"},ce={class:"collection-tree__count"},ue=L(p({__name:"CollectionTree",props:{collections:{},expandedNodes:{},selectedCollectionId:{},draggedCollection:{}},emits:["select","toggle-expand","drag-start","drop"],setup(e,{emit:l}){const t=e,o=l,i=d(null),a=()=>{i.value=null};return(l,n)=>{const s=y("CollectionTree",!0);return g(),f("div",X,[h("ul",Z,[(g(!0),f(m,null,_(e.collections,l=>{var r;return g(),f("li",{key:l.collection.id,class:"collection-tree__item",role:"treeitem","aria-expanded":e.expandedNodes.includes(l.collection.id),"aria-level":l.level+1},[h("div",le,[l.children.length>0?(g(),f("button",{key:0,class:"collection-tree__toggle",onClick:e=>o("toggle-expand",l.collection.id),"aria-label":`${e.expandedNodes.includes(l.collection.id)?"Collapse":"Expand"} ${l.collection.name}`,tabindex:"0","data-testid":`collection-toggle-${l.collection.id}`},[(g(),f("svg",oe,[e.expandedNodes.includes(l.collection.id)?(g(),f("path",ie)):(g(),f("path",ae))]))],8,te)):(g(),f("div",ne)),h("button",{class:w(["collection-tree__button",{"collection-tree__button--active":e.selectedCollectionId===l.collection.id,"collection-tree__button--dragging":(null==(r=e.draggedCollection)?void 0:r.id)===l.collection.id}]),draggable:!0,onClick:e=>o("select",l.collection),onDragstart:e=>{return t=e,i=l.collection,t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",String(i.id))),void o("drag-start",i);var t,i},onDragover:k(e=>{return t=e,o=l.collection,t.preventDefault(),t.dataTransfer&&(t.dataTransfer.dropEffect="move"),void(i.value=o.id);var t,o},["prevent"]),onDrop:e=>((e,l)=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget.getBoundingClientRect(),a=e.offsetY<t.height/2;o("drop",l,a?l.id:l.parent_id),i.value=null})(e,l.collection),onDragend:a,onKeydown:[b(e=>o("select",l.collection),["enter"]),b(k(e=>o("select",l.collection),["prevent"]),["space"]),b(e=>(e=>{t.expandedNodes.includes(e.collection.id)&&o("toggle-expand",e.collection.id)})(l),["arrow-left"]),b(e=>(e=>{!t.expandedNodes.includes(e.collection.id)&&e.children.length>0&&o("toggle-expand",e.collection.id)})(l),["arrow-right"])],"aria-label":`Collection ${l.collection.name} with ${l.collection.asset_count} assets`,"aria-selected":e.selectedCollectionId===l.collection.id,tabindex:"0","data-testid":`collection-node-${l.collection.id}`},[n[4]||(n[4]=h("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})],-1)),h("span",re,x(l.collection.name),1),h("span",ce,x(l.collection.asset_count),1)],42,se)]),C(j,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 max-h-0","enter-to-class":"opacity-100 max-h-96","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 max-h-96","leave-to-class":"opacity-0 max-h-0"},{default:M(()=>[e.expandedNodes.includes(l.collection.id)&&l.children.length>0?(g(),N(s,{key:0,collections:l.children,"expanded-nodes":e.expandedNodes,"selected-collection-id":e.selectedCollectionId,"dragged-collection":e.draggedCollection,class:"collection-tree__children",onSelect:n[0]||(n[0]=e=>o("select",e)),onToggleExpand:n[1]||(n[1]=e=>o("toggle-expand",e)),onDragStart:n[2]||(n[2]=e=>o("drag-start",e)),onDrop:n[3]||(n[3]=(e,l)=>o("drop",e,l))},null,8,["collections","expanded-nodes","selected-collection-id","dragged-collection"])):S("",!0)]),_:2},1024)],8,ee)}),128))])])}}}),[["__scopeId","data-v-745d28bf"]]),de={class:"asset-grid"},ve={key:0,class:"asset-grid__loading",role:"status","aria-live":"polite"},pe=["aria-label"],fe={key:1,class:"asset-grid__empty",role:"status","aria-live":"polite"},he={key:2,class:"asset-grid__grid",role:"grid","aria-label":"Collection assets"},me=["onClick","onKeydown","aria-label"],_e={class:"asset-grid__thumbnail"},ye=["src","alt"],ge={key:1,class:"asset-grid__placeholder"},Ce={class:"asset-grid__info"},be=["title"],ke={class:"asset-grid__meta"},we=L(p({__name:"AssetGrid",props:{collectionId:{}},emits:["asset-click"],setup(e,{emit:l}){const t=e,o=l,i=d([]),a=d(!1),n=e=>{if(0===e)return"0 Bytes";const l=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,l)*100)/100+" "+["Bytes","KB","MB","GB"][l]},s=()=>c(this,null,function*(){if("number"==typeof t.collectionId){a.value=!0;try{const e=yield J.getCollection(t.collectionId);i.value=e.assets||[]}catch(e){i.value=[]}finally{a.value=!1}}else i.value=[]}),r=e=>{o("asset-click",e)};return D(()=>{s()}),(e,l)=>(g(),f("div",de,[a.value?(g(),f("div",ve,[(g(),f(m,null,_(8,e=>h("div",{key:e,class:"asset-grid__skeleton","aria-label":`Loading asset ${e}`},null,8,pe)),64))])):0===i.value.length?(g(),f("div",fe,[...l[0]||(l[0]=[h("svg",{class:"w-16 h-16 text-neutral-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),h("p",{class:"asset-grid__empty-text"},"No assets in this collection",-1)])])):(g(),f("div",he,[(g(!0),f(m,null,_(i.value,e=>(g(),f("div",{key:e.id,class:"asset-grid__item",role:"gridcell",onClick:l=>r(e.id),onKeydown:[b(l=>r(e.id),["enter"]),b(k(l=>r(e.id),["prevent"]),["space"])],tabindex:"0","aria-label":`Asset ${e.label||e.filename}`},[h("div",_e,[e.thumbnail_url?(g(),f("img",{key:0,src:e.thumbnail_url,alt:e.label||e.filename,class:"asset-grid__image",loading:"lazy"},null,8,ye)):(g(),f("div",ge,[...l[1]||(l[1]=[h("svg",{class:"w-12 h-12 text-neutral-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])]))]),h("div",Ce,[h("p",{class:"asset-grid__name",title:e.label||e.filename},x(e.label||e.filename),9,be),h("p",ke,x(n(e.size)),1)])],40,me))),128))]))]))}}),[["__scopeId","data-v-1c9dc2c0"]]),xe={class:"form-group"},Me={class:"form-group"},Ne={class:"form-group"},Se={key:0,class:"alert alert--error"},je=L(p({__name:"CreateCollectionModal",props:{parentId:{}},emits:["submit","close"],setup(e,{emit:l}){const t=e,o=l,i=d(!1),a=d(""),n=$({}),s=$({name:"",description:"",visibility:"private"}),r=[{value:"private",label:"Private (only me)"},{value:"shared",label:"Shared (selected users)"},{value:"public",label:"Public (all users)"}],c=()=>{if(Object.keys(n).forEach(e=>delete n[e]),a.value="",s.name.trim()?s.name.length>255?(n.name="Collection name must be 255 characters or less",0):s.visibility||(n.visibility="Visibility is required",0):(n.name="Collection name is required",0)){i.value=!0,a.value="";try{const e={name:s.name.trim(),description:s.description.trim()||void 0,parent_id:t.parentId||null,visibility:s.visibility};o("submit",e)}catch(e){a.value=e.message||"Failed to create collection"}finally{i.value=!1}}};return(e,l)=>(g(),N(K,{"is-open":!0,title:"Create Collection",onClose:l[4]||(l[4]=l=>e.$emit("close")),size:"md"},{footer:M(()=>[C(q,{variant:"ghost",onClick:l[3]||(l[3]=l=>e.$emit("close")),type:"button"},{default:M(()=>[...l[6]||(l[6]=[B(" Cancel ",-1)])]),_:1}),C(q,{variant:"primary",onClick:c,loading:i.value,type:"submit"},{default:M(()=>[...l[7]||(l[7]=[B(" Create Collection ",-1)])]),_:1},8,["loading"])]),default:M(()=>[h("form",{onSubmit:k(c,["prevent"]),class:"create-collection-form"},[h("div",xe,[C(W,{modelValue:s.name,"onUpdate:modelValue":l[0]||(l[0]=e=>s.name=e),label:"Collection Name",placeholder:"e.g., Spring 2025 Campaign",required:"",error:n.name,hint:"1-255 characters",autocomplete:"off"},null,8,["modelValue","error"])]),h("div",Me,[l[5]||(l[5]=h("label",{class:"form-label"},"Description",-1)),E(h("textarea",{"onUpdate:modelValue":l[1]||(l[1]=e=>s.description=e),class:"form-textarea",rows:"3",placeholder:"Optional description for this collection"},null,512),[[I,s.description]])]),h("div",Ne,[C(G,{modelValue:s.visibility,"onUpdate:modelValue":l[2]||(l[2]=e=>s.visibility=e),options:r,label:"Visibility",required:"",error:n.visibility},null,8,["modelValue","error"])]),a.value?(g(),f("div",Se,[h("p",null,x(a.value),1)])):S("",!0)],32)]),_:1}))}}),[["__scopeId","data-v-c480c782"]]),De={class:"form-group"},$e={class:"form-group"},Ee={key:0,class:"alert alert--error"},Ie=L(p({__name:"RenameCollectionModal",props:{collection:{}},emits:["submit","close"],setup(e,{emit:l}){const t=e,o=l,i=d(!1),a=d(""),n=$({}),s=$({name:t.collection.name,description:t.collection.description||""});T(()=>t.collection,e=>{s.name=e.name,s.description=e.description||""},{immediate:!0});const r=()=>{if(Object.keys(n).forEach(e=>delete n[e]),a.value="",s.name.trim()?!(s.name.length>255&&(n.name="Collection name must be 255 characters or less",1)):(n.name="Collection name is required",0)){i.value=!0,a.value="";try{const e={name:s.name.trim(),description:s.description.trim()||void 0};o("submit",e)}catch(e){a.value=e.message||"Failed to update collection"}finally{i.value=!1}}};return(e,l)=>(g(),N(K,{"is-open":!0,title:"Rename Collection",onClose:l[3]||(l[3]=l=>e.$emit("close")),size:"md"},{footer:M(()=>[C(q,{variant:"ghost",onClick:l[2]||(l[2]=l=>e.$emit("close")),type:"button"},{default:M(()=>[...l[5]||(l[5]=[B(" Cancel ",-1)])]),_:1}),C(q,{variant:"primary",onClick:r,loading:i.value,type:"submit"},{default:M(()=>[...l[6]||(l[6]=[B(" Update Collection ",-1)])]),_:1},8,["loading"])]),default:M(()=>[h("form",{onSubmit:k(r,["prevent"]),class:"rename-collection-form"},[h("div",De,[C(W,{modelValue:s.name,"onUpdate:modelValue":l[0]||(l[0]=e=>s.name=e),label:"Collection Name",placeholder:"e.g., Spring 2025 Campaign",required:"",error:n.name,hint:"1-255 characters",autocomplete:"off"},null,8,["modelValue","error"])]),h("div",$e,[l[4]||(l[4]=h("label",{class:"form-label"},"Description",-1)),E(h("textarea",{"onUpdate:modelValue":l[1]||(l[1]=e=>s.description=e),class:"form-textarea",rows:"3",placeholder:"Optional description for this collection"},null,512),[[I,s.description]])]),a.value?(g(),f("div",Ee,[h("p",null,x(a.value),1)])):S("",!0)],32)]),_:1}))}}),[["__scopeId","data-v-f2b921f2"]]),Be={class:"collections-page"},Te={class:"collections-page__layout"},Oe={id:"collections-sidebar",class:"collections-page__sidebar","aria-label":"Collections navigation"},Ve={class:"special-collections"},ze=["onClick","aria-label"],Pe={class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},Fe={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"},Ae={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},He={key:2,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"},Le={key:3,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8.684 13.342C8.885 12.938 9 12.482 9 12c0-.482-.115-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"},qe={key:4,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 002 2h2.945M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},Re={class:"special-collections__label"},Ue={class:"special-collections__count"},Ke={id:"collections-main",class:"collections-page__content","aria-label":"Collections content"},We={class:"collections-toolbar"},Ge={class:"collections-toolbar__actions"},Ye={key:0,class:"collections-empty"},Je={key:1,class:"collections-content"},Qe={class:"collections-header"},Xe={class:"collections-header__title"},Ze={key:0,class:"collections-header__description"},el={class:"collections-header__count"},ll=L(p({__name:"CollectionsPage",setup(e){const l=V(),t=O(),o=F(),i=Q(),a=A(),n=d(null),u=d(!1),p=d(!1),y=d(!1),b=d(!1),k=d(0),j=d(0),$=v(()=>i.collectionsTree),E=v(()=>i.currentCollection),I=v(()=>Array.from(i.expandedNodes)),T=v(()=>i.draggedCollection),z=v(()=>i.canCreateCollection),P=v(()=>i.canDeleteCollection),H=v(()=>i.canEditCollection),L=v(()=>{var e,l,t,a;const n=[];return i.favorites.length>0&&n.push({id:"favorites",name:"Favorites",description:"",parent_id:null,is_favorite:!1,is_shared:!1,visibility:"private",asset_count:i.favorites.reduce((e,l)=>e+l.asset_count,0),created_by:(null==(e=o.user)?void 0:e.id)||0,created_at:"",updated_at:"",cover_image_id:null,type:"favorites"}),i.recentCollections.length>0&&n.push({id:"recent",name:"Recent",description:"",parent_id:null,is_favorite:!1,is_shared:!1,visibility:"private",asset_count:i.recentCollections.reduce((e,l)=>e+l.asset_count,0),created_by:(null==(l=o.user)?void 0:l.id)||0,created_at:"",updated_at:"",cover_image_id:null,type:"recent"}),i.sharedWithMe.length>0&&n.push({id:"shared_with_me",name:"Shared with Me",description:"",parent_id:null,is_favorite:!1,is_shared:!0,visibility:"shared",asset_count:i.sharedWithMe.reduce((e,l)=>e+l.asset_count,0),created_by:(null==(t=o.user)?void 0:t.id)||0,created_at:"",updated_at:"",cover_image_id:null,type:"shared_with_me"}),i.publicCollections.length>0&&n.push({id:"public_collections",name:"Public Collections",description:"",parent_id:null,is_favorite:!1,is_shared:!1,visibility:"public",asset_count:i.publicCollections.reduce((e,l)=>e+l.asset_count,0),created_by:(null==(a=o.user)?void 0:a.id)||0,created_at:"",updated_at:"",cover_image_id:null,type:"public_collections"}),n}),R=v(()=>!!n.value&&"string"==typeof n.value),K=v(()=>{const e=[{label:"Collections",to:"/collections"}];if(n.value&&"number"==typeof n.value){i.breadcrumbs(n.value).forEach(l=>{e.push({label:l.name,to:`/collections/${l.id}`})})}else if(n.value){const l=L.value.find(e=>e.id===n.value);l&&e.push({label:l.name,to:null})}return e}),W=()=>c(this,null,function*(){const e=++k.value;b.value=!0;try{if(yield i.fetchCollections(),yield i.fetchSpecialCollections(),e!==k.value)return;if(!n.value){const e=i.rootCollections[0];e&&(yield X(e))}}catch(l){a.addNotification({type:"error",title:"Error",message:"Failed to load collections"})}finally{b.value=!1}}),G=e=>c(this,null,function*(){++j.value;n.value=e.id,yield i.fetchCollection(e.id),j.value}),J=e=>c(this,null,function*(){var l;try{n.value=e.id;let t=[];switch(e.type){case"favorites":t=i.favorites.flatMap(e=>(e.asset_count,[]));break;case"recent":t=i.recentCollections.flatMap(e=>(e.asset_count,[]));break;case"shared_with_me":t=i.sharedWithMe.flatMap(e=>(e.asset_count,[]));break;case"public_collections":t=i.publicCollections.flatMap(e=>(e.asset_count,[]))}i.setCurrentCollection({id:e.id,name:e.name,description:e.description||"",parent_id:null,is_favorite:"favorites"===e.type,is_shared:"shared_with_me"===e.type||"public_collections"===e.type,visibility:e.visibility,asset_count:e.asset_count,created_by:(null==(l=o.user)?void 0:l.id)||0,created_at:"",updated_at:"",cover_image_id:null})}catch(t){a.addNotification({type:"error",title:"Error",message:"Failed to load special collection"})}}),X=e=>{G(e)},Z=e=>{i.toggleNodeExpanded(e)},ee=e=>{i.setDraggedCollection(e)},le=(e,l)=>c(this,null,function*(){var t;const o=null==(t=i.draggedCollection)?void 0:t.id;if(o&&"number"==typeof o)if(o!==e.id)try{yield i.moveCollection(o,e.id,void 0!==l?l:e.id),a.addNotification({type:"success",title:"Success",message:"Collection moved successfully"}),yield W()}catch(n){a.addNotification({type:"error",title:"Error",message:"Failed to move collection"})}finally{i.setDraggedCollection(null)}else i.setDraggedCollection(null)}),te=()=>c(this,null,function*(){if(E.value&&"number"==typeof E.value.id)try{yield i.toggleFavorite(E.value.id),a.addNotification({type:"success",title:"Success",message:E.value.is_favorite?"Removed from favorites":"Added to favorites"})}catch(e){a.addNotification({type:"error",title:"Error",message:"Failed to toggle favorite"})}}),oe=e=>c(this,null,function*(){var l;try{yield i.createCollection(r(s({},e),{parent_id:(null==(l=E.value)?void 0:l.id)||null,visibility:e.visibility||"private"})),u.value=!1,a.addNotification({type:"success",title:"Success",message:"Collection created successfully"}),yield W()}catch(t){a.addNotification({type:"error",title:"Error",message:"Failed to create collection"})}}),ie=e=>c(this,null,function*(){if(E.value)try{yield i.updateCollection(E.value.id,e),p.value=!1,a.addNotification({type:"success",title:"Success",message:"Collection renamed successfully"}),yield W()}catch(l){a.addNotification({type:"error",title:"Error",message:"Failed to rename collection"})}}),ae=()=>c(this,null,function*(){if(E.value&&"number"==typeof E.value.id)try{yield i.deleteCollection(E.value.id),y.value=!1,n.value=null,a.addNotification({type:"success",title:"Success",message:"Collection deleted successfully"}),yield W()}catch(e){a.addNotification({type:"error",title:"Error",message:"Failed to delete collection"})}}),ne=e=>{l.push({name:"asset-detail",params:{id:e}})};return D(()=>c(this,null,function*(){if(t.params.id){const e="string"==typeof t.params.id?parseInt(t.params.id):parseInt(t.params.id[0]);isNaN(e)||(yield i.fetchCollection(e),n.value=e)}else yield W()})),(e,l)=>{var t;return g(),f("div",Be,[l[12]||(l[12]=h("a",{href:"#collections-main",class:"skip-link"},"Skip to main content",-1)),l[13]||(l[13]=h("a",{href:"#collections-sidebar",class:"skip-link"},"Skip to sidebar",-1)),l[14]||(l[14]=h("div",{class:"collections-page__header"},[h("h1",{class:"collections-page__title"},"Collections")],-1)),h("div",Te,[h("aside",Oe,[h("div",Ve,[(g(!0),f(m,null,_(L.value,e=>(g(),f("button",{key:e.id,class:w(["special-collections__item",{"special-collections__item--active":n.value===e.id}]),onClick:l=>J(e),"aria-label":`Select ${e.name} collection`},[(g(),f("svg",Pe,["favorites"===e.type?(g(),f("path",Fe)):"recent"===e.type?(g(),f("path",Ae)):"my_uploads"===e.type?(g(),f("path",He)):"shared_with_me"===e.type?(g(),f("path",Le)):(g(),f("path",qe))])),h("span",Re,x(e.name),1),h("span",Ue,x(e.asset_count),1)],10,ze))),128))]),l[6]||(l[6]=h("div",{class:"collections-sidebar__divider"},null,-1)),C(ue,{collections:$.value,"expanded-nodes":I.value,"selected-collection-id":n.value,"dragged-collection":T.value,onSelect:G,onToggleExpand:Z,onDragStart:ee,onDrop:le},null,8,["collections","expanded-nodes","selected-collection-id","dragged-collection"])]),h("main",Ke,[h("div",We,[C(U,{items:K.value},null,8,["items"]),h("div",Ge,[z.value?(g(),N(q,{key:0,variant:"primary",onClick:l[0]||(l[0]=e=>u.value=!0),"aria-label":"Create new collection"},{default:M(()=>[...l[7]||(l[7]=[h("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),B(" New Collection ",-1)])]),_:1})):S("",!0),E.value&&!R.value&&H.value?(g(),N(q,{key:1,variant:"secondary",onClick:l[1]||(l[1]=e=>p.value=!0),"aria-label":"Rename collection"},{default:M(()=>[...l[8]||(l[8]=[h("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),B(" Rename ",-1)])]),_:1})):S("",!0),E.value?(g(),N(q,{key:2,variant:"secondary",onClick:te,"aria-label":E.value.is_favorite?"Remove from favorites":"Add to favorites"},{default:M(()=>[(g(),f("svg",{class:w(["w-5 h-5",{"fill-current":E.value.is_favorite}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[...l[9]||(l[9]=[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"},null,-1)])],2))]),_:1},8,["aria-label"])):S("",!0),E.value&&!R.value&&P.value?(g(),N(q,{key:3,variant:"secondary",onClick:l[2]||(l[2]=e=>y.value=!0),"aria-label":"Delete collection"},{default:M(()=>[...l[10]||(l[10]=[h("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),B(" Delete ",-1)])]),_:1})):S("",!0)])]),E.value?(g(),f("div",Je,[h("div",Qe,[h("h2",Xe,x(E.value.name),1),E.value.description?(g(),f("p",Ze,x(E.value.description),1)):S("",!0),h("span",el,x(E.value.asset_count)+" asset"+x(1!==E.value.asset_count?"s":""),1)]),C(we,{"collection-id":(R.value,E.value.id),onAssetClick:ne},null,8,["collection-id"])])):(g(),f("div",Ye,[...l[11]||(l[11]=[h("svg",{class:"w-16 h-16 text-neutral-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})],-1),h("p",{class:"collections-empty__text"}," Select a collection to view assets ",-1)])]))])]),u.value?(g(),N(je,{key:0,"parent-id":(null==(t=E.value)?void 0:t.id)||null,onSubmit:oe,onClose:l[3]||(l[3]=e=>u.value=!1)},null,8,["parent-id"])):S("",!0),p.value&&E.value?(g(),N(Ie,{key:1,collection:E.value,onSubmit:ie,onClose:l[4]||(l[4]=e=>p.value=!1)},null,8,["collection"])):S("",!0),y.value&&E.value?(g(),N(Y,{key:2,title:`Delete collection: ${E.value.name}`,message:"This will also delete all child collections. Are you sure?",onConfirm:ae,onCancel:l[5]||(l[5]=e=>y.value=!1)},null,8,["title"])):S("",!0)])}}}),[["__scopeId","data-v-4454b01f"]]);export{ll as default};
//# sourceMappingURL=CollectionsPage-CdRC1CLp.js.map

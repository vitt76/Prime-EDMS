{"version":3,"file":"CollectionsPage-B0mAQDPz.js","sources":["../../src/services/collectionsService.ts","../../src/stores/collectionsStore.ts","../../src/components/collections/CollectionTree.vue","../../src/components/collections/AssetGrid.vue","../../src/components/collections/CreateCollectionModal.vue","../../src/components/collections/RenameCollectionModal.vue","../../src/pages/CollectionsPage.vue"],"sourcesContent":["/**\r\n * Collections Service\r\n *\r\n * Handles collection/folder operations including CRUD, asset assignment,\r\n * tree structure management, and search functionality.\r\n */\r\n\r\nimport { apiService } from './apiService'\r\nimport { withRetry } from '@/utils/retry'\r\n\r\nexport interface Collection {\r\n  id: string\r\n  name: string\r\n  description?: string\r\n  type: 'folder' | 'collection' | 'smart_collection'\r\n  parent_id?: string\r\n  path: string[]\r\n  created_at: string\r\n  updated_at: string\r\n  created_by: string\r\n  permissions: {\r\n    can_read: boolean\r\n    can_write: boolean\r\n    can_delete: boolean\r\n    can_share: boolean\r\n  }\r\n  asset_count?: number\r\n  children?: Collection[]\r\n}\r\n\r\nexport interface CreateCollectionRequest {\r\n  name: string\r\n  description?: string\r\n  type?: 'folder' | 'collection'\r\n  parent_id?: string\r\n}\r\n\r\nexport interface UpdateCollectionRequest {\r\n  name?: string\r\n  description?: string\r\n  parent_id?: string\r\n}\r\n\r\nexport interface CollectionsQuery {\r\n  parent_id?: string\r\n  type?: string\r\n  search?: string\r\n  include_tree?: boolean\r\n  include_permissions?: boolean\r\n  limit?: number\r\n  offset?: number\r\n}\r\n\r\nexport interface AddAssetsToCollectionRequest {\r\n  collection_id: string\r\n  asset_ids: string[]\r\n  position?: number\r\n}\r\n\r\nexport interface CollectionAssetsQuery {\r\n  collection_id: string\r\n  limit?: number\r\n  offset?: number\r\n  sort_by?: 'name' | 'created_at' | 'updated_at' | 'size'\r\n  sort_order?: 'asc' | 'desc'\r\n}\r\n\r\nclass CollectionsService {\r\n  /**\r\n   * Get collections with optional filtering and tree structure\r\n   */\r\n  async getCollections(query: CollectionsQuery = {}): Promise<Collection[]> {\r\n    const operation = () => apiService.get<Collection[]>('/v4/collections/', {\r\n      params: query as Record<string, any>\r\n    })\r\n    const result = await withRetry(operation)\r\n\r\n    if (!result.success) throw result.error\r\n    return result.data!\r\n  }\r\n\r\n  /**\r\n   * Get single collection by ID\r\n   */\r\n  async getCollection(id: string, includeTree: boolean = false): Promise<Collection> {\r\n    const operation = () => apiService.get<Collection>(`/v4/collections/${id}/`, {\r\n      params: includeTree ? { include_tree: true } : {}\r\n    })\r\n    const result = await withRetry(operation)\r\n\r\n    if (!result.success) throw result.error\r\n    return result.data!\r\n  }\r\n\r\n  /**\r\n   * Create new collection/folder\r\n   */\r\n  async createCollection(data: CreateCollectionRequest): Promise<Collection> {\r\n    const operation = () => apiService.post<Collection>('/v4/collections/', data)\r\n    const result = await withRetry(operation)\r\n\r\n    if (!result.success) throw result.error\r\n    return result.data!\r\n  }\r\n\r\n  /**\r\n   * Update existing collection\r\n   */\r\n  async updateCollection(id: string, data: UpdateCollectionRequest): Promise<Collection> {\r\n    const operation = () => apiService.patch<Collection>(`/v4/collections/${id}/`, data)\r\n    const result = await withRetry(operation)\r\n\r\n    if (!result.success) throw result.error\r\n    return result.data!\r\n  }\r\n\r\n  /**\r\n   * Delete collection\r\n   */\r\n  async deleteCollection(id: string): Promise<void> {\r\n    const operation = () => apiService.delete(`/v4/collections/${id}/`)\r\n    const result = await withRetry(operation)\r\n\r\n    if (!result.success) throw result.error\r\n  }\r\n\r\n  /**\r\n   * Move collection to new parent\r\n   */\r\n  async moveCollection(id: string, newParentId: string | null): Promise<Collection> {\r\n    const operation = () => apiService.post<Collection>(`/v4/collections/${id}/move/`, {\r\n      parent_id: newParentId\r\n    })\r\n    const result = await withRetry(operation)\r\n\r\n    if (!result.success) throw result.error\r\n    return result.data!\r\n  }\r\n\r\n  /**\r\n   * Get assets in a collection\r\n   */\r\n  async getCollectionAssets(query: CollectionAssetsQuery) {\r\n    const { collection_id, ...params } = query\r\n    const operation = () => apiService.get(`/v4/collections/${collection_id}/assets/`, { params })\r\n    const result = await withRetry(operation)\r\n\r\n    if (!result.success) throw result.error\r\n    return result.data!\r\n  }\r\n\r\n  /**\r\n   * Add assets to collection\r\n   */\r\n  async addAssetsToCollection(collectionId: string, assetIds: string[], position?: number): Promise<void> {\r\n    const operation = () => apiService.post(`/v4/collections/${collectionId}/assets/`, {\r\n      asset_ids: assetIds,\r\n      position\r\n    })\r\n    const result = await withRetry(operation)\r\n\r\n    if (!result.success) throw result.error\r\n  }\r\n\r\n  /**\r\n   * Remove assets from collection\r\n   */\r\n  async removeAssetsFromCollection(collectionId: string, assetIds: string[]): Promise<void> {\r\n    const operation = () => apiService.delete(`/v4/collections/${collectionId}/assets/`, {\r\n      data: { asset_ids: assetIds }\r\n    })\r\n    const result = await withRetry(operation)\r\n\r\n    if (!result.success) throw result.error\r\n  }\r\n\r\n  /**\r\n   * Reorder assets in collection\r\n   */\r\n  async reorderCollectionAssets(collectionId: string, assetIds: string[]): Promise<void> {\r\n    const operation = () => apiService.post(`/v4/collections/${collectionId}/assets/reorder/`, {\r\n      asset_ids: assetIds\r\n    })\r\n    const result = await withRetry(operation)\r\n\r\n    if (!result.success) throw result.error\r\n  }\r\n\r\n  /**\r\n   * Search collections\r\n   */\r\n  async searchCollections(query: string, options: {\r\n    type?: string\r\n    parent_id?: string\r\n    limit?: number\r\n  } = {}): Promise<Collection[]> {\r\n    const operation = () => apiService.get<Collection[]>('/v4/collections/search/', {\r\n      params: { q: query, ...options }\r\n    })\r\n    const result = await withRetry(operation)\r\n\r\n    if (!result.success) throw result.error\r\n    return result.data!\r\n  }\r\n\r\n  /**\r\n   * Get collection tree structure (nested)\r\n   */\r\n  async getCollectionTree(rootParentId?: string): Promise<Collection[]> {\r\n    const operation = () => apiService.get<Collection[]>('/v4/collections/tree/', {\r\n      params: rootParentId ? { parent_id: rootParentId } : {}\r\n    })\r\n    const result = await withRetry(operation)\r\n\r\n    if (!result.success) throw result.error\r\n    return result.data!\r\n  }\r\n\r\n  /**\r\n   * Duplicate collection\r\n   */\r\n  async duplicateCollection(id: string, newName?: string, newParentId?: string): Promise<Collection> {\r\n    const operation = () => apiService.post<Collection>(`/v4/collections/${id}/duplicate/`, {\r\n      name: newName,\r\n      parent_id: newParentId\r\n    })\r\n    const result = await withRetry(operation)\r\n\r\n    if (!result.success) throw result.error\r\n    return result.data!\r\n  }\r\n\r\n  /**\r\n   * Get collection statistics\r\n   */\r\n  async getCollectionStats(id: string): Promise<{\r\n    total_assets: number\r\n    total_size: number\r\n    asset_types: Record<string, number>\r\n    recent_activity: any[]\r\n    permissions: any[]\r\n  }> {\r\n    const operation = () => apiService.get(`/v4/collections/${id}/stats/`)\r\n    const result = await withRetry(operation)\r\n\r\n    if (!result.success) throw result.error\r\n    return result.data!\r\n  }\r\n\r\n  /**\r\n   * Export collection\r\n   */\r\n  async exportCollection(id: string, format: 'zip' | 'csv' | 'json' = 'zip'): Promise<string> {\r\n    const operation = () => apiService.post<{ download_url: string }>(`/v4/collections/${id}/export/`, {\r\n      format\r\n    })\r\n    const result = await withRetry(operation)\r\n\r\n    if (!result.success) throw result.error\r\n    return result.data!.download_url\r\n  }\r\n\r\n  /**\r\n   * Share collection (create share link)\r\n   */\r\n  async shareCollection(id: string, shareOptions: {\r\n    permissions: {\r\n      view: boolean\r\n      download: boolean\r\n      edit: boolean\r\n    }\r\n    expiration?: Date\r\n    password?: string\r\n    recipients?: string[]\r\n    isPublic?: boolean\r\n  }): Promise<{\r\n    share_url: string\r\n    share_id: string\r\n    expires_at?: string\r\n  }> {\r\n    const operation = () => apiService.post(`/v4/collections/${id}/share/`, shareOptions)\r\n    const result = await withRetry(operation)\r\n\r\n    if (!result.success) throw result.error\r\n    return result.data!\r\n  }\r\n\r\n  /**\r\n   * Get collection share links\r\n   */\r\n  async getCollectionShares(id: string): Promise<Array<{\r\n    id: string\r\n    share_url: string\r\n    created_at: string\r\n    expires_at?: string\r\n    permissions: any\r\n    is_active: boolean\r\n  }>> {\r\n    const operation = () => apiService.get(`/v4/collections/${id}/shares/`)\r\n    const result = await withRetry(operation)\r\n\r\n    if (!result.success) throw result.error\r\n    return result.data!\r\n  }\r\n\r\n  /**\r\n   * Revoke collection share\r\n   */\r\n  async revokeCollectionShare(collectionId: string, shareId: string): Promise<void> {\r\n    const operation = () => apiService.delete(`/v4/collections/${collectionId}/shares/${shareId}/`)\r\n    const result = await withRetry(operation)\r\n\r\n    if (!result.success) throw result.error\r\n  }\r\n\r\n  /**\r\n   * Bulk operations on collections\r\n   */\r\n  async bulkDelete(collectionIds: string[]): Promise<void> {\r\n    const operation = () => apiService.post('/v4/collections/bulk/delete/', {\r\n      collection_ids: collectionIds\r\n    })\r\n    const result = await withRetry(operation)\r\n\r\n    if (!result.success) throw result.error\r\n  }\r\n\r\n  async bulkMove(collectionIds: string[], newParentId: string | null): Promise<void> {\r\n    const operation = () => apiService.post('/v4/collections/bulk/move/', {\r\n      collection_ids: collectionIds,\r\n      parent_id: newParentId\r\n    })\r\n    const result = await withRetry(operation)\r\n\r\n    if (!result.success) throw result.error\r\n  }\r\n}\r\n\r\nexport const collectionsService = new CollectionsService()","import { defineStore } from 'pinia'\r\nimport { ref, computed } from 'vue'\r\nimport { collectionsService } from '@/services/collectionsService'\r\nimport { formatApiError } from '@/utils/errors'\r\nimport { extractErrorCode } from '@/utils/errorHandling'\r\nimport { useAuthStore } from './authStore'\r\nimport { useUIStore } from './uiStore'\r\nimport type {\r\n  Collection,\r\n  CollectionTree,\r\n  CollectionBreadcrumb,\r\n  CreateCollectionRequest,\r\n  UpdateCollectionRequest,\r\n  MoveCollectionRequest,\r\n  BulkCollectionOperation,\r\n  BulkOperationResponse,\r\n  GetCollectionsParams,\r\n  PaginatedCollections,\r\n  SpecialCollectionsResponse,\r\n  SpecialCollectionType\r\n} from '@/types/collections'\r\n\r\nconst CACHE_TTL = 5 * 60 * 1000 // 5 minutes in milliseconds\r\nconst MAX_BULK_OPERATION_SIZE = 50\r\n\r\nexport const useCollectionsStore = defineStore(\r\n  'collections',\r\n  () => {\r\n    const authStore = useAuthStore()\r\n    const uiStore = useUIStore()\r\n\r\n    const collectionRequestIds = ref({\r\n      collections: 0,\r\n      collection: 0\r\n    })\r\n\r\n    const startCollectionRequest = (\r\n      key: keyof typeof collectionRequestIds.value\r\n    ): number => {\r\n      const nextId = (collectionRequestIds.value[key] ?? 0) + 1\r\n      collectionRequestIds.value = {\r\n        ...collectionRequestIds.value,\r\n        [key]: nextId\r\n      }\r\n      return nextId\r\n    }\r\n\r\n    const isLatestCollectionRequest = (\r\n      key: keyof typeof collectionRequestIds.value,\r\n      id: number\r\n    ): boolean => collectionRequestIds.value[key] === id\r\n\r\n    const logCollectionError = (context: string, error: unknown): string => {\r\n      const message = formatApiError(error)\r\n      const code = extractErrorCode(error)\r\n      console.warn(`${context} failed`, { code, error })\r\n      uiStore.addNotification({\r\n        type: 'error',\r\n        title: `${context} Error`,\r\n        message,\r\n        meta: code ? { code } : undefined\r\n      })\r\n      return message\r\n    }\r\n\r\n    // Collections state\r\n    const collections = ref<Collection[]>([])\r\n    const currentCollection = ref<Collection | null>(null)\r\n    const collectionsTree = ref<CollectionTree[]>([])\r\n    const selectedCollections = ref<number[]>([])\r\n    const totalCollectionsCount = ref(0)\r\n\r\n    // Special collections state\r\n    const favorites = ref<Collection[]>([])\r\n    const recentCollections = ref<Collection[]>([])\r\n    const sharedWithMe = ref<Collection[]>([])\r\n    const myUploads = ref<Collection[]>([])\r\n    const publicCollections = ref<Collection[]>([])\r\n\r\n    // UI state\r\n    const expandedNodes = ref<Set<number>>(new Set())\r\n    const draggedCollection = ref<Collection | null>(null)\r\n\r\n    // Global state\r\n    const isLoading = ref(false)\r\n    const error = ref<string | null>(null)\r\n    const lastFetchTime = ref<number | null>(null)\r\n\r\n    // Computed properties - Permissions\r\n    const canCreateCollection = computed(() => {\r\n      return authStore.hasPermission.value('collections.create')\r\n    })\r\n\r\n    const canDeleteCollection = computed(() => {\r\n      return authStore.hasPermission.value('collections.delete')\r\n    })\r\n\r\n    const canEditCollection = computed(() => {\r\n      return authStore.hasPermission.value('collections.edit')\r\n    })\r\n\r\n    const canShareCollection = computed(() => {\r\n      return authStore.hasPermission.value('collections.share')\r\n    })\r\n\r\n    // Computed properties - Tree structure\r\n    const rootCollections = computed(() => {\r\n      return collections.value.filter((c) => c.parent_id === null)\r\n    })\r\n\r\n    const flattenedTree = computed(() => {\r\n      const result: Collection[] = []\r\n      const flatten = (nodes: CollectionTree[]): void => {\r\n        for (const node of nodes) {\r\n          result.push(node.collection)\r\n          if (node.children.length > 0) {\r\n            flatten(node.children)\r\n          }\r\n        }\r\n      }\r\n      flatten(collectionsTree.value)\r\n      return result\r\n    })\r\n\r\n    // Computed - Breadcrumbs\r\n    const breadcrumbs = computed(() => {\r\n      return (collectionId: number): CollectionBreadcrumb[] => {\r\n        const result: CollectionBreadcrumb[] = []\r\n        const collection = collections.value.find((c) => c.id === collectionId)\r\n\r\n        if (!collection) return result\r\n\r\n        const buildPath = (id: number, level: number): void => {\r\n          const coll = collections.value.find((c) => c.id === id)\r\n          if (coll) {\r\n            if (coll.parent_id) {\r\n              buildPath(coll.parent_id, level - 1)\r\n            }\r\n            result.push({\r\n              id: coll.id,\r\n              name: coll.name,\r\n              level\r\n            })\r\n          }\r\n        }\r\n\r\n        buildPath(collectionId, 0)\r\n        return result\r\n      }\r\n    })\r\n\r\n    // Actions - Fetch collections\r\n    async function fetchCollections(\r\n      params?: GetCollectionsParams\r\n    ): Promise<void> {\r\n      const now = Date.now()\r\n      if (\r\n        lastFetchTime.value &&\r\n        now - lastFetchTime.value < CACHE_TTL &&\r\n        collections.value.length > 0\r\n      ) {\r\n        return\r\n      }\r\n\r\n      const key: keyof typeof collectionRequestIds.value = 'collections'\r\n      const requestId = startCollectionRequest(key)\r\n      isLoading.value = true\r\n      error.value = null\r\n\r\n      try {\r\n        const response: PaginatedCollections =\r\n          await collectionsService.getCollections(params)\r\n\r\n        if (!isLatestCollectionRequest(key, requestId)) {\r\n          return\r\n        }\r\n\r\n        collections.value = response.results\r\n        totalCollectionsCount.value = response.count\r\n        lastFetchTime.value = Date.now()\r\n\r\n        collectionsTree.value = buildCollectionTree(collections.value)\r\n      } catch (err) {\r\n        if (!isLatestCollectionRequest(key, requestId)) {\r\n          return\r\n        }\r\n        const message = logCollectionError('Collections list fetch', err)\r\n        error.value = message\r\n        collections.value = []\r\n        totalCollectionsCount.value = 0\r\n        collectionsTree.value = []\r\n        throw err\r\n      } finally {\r\n        if (isLatestCollectionRequest(key, requestId)) {\r\n          isLoading.value = false\r\n        }\r\n      }\r\n    }\r\n\r\n    // Actions - Fetch single collection\r\n    async function fetchCollection(id: number): Promise<Collection> {\r\n      const key: keyof typeof collectionRequestIds.value = 'collection'\r\n      const requestId = startCollectionRequest(key)\r\n      isLoading.value = true\r\n      error.value = null\r\n\r\n      try {\r\n        const collection = await collectionsService.getCollection(id)\r\n\r\n        if (!isLatestCollectionRequest(key, requestId)) {\r\n          return collection\r\n        }\r\n\r\n        currentCollection.value = collection\r\n\r\n        const index = collections.value.findIndex((c) => c.id === id)\r\n        if (index !== -1) {\r\n          collections.value[index] = collection\r\n        } else {\r\n          collections.value.push(collection)\r\n        }\r\n\r\n        collectionsTree.value = buildCollectionTree(collections.value)\r\n\r\n        return collection\r\n      } catch (err) {\r\n        if (!isLatestCollectionRequest(key, requestId)) {\r\n          throw err\r\n        }\r\n        const message = logCollectionError('Collection fetch', err)\r\n        error.value = message\r\n        currentCollection.value = null\r\n        throw err\r\n      } finally {\r\n        if (isLatestCollectionRequest(key, requestId)) {\r\n          isLoading.value = false\r\n        }\r\n      }\r\n    }\r\n\r\n    // Actions - Create collection\r\n    async function createCollection(\r\n      data: CreateCollectionRequest\r\n    ): Promise<Collection> {\r\n      isLoading.value = true\r\n      error.value = null\r\n\r\n      try {\r\n        const newCollection = await collectionsService.createCollection(data)\r\n        collections.value.push(newCollection)\r\n        totalCollectionsCount.value++\r\n\r\n        collectionsTree.value = buildCollectionTree(collections.value)\r\n        invalidateCache()\r\n\r\n        return newCollection\r\n      } catch (err) {\r\n        error.value = formatApiError(err)\r\n        throw err\r\n      } finally {\r\n        isLoading.value = false\r\n      }\r\n    }\r\n\r\n    // Actions - Update collection\r\n    async function updateCollection(\r\n      id: number,\r\n      data: UpdateCollectionRequest\r\n    ): Promise<Collection> {\r\n      isLoading.value = true\r\n      error.value = null\r\n\r\n      try {\r\n        const updatedCollection = await collectionsService.updateCollection(\r\n          id,\r\n          data\r\n        )\r\n\r\n        // Update in collections array\r\n        const index = collections.value.findIndex((c) => c.id === id)\r\n        if (index !== -1) {\r\n          collections.value[index] = updatedCollection\r\n        }\r\n\r\n        // Update current collection if it's the one being updated\r\n        if (currentCollection.value?.id === id) {\r\n          currentCollection.value = updatedCollection\r\n        }\r\n\r\n        collectionsTree.value = buildCollectionTree(collections.value)\r\n\r\n        invalidateCache()\r\n\r\n        if (data.is_favorite !== undefined) {\r\n          if (data.is_favorite) {\r\n            if (!favorites.value.find((f) => f.id === id)) {\r\n              favorites.value.push(updatedCollection)\r\n            }\r\n          } else {\r\n            favorites.value = favorites.value.filter((f) => f.id !== id)\r\n          }\r\n        }\r\n\r\n        invalidateCache()\r\n\r\n        return updatedCollection\r\n      } catch (err) {\r\n        error.value = formatApiError(err)\r\n        throw err\r\n      } finally {\r\n        isLoading.value = false\r\n      }\r\n    }\r\n\r\n    // Actions - Delete collection\r\n    async function deleteCollection(id: number): Promise<void> {\r\n      isLoading.value = true\r\n      error.value = null\r\n\r\n      try {\r\n        await collectionsService.deleteCollection(id)\r\n\r\n        // Remove from collections array (and children)\r\n        const removeCollectionAndChildren = (collectionId: number): void => {\r\n          collections.value = collections.value.filter(\r\n            (c) => c.id !== collectionId\r\n          )\r\n          const children = collections.value.filter(\r\n            (c) => c.parent_id === collectionId\r\n          )\r\n          children.forEach((child) => removeCollectionAndChildren(child.id))\r\n        }\r\n\r\n        removeCollectionAndChildren(id)\r\n        totalCollectionsCount.value = collections.value.length\r\n\r\n        // Clear current collection if deleted\r\n        if (currentCollection.value?.id === id) {\r\n          currentCollection.value = null\r\n        }\r\n\r\n        // Remove from selected\r\n        selectedCollections.value = selectedCollections.value.filter(\r\n          (sid) => sid !== id\r\n        )\r\n\r\n        // Remove from favorites\r\n        favorites.value = favorites.value.filter((f) => f.id !== id)\r\n\r\n        // Rebuild tree\r\n        collectionsTree.value = buildCollectionTree(collections.value)\r\n      } catch (err) {\r\n        error.value = formatApiError(err)\r\n        throw err\r\n      } finally {\r\n        isLoading.value = false\r\n      }\r\n    }\r\n\r\n    // Actions - Move collection\r\n    async function moveCollection(\r\n      fromId: number,\r\n      toId: number | null,\r\n      newParentId?: number | null\r\n    ): Promise<Collection> {\r\n      isLoading.value = true\r\n      error.value = null\r\n\r\n      try {\r\n        const targetParentId = newParentId !== undefined ? newParentId : toId\r\n        const movedCollection = await collectionsService.moveCollection(fromId, {\r\n          collection_id: fromId,\r\n          new_parent_id: targetParentId\r\n        })\r\n\r\n        // Update in collections array\r\n        const index = collections.value.findIndex((c) => c.id === fromId)\r\n        if (index !== -1) {\r\n          collections.value[index] = movedCollection\r\n        }\r\n\r\n        collectionsTree.value = buildCollectionTree(collections.value)\r\n\r\n        invalidateCache()\r\n\r\n        return movedCollection\r\n      } catch (err) {\r\n        error.value = formatApiError(err)\r\n        throw err\r\n      } finally {\r\n        isLoading.value = false\r\n      }\r\n    }\r\n\r\n    // Actions - Bulk operation\r\n    async function bulkCollectionOperation(\r\n      operation: BulkCollectionOperation\r\n    ): Promise<BulkOperationResponse> {\r\n      // Validate max size\r\n      if (operation.ids.length > MAX_BULK_OPERATION_SIZE) {\r\n        throw new Error(\r\n          `Maximum ${MAX_BULK_OPERATION_SIZE} collections allowed per bulk operation`\r\n        )\r\n      }\r\n\r\n      isLoading.value = true\r\n      error.value = null\r\n\r\n      try {\r\n        const response = await collectionsService.bulkOperation(operation)\r\n\r\n        invalidateCache()\r\n        await fetchCollections()\r\n\r\n        return response\r\n      } catch (err) {\r\n        error.value = formatApiError(err)\r\n        throw err\r\n      } finally {\r\n        isLoading.value = false\r\n      }\r\n    }\r\n\r\n    // Actions - Toggle favorite\r\n    async function toggleFavorite(id: number): Promise<Collection> {\r\n      isLoading.value = true\r\n      error.value = null\r\n\r\n      try {\r\n        const updatedCollection = await collectionsService.toggleFavorite(id)\r\n\r\n        // Update in collections array\r\n        const index = collections.value.findIndex((c) => c.id === id)\r\n        if (index !== -1) {\r\n          collections.value[index] = updatedCollection\r\n        }\r\n\r\n        // Update current collection if it's the one being toggled\r\n        if (currentCollection.value?.id === id) {\r\n          currentCollection.value = updatedCollection\r\n        }\r\n\r\n        if (updatedCollection.is_favorite) {\r\n          if (!favorites.value.find((f) => f.id === id)) {\r\n            favorites.value.push(updatedCollection)\r\n          }\r\n        } else {\r\n          favorites.value = favorites.value.filter((f) => f.id !== id)\r\n        }\r\n\r\n        invalidateCache()\r\n\r\n        return updatedCollection\r\n      } catch (err) {\r\n        error.value = formatApiError(err)\r\n        throw err\r\n      } finally {\r\n        isLoading.value = false\r\n      }\r\n    }\r\n\r\n    // Actions - Fetch special collections\r\n    async function fetchSpecialCollections(): Promise<void> {\r\n      isLoading.value = true\r\n      error.value = null\r\n\r\n      try {\r\n        const response: SpecialCollectionsResponse =\r\n          await collectionsService.getSpecialCollections()\r\n\r\n        favorites.value = response.favorites\r\n        recentCollections.value = response.recent\r\n        sharedWithMe.value = response.shared_with_me\r\n        myUploads.value = response.my_uploads\r\n        publicCollections.value = response.public_collections\r\n      } catch (err) {\r\n        const message = logCollectionError('Special collections fetch', err)\r\n        error.value = message\r\n        favorites.value = []\r\n        recentCollections.value = []\r\n        sharedWithMe.value = []\r\n        myUploads.value = []\r\n        publicCollections.value = []\r\n        throw err\r\n      } finally {\r\n        isLoading.value = false\r\n      }\r\n    }\r\n\r\n    // Actions - Tree node expansion\r\n    function expandNode(nodeId: number): void {\r\n      expandedNodes.value.add(nodeId)\r\n    }\r\n\r\n    function collapseNode(nodeId: number): void {\r\n      expandedNodes.value.delete(nodeId)\r\n    }\r\n\r\n    function toggleNodeExpanded(nodeId: number): void {\r\n      if (expandedNodes.value.has(nodeId)) {\r\n        expandedNodes.value.delete(nodeId)\r\n      } else {\r\n        expandedNodes.value.add(nodeId)\r\n      }\r\n    }\r\n\r\n    function isNodeExpanded(nodeId: number): boolean {\r\n      return expandedNodes.value.has(nodeId)\r\n    }\r\n\r\n    // Actions - Drag-drop\r\n    function setDraggedCollection(collection: Collection | null): void {\r\n      draggedCollection.value = collection\r\n    }\r\n\r\n    // Actions - Selection\r\n    function selectCollections(ids: number[]): void {\r\n      selectedCollections.value = ids\r\n    }\r\n\r\n    function clearSelection(): void {\r\n      selectedCollections.value = []\r\n    }\r\n\r\n    function toggleSelection(id: number): void {\r\n      const index = selectedCollections.value.indexOf(id)\r\n      if (index === -1) {\r\n        selectedCollections.value.push(id)\r\n      } else {\r\n        selectedCollections.value.splice(index, 1)\r\n      }\r\n    }\r\n\r\n    // Actions - Current collection\r\n    function setCurrentCollection(collection: Collection | null): void {\r\n      currentCollection.value = collection\r\n    }\r\n\r\n    // Helper - Build collection tree\r\n    function buildCollectionTree(\r\n      collectionsList: Collection[]\r\n    ): CollectionTree[] {\r\n      // Sort collections by name alphabetically\r\n      const sorted = [...collectionsList].sort((a, b) =>\r\n        a.name.localeCompare(b.name)\r\n      )\r\n\r\n      // Build a map for quick lookup\r\n      const collectionMap = new Map<number, Collection>()\r\n      sorted.forEach((c) => collectionMap.set(c.id, c))\r\n\r\n      // Build tree structure\r\n      const buildTree = (\r\n        parentId: number | null,\r\n        level: number\r\n      ): CollectionTree[] => {\r\n        const children = sorted.filter((c) => c.parent_id === parentId)\r\n        return children.map((collection) => ({\r\n          collection,\r\n          children: buildTree(collection.id, level + 1),\r\n          level\r\n        }))\r\n      }\r\n\r\n      return buildTree(null, 0)\r\n    }\r\n\r\n    // Actions - Utility\r\n    function clearError(): void {\r\n      error.value = null\r\n    }\r\n\r\n    function invalidateCache(): void {\r\n      // Reset the cache TTL so the next fetch hits the API after mutations.\r\n      lastFetchTime.value = null\r\n    }\r\n\r\n    return {\r\n      // State - Collections\r\n      collections,\r\n      currentCollection,\r\n      collectionsTree,\r\n      selectedCollections,\r\n      totalCollectionsCount,\r\n\r\n      // State - Special collections\r\n      favorites,\r\n      recentCollections,\r\n      sharedWithMe,\r\n      myUploads,\r\n      publicCollections,\r\n\r\n      // State - UI\r\n      expandedNodes,\r\n      draggedCollection,\r\n\r\n      // Global state\r\n      isLoading,\r\n      error,\r\n      lastFetchTime,\r\n\r\n      // Computed - Permissions\r\n      canCreateCollection,\r\n      canDeleteCollection,\r\n      canEditCollection,\r\n      canShareCollection,\r\n\r\n      // Computed - Tree structure\r\n      rootCollections,\r\n      flattenedTree,\r\n      breadcrumbs,\r\n\r\n      // Actions - Collections\r\n      fetchCollections,\r\n      fetchCollection,\r\n      createCollection,\r\n      updateCollection,\r\n      deleteCollection,\r\n      moveCollection,\r\n      bulkCollectionOperation,\r\n      toggleFavorite,\r\n\r\n      // Actions - Special collections\r\n      fetchSpecialCollections,\r\n\r\n      // Actions - Tree nodes\r\n      expandNode,\r\n      collapseNode,\r\n      toggleNodeExpanded,\r\n      isNodeExpanded,\r\n\r\n      // Actions - Drag-drop\r\n      setDraggedCollection,\r\n\r\n      // Actions - Selection\r\n      selectCollections,\r\n      clearSelection,\r\n      toggleSelection,\r\n\r\n      // Actions - Current collection\r\n      setCurrentCollection,\r\n\r\n      // Helper - Tree building\r\n      buildCollectionTree,\r\n\r\n      // Actions - Utility\r\n      clearError,\r\n      invalidateCache\r\n    }\r\n  },\r\n  {\r\n    persist: {\r\n      paths: ['expandedNodes'] // Only persist expanded nodes, not data\r\n    }\r\n  }\r\n)\r\n\r\n\r\n\r\n","<template>\n  <div class=\"collection-tree\">\n    <ul class=\"collection-tree__list\" role=\"tree\" aria-label=\"Collections tree\">\n      <li\n        v-for=\"node in collections\"\n        :key=\"node.collection.id\"\n        class=\"collection-tree__item\"\n        role=\"treeitem\"\n        :aria-expanded=\"expandedNodes.includes(node.collection.id)\"\n        :aria-level=\"node.level + 1\"\n      >\n        <div class=\"collection-tree__row\">\n          <!-- Toggle Button -->\n          <button\n            v-if=\"node.children.length > 0\"\n            class=\"collection-tree__toggle\"\n            @click=\"emit('toggle-expand', node.collection.id)\"\n            :aria-label=\"`${expandedNodes.includes(node.collection.id) ? 'Collapse' : 'Expand'} ${node.collection.name}`\"\n            tabindex=\"0\"\n            :data-testid=\"`collection-toggle-${node.collection.id}`\"\n          >\n            <svg\n              class=\"w-4 h-4\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n              aria-hidden=\"true\"\n            >\n              <path\n                v-if=\"expandedNodes.includes(node.collection.id)\"\n                stroke-linecap=\"round\"\n                stroke-linejoin=\"round\"\n                stroke-width=\"2\"\n                d=\"M19 9l-7 7-7-7\"\n              />\n              <path\n                v-else\n                stroke-linecap=\"round\"\n                stroke-linejoin=\"round\"\n                stroke-width=\"2\"\n                d=\"M9 5l7 7-7 7\"\n              />\n            </svg>\n          </button>\n\n          <div v-else class=\"collection-tree__spacer\" />\n\n          <!-- Collection Button -->\n          <button\n            :class=\"[\n              'collection-tree__button',\n              {\n                'collection-tree__button--active':\n                  selectedCollectionId === node.collection.id,\n                'collection-tree__button--dragging':\n                  draggedCollection?.id === node.collection.id\n              }\n            ]\"\n            :draggable=\"true\"\n            @click=\"emit('select', node.collection)\"\n            @dragstart=\"handleDragStart($event, node.collection)\"\n            @dragover.prevent=\"handleDragOver($event, node.collection)\"\n            @drop=\"handleDrop($event, node.collection)\"\n            @dragend=\"handleDragEnd\"\n            @keydown.enter=\"emit('select', node.collection)\"\n            @keydown.space.prevent=\"emit('select', node.collection)\"\n            @keydown.arrow-left=\"handleArrowLeft(node)\"\n            @keydown.arrow-right=\"handleArrowRight(node)\"\n            :aria-label=\"`Collection ${node.collection.name} with ${node.collection.asset_count} assets`\"\n            :aria-selected=\"selectedCollectionId === node.collection.id\"\n            tabindex=\"0\"\n            :data-testid=\"`collection-node-${node.collection.id}`\"\n          >\n            <svg\n              class=\"w-5 h-5\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n              aria-hidden=\"true\"\n            >\n              <path\n                stroke-linecap=\"round\"\n                stroke-linejoin=\"round\"\n                stroke-width=\"2\"\n                d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"\n              />\n            </svg>\n            <span class=\"collection-tree__name\">{{ node.collection.name }}</span>\n            <span class=\"collection-tree__count\">{{\n              node.collection.asset_count\n            }}</span>\n          </button>\n        </div>\n\n        <!-- Children (recursive) -->\n        <Transition\n          enter-active-class=\"transition-all duration-200 ease-out\"\n          enter-from-class=\"opacity-0 max-h-0\"\n          enter-to-class=\"opacity-100 max-h-96\"\n          leave-active-class=\"transition-all duration-200 ease-in\"\n          leave-from-class=\"opacity-100 max-h-96\"\n          leave-to-class=\"opacity-0 max-h-0\"\n        >\n          <CollectionTree\n            v-if=\"expandedNodes.includes(node.collection.id) && node.children.length > 0\"\n            :collections=\"node.children\"\n            :expanded-nodes=\"expandedNodes\"\n            :selected-collection-id=\"selectedCollectionId\"\n            :dragged-collection=\"draggedCollection\"\n            class=\"collection-tree__children\"\n            @select=\"emit('select', $event)\"\n            @toggle-expand=\"emit('toggle-expand', $event)\"\n            @drag-start=\"emit('drag-start', $event)\"\n            @drop=\"(target: Collection, parent?: number | null) => emit('drop', target, parent)\"\n          />\n        </Transition>\n      </li>\n    </ul>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref } from 'vue'\nimport type { CollectionTree as ICollectionTree, Collection } from '@/types/collections'\n\ninterface Props {\n  collections: ICollectionTree[]\n  expandedNodes: number[]\n  selectedCollectionId: number | string | null\n  draggedCollection: Collection | null\n}\n\nconst props = defineProps<Props>()\n\nconst emit = defineEmits<{\n  select: [collection: Collection]\n  'toggle-expand': [nodeId: number]\n  'drag-start': [collection: Collection]\n  drop: [targetCollection: Collection, newParentId?: number | null]\n}>()\n\nconst dragOverNode = ref<number | null>(null)\n\nconst handleDragStart = (e: DragEvent, collection: Collection): void => {\n  if (e.dataTransfer) {\n    e.dataTransfer.effectAllowed = 'move'\n    e.dataTransfer.setData('text/plain', String(collection.id))\n  }\n  emit('drag-start', collection)\n}\n\nconst handleDragOver = (e: DragEvent, collection: Collection): void => {\n  e.preventDefault()\n  if (e.dataTransfer) {\n    e.dataTransfer.dropEffect = 'move'\n  }\n  dragOverNode.value = collection.id\n}\n\nconst handleDrop = (e: DragEvent, collection: Collection): void => {\n  e.preventDefault()\n  e.stopPropagation()\n  \n  // Determine if dropping on the collection itself (as parent) or as sibling\n  const rect = (e.currentTarget as HTMLElement).getBoundingClientRect()\n  const isDroppingOnCollection = e.offsetY < rect.height / 2\n  \n  emit('drop', collection, isDroppingOnCollection ? collection.id : collection.parent_id)\n  dragOverNode.value = null\n}\n\nconst handleDragEnd = (): void => {\n  dragOverNode.value = null\n}\n\nconst handleArrowLeft = (node: ICollectionTree): void => {\n  // Collapse if expanded\n  if (props.expandedNodes.includes(node.collection.id)) {\n    emit('toggle-expand', node.collection.id)\n  }\n}\n\nconst handleArrowRight = (node: ICollectionTree): void => {\n  // Expand if collapsed and has children\n  if (\n    !props.expandedNodes.includes(node.collection.id) &&\n    node.children.length > 0\n  ) {\n    emit('toggle-expand', node.collection.id)\n  }\n}\n</script>\n\n<style scoped lang=\"css\">\n.collection-tree {\n  width: 100%;\n}\n\n.collection-tree__list {\n  list-style: none;\n  margin: 0;\n  padding: 0;\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n}\n\n.collection-tree__item {\n  display: flex;\n  flex-direction: column;\n  margin: 0;\n}\n\n.collection-tree__row {\n  display: flex;\n  align-items: center;\n  gap: 4px;\n}\n\n.collection-tree__toggle {\n  width: 24px;\n  height: 24px;\n  padding: 0;\n  border: none;\n  background: transparent;\n  color: var(--color-text-secondary, #6b7280);\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: var(--radius-sm, 4px);\n  transition: all 150ms ease;\n  flex-shrink: 0;\n}\n\n.collection-tree__toggle:hover {\n  background: var(--color-bg-1, #f9fafb);\n  color: var(--color-text, #111827);\n}\n\n.collection-tree__toggle:focus-visible {\n  outline: 2px solid var(--color-primary, #3b82f6);\n  outline-offset: 2px;\n}\n\n.collection-tree__button {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 8px 12px;\n  border: none;\n  background: transparent;\n  color: var(--color-text-secondary, #6b7280);\n  cursor: pointer;\n  border-radius: var(--radius-base, 6px);\n  font-size: var(--font-size-base, 14px);\n  text-align: left;\n  transition: all 200ms ease;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  min-width: 0;\n}\n\n.collection-tree__button:hover {\n  background: var(--color-bg-1, #f9fafb);\n  color: var(--color-text, #111827);\n}\n\n.collection-tree__button:focus-visible {\n  outline: 2px solid var(--color-primary, #3b82f6);\n  outline-offset: -2px;\n}\n\n.collection-tree__button--active {\n  background: var(--color-primary, #3b82f6);\n  color: white;\n  font-weight: 600;\n}\n\n.collection-tree__button--active:hover {\n  background: var(--color-primary-dark, #2563eb);\n}\n\n.collection-tree__button--dragging {\n  opacity: 0.5;\n}\n\n.collection-tree__name {\n  flex: 1;\n  min-width: 0;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.collection-tree__count {\n  margin-left: auto;\n  font-size: var(--font-size-sm, 12px);\n  opacity: 0.7;\n  flex-shrink: 0;\n}\n\n.collection-tree__children {\n  margin-left: 24px;\n  border-left: 1px solid var(--color-border, #e5e7eb);\n  padding-left: 8px;\n  margin-top: 2px;\n}\n\n.collection-tree__spacer {\n  width: 24px;\n  flex-shrink: 0;\n}\n\n/* Accessibility */\n@media (prefers-reduced-motion: reduce) {\n  .collection-tree__button,\n  .collection-tree__toggle {\n    transition: none;\n  }\n}\n</style>\n\n","<template>\r\n  <div class=\"asset-grid\">\r\n    <!-- Loading State -->\r\n    <div v-if=\"isLoading\" class=\"asset-grid__loading\" role=\"status\" aria-live=\"polite\">\r\n      <div\r\n        v-for=\"i in 8\"\r\n        :key=\"i\"\r\n        class=\"asset-grid__skeleton\"\r\n        :aria-label=\"`Loading asset ${i}`\"\r\n      />\r\n    </div>\r\n\r\n    <!-- Empty State -->\r\n    <div\r\n      v-else-if=\"assets.length === 0\"\r\n      class=\"asset-grid__empty\"\r\n      role=\"status\"\r\n      aria-live=\"polite\"\r\n    >\r\n      <svg\r\n        class=\"w-16 h-16 text-neutral-400\"\r\n        fill=\"none\"\r\n        stroke=\"currentColor\"\r\n        viewBox=\"0 0 24 24\"\r\n        aria-hidden=\"true\"\r\n      >\r\n        <path\r\n          stroke-linecap=\"round\"\r\n          stroke-linejoin=\"round\"\r\n          stroke-width=\"2\"\r\n          d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"\r\n        />\r\n      </svg>\r\n      <p class=\"asset-grid__empty-text\">No assets in this collection</p>\r\n    </div>\r\n\r\n    <!-- Assets Grid -->\r\n    <div v-else class=\"asset-grid__grid\" role=\"grid\" aria-label=\"Collection assets\">\r\n      <div\r\n        v-for=\"asset in assets\"\r\n        :key=\"asset.id\"\r\n        class=\"asset-grid__item\"\r\n        role=\"gridcell\"\r\n        @click=\"handleAssetClick(asset.id)\"\r\n        @keydown.enter=\"handleAssetClick(asset.id)\"\r\n        @keydown.space.prevent=\"handleAssetClick(asset.id)\"\r\n        tabindex=\"0\"\r\n        :aria-label=\"`Asset ${asset.label || asset.filename}`\"\r\n      >\r\n        <div class=\"asset-grid__thumbnail\">\r\n          <img\r\n            v-if=\"asset.thumbnail_url\"\r\n            :src=\"asset.thumbnail_url\"\r\n            :alt=\"asset.label || asset.filename\"\r\n            class=\"asset-grid__image\"\r\n            loading=\"lazy\"\r\n          />\r\n          <div v-else class=\"asset-grid__placeholder\">\r\n            <svg\r\n              class=\"w-12 h-12 text-neutral-400\"\r\n              fill=\"none\"\r\n              stroke=\"currentColor\"\r\n              viewBox=\"0 0 24 24\"\r\n              aria-hidden=\"true\"\r\n            >\r\n              <path\r\n                stroke-linecap=\"round\"\r\n                stroke-linejoin=\"round\"\r\n                stroke-width=\"2\"\r\n                d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"\r\n              />\r\n            </svg>\r\n          </div>\r\n        </div>\r\n        <div class=\"asset-grid__info\">\r\n          <p class=\"asset-grid__name\" :title=\"asset.label || asset.filename\">\r\n            {{ asset.label || asset.filename }}\r\n          </p>\r\n          <p class=\"asset-grid__meta\">{{ formatFileSize(asset.size) }}</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, onMounted } from 'vue'\r\nimport { collectionsService } from '@/services/collectionsService'\r\nimport type { Asset } from '@/types/api'\r\nimport type { CollectionWithAssets } from '@/types/collections'\r\n\r\ninterface Props {\r\n  collectionId: number | string\r\n}\r\n\r\nconst props = defineProps<Props>()\r\n\r\nconst emit = defineEmits<{\r\n  'asset-click': [assetId: number]\r\n}>()\r\n\r\nconst assets = ref<Asset[]>([])\r\nconst isLoading = ref(false)\r\n\r\nconst formatFileSize = (bytes: number): string => {\r\n  if (bytes === 0) return '0 Bytes'\r\n  const k = 1024\r\n  const sizes = ['Bytes', 'KB', 'MB', 'GB']\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k))\r\n  return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + ' ' + sizes[i]\r\n}\r\n\r\nconst loadAssets = async (): Promise<void> => {\r\n  if (typeof props.collectionId !== 'number') {\r\n    assets.value = []\r\n    return\r\n  }\r\n\r\n  isLoading.value = true\r\n  try {\r\n    const collection = await collectionsService.getCollection(props.collectionId)\r\n    assets.value = (collection as CollectionWithAssets).assets || []\r\n  } catch (error) {\r\n    console.error('Failed to load collection assets:', error)\r\n    assets.value = []\r\n  } finally {\r\n    isLoading.value = false\r\n  }\r\n}\r\n\r\nconst handleAssetClick = (assetId: number): void => {\r\n  emit('asset-click', assetId)\r\n}\r\n\r\nonMounted(() => {\r\n  loadAssets()\r\n})\r\n</script>\r\n\r\n<style scoped lang=\"css\">\r\n.asset-grid {\r\n  width: 100%;\r\n}\r\n\r\n.asset-grid__loading {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\r\n  gap: 16px;\r\n}\r\n\r\n.asset-grid__skeleton {\r\n  aspect-ratio: 1;\r\n  background: var(--color-bg-1, #f9fafb);\r\n  border-radius: var(--radius-base, 6px);\r\n  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;\r\n}\r\n\r\n@keyframes pulse {\r\n  0%,\r\n  100% {\r\n    opacity: 1;\r\n  }\r\n  50% {\r\n    opacity: 0.5;\r\n  }\r\n}\r\n\r\n.asset-grid__empty {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  padding: 64px 24px;\r\n  color: var(--color-text-secondary, #6b7280);\r\n  gap: 16px;\r\n}\r\n\r\n.asset-grid__empty-text {\r\n  font-size: var(--font-size-base, 14px);\r\n  margin: 0;\r\n}\r\n\r\n.asset-grid__grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\r\n  gap: 16px;\r\n}\r\n\r\n.asset-grid__item {\r\n  display: flex;\r\n  flex-direction: column;\r\n  background: var(--color-surface, #ffffff);\r\n  border: 1px solid var(--color-border, #e5e7eb);\r\n  border-radius: var(--radius-base, 6px);\r\n  overflow: hidden;\r\n  cursor: pointer;\r\n  transition: all 200ms ease;\r\n}\r\n\r\n.asset-grid__item:hover {\r\n  border-color: var(--color-primary, #3b82f6);\r\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\r\n  transform: translateY(-2px);\r\n}\r\n\r\n.asset-grid__item:focus-visible {\r\n  outline: 2px solid var(--color-primary, #3b82f6);\r\n  outline-offset: 2px;\r\n}\r\n\r\n.asset-grid__thumbnail {\r\n  width: 100%;\r\n  aspect-ratio: 1;\r\n  background: var(--color-bg-1, #f9fafb);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  overflow: hidden;\r\n}\r\n\r\n.asset-grid__image {\r\n  width: 100%;\r\n  height: 100%;\r\n  object-fit: cover;\r\n}\r\n\r\n.asset-grid__placeholder {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.asset-grid__info {\r\n  padding: 12px;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 4px;\r\n}\r\n\r\n.asset-grid__name {\r\n  font-size: var(--font-size-sm, 12px);\r\n  font-weight: 500;\r\n  color: var(--color-text, #111827);\r\n  margin: 0;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  white-space: nowrap;\r\n}\r\n\r\n.asset-grid__meta {\r\n  font-size: var(--font-size-xs, 11px);\r\n  color: var(--color-text-secondary, #6b7280);\r\n  margin: 0;\r\n}\r\n\r\n/* Responsive */\r\n@media (max-width: 768px) {\r\n  .asset-grid__grid {\r\n    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));\r\n    gap: 12px;\r\n  }\r\n}\r\n\r\n@media (prefers-reduced-motion: reduce) {\r\n  .asset-grid__item {\r\n    transition: none;\r\n  }\r\n\r\n  .asset-grid__skeleton {\r\n    animation: none;\r\n  }\r\n}\r\n</style>\r\n\r\n\r\n\r\n","<template>\r\n  <Modal\r\n    :is-open=\"true\"\r\n    title=\"Create Collection\"\r\n    @close=\"$emit('close')\"\r\n    size=\"md\"\r\n  >\r\n    <form @submit.prevent=\"handleSubmit\" class=\"create-collection-form\">\r\n      <div class=\"form-group\">\r\n        <Input\r\n          v-model=\"formData.name\"\r\n          label=\"Collection Name\"\r\n          placeholder=\"e.g., Spring 2025 Campaign\"\r\n          required\r\n          :error=\"errors.name\"\r\n          hint=\"1-255 characters\"\r\n          autocomplete=\"off\"\r\n        />\r\n      </div>\r\n\r\n      <div class=\"form-group\">\r\n        <label class=\"form-label\">Description</label>\r\n        <textarea\r\n          v-model=\"formData.description\"\r\n          class=\"form-textarea\"\r\n          rows=\"3\"\r\n          placeholder=\"Optional description for this collection\"\r\n        />\r\n      </div>\r\n\r\n      <div class=\"form-group\">\r\n        <Select\r\n          v-model=\"formData.visibility\"\r\n          :options=\"visibilityOptions\"\r\n          label=\"Visibility\"\r\n          required\r\n          :error=\"errors.visibility\"\r\n        />\r\n      </div>\r\n\r\n      <div v-if=\"errorMessage\" class=\"alert alert--error\">\r\n        <p>{{ errorMessage }}</p>\r\n      </div>\r\n    </form>\r\n\r\n    <template #footer>\r\n      <Button variant=\"ghost\" @click=\"$emit('close')\" type=\"button\">\r\n        Cancel\r\n      </Button>\r\n      <Button\r\n        variant=\"primary\"\r\n        @click=\"handleSubmit\"\r\n        :loading=\"isSubmitting\"\r\n        type=\"submit\"\r\n      >\r\n        Create Collection\r\n      </Button>\r\n    </template>\r\n  </Modal>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, reactive } from 'vue'\r\nimport type { CreateCollectionRequest, CollectionVisibility } from '@/types/collections'\r\nimport Modal from '@/components/Common/Modal.vue'\r\nimport Input from '@/components/Common/Input.vue'\r\nimport Select from '@/components/Common/Select.vue'\r\nimport Button from '@/components/Common/Button.vue'\r\n\r\ninterface Props {\r\n  parentId?: number | null\r\n}\r\n\r\nconst props = defineProps<Props>()\r\n\r\nconst emit = defineEmits<{\r\n  submit: [data: CreateCollectionRequest]\r\n  close: []\r\n}>()\r\n\r\nconst isSubmitting = ref(false)\r\nconst errorMessage = ref('')\r\nconst errors = reactive<{ name?: string; visibility?: string }>({})\r\n\r\nconst formData = reactive<{\r\n  name: string\r\n  description: string\r\n  visibility: CollectionVisibility\r\n}>({\r\n  name: '',\r\n  description: '',\r\n  visibility: 'private'\r\n})\r\n\r\nconst visibilityOptions = [\r\n  { value: 'private', label: 'Private (only me)' },\r\n  { value: 'shared', label: 'Shared (selected users)' },\r\n  { value: 'public', label: 'Public (all users)' }\r\n]\r\n\r\nconst validate = (): boolean => {\r\n  Object.keys(errors).forEach((key) => delete errors[key as keyof typeof errors])\r\n  errorMessage.value = ''\r\n\r\n  if (!formData.name.trim()) {\r\n    errors.name = 'Collection name is required'\r\n    return false\r\n  }\r\n\r\n  if (formData.name.length > 255) {\r\n    errors.name = 'Collection name must be 255 characters or less'\r\n    return false\r\n  }\r\n\r\n  if (!formData.visibility) {\r\n    errors.visibility = 'Visibility is required'\r\n    return false\r\n  }\r\n\r\n  return true\r\n}\r\n\r\nconst handleSubmit = (): void => {\r\n  if (!validate()) return\r\n\r\n  isSubmitting.value = true\r\n  errorMessage.value = ''\r\n\r\n  try {\r\n    const data: CreateCollectionRequest = {\r\n      name: formData.name.trim(),\r\n      description: formData.description.trim() || undefined,\r\n      parent_id: props.parentId || null,\r\n      visibility: formData.visibility\r\n    }\r\n\r\n    emit('submit', data)\r\n  } catch (error: any) {\r\n    errorMessage.value = error.message || 'Failed to create collection'\r\n  } finally {\r\n    isSubmitting.value = false\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"css\">\r\n.create-collection-form {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 16px;\r\n}\r\n\r\n.form-group {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 8px;\r\n}\r\n\r\n.form-label {\r\n  font-size: var(--font-size-sm, 12px);\r\n  font-weight: 500;\r\n  color: var(--color-text, #111827);\r\n}\r\n\r\n.form-textarea {\r\n  width: 100%;\r\n  padding: 8px 12px;\r\n  border: 1px solid var(--color-border, #e5e7eb);\r\n  border-radius: var(--radius-base, 6px);\r\n  font-size: var(--font-size-base, 14px);\r\n  font-family: inherit;\r\n  resize: vertical;\r\n  transition: border-color 150ms ease;\r\n}\r\n\r\n.form-textarea:focus {\r\n  outline: none;\r\n  border-color: var(--color-primary, #3b82f6);\r\n  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\r\n}\r\n\r\n.alert {\r\n  padding: 12px;\r\n  border-radius: var(--radius-base, 6px);\r\n  font-size: var(--font-size-sm, 12px);\r\n}\r\n\r\n.alert--error {\r\n  background: rgba(239, 68, 68, 0.1);\r\n  color: var(--color-error, #ef4444);\r\n  border: 1px solid rgba(239, 68, 68, 0.2);\r\n}\r\n</style>\r\n\r\n\r\n\r\n","<template>\r\n  <Modal\r\n    :is-open=\"true\"\r\n    title=\"Rename Collection\"\r\n    @close=\"$emit('close')\"\r\n    size=\"md\"\r\n  >\r\n    <form @submit.prevent=\"handleSubmit\" class=\"rename-collection-form\">\r\n      <div class=\"form-group\">\r\n        <Input\r\n          v-model=\"formData.name\"\r\n          label=\"Collection Name\"\r\n          placeholder=\"e.g., Spring 2025 Campaign\"\r\n          required\r\n          :error=\"errors.name\"\r\n          hint=\"1-255 characters\"\r\n          autocomplete=\"off\"\r\n        />\r\n      </div>\r\n\r\n      <div class=\"form-group\">\r\n        <label class=\"form-label\">Description</label>\r\n        <textarea\r\n          v-model=\"formData.description\"\r\n          class=\"form-textarea\"\r\n          rows=\"3\"\r\n          placeholder=\"Optional description for this collection\"\r\n        />\r\n      </div>\r\n\r\n      <div v-if=\"errorMessage\" class=\"alert alert--error\">\r\n        <p>{{ errorMessage }}</p>\r\n      </div>\r\n    </form>\r\n\r\n    <template #footer>\r\n      <Button variant=\"ghost\" @click=\"$emit('close')\" type=\"button\">\r\n        Cancel\r\n      </Button>\r\n      <Button\r\n        variant=\"primary\"\r\n        @click=\"handleSubmit\"\r\n        :loading=\"isSubmitting\"\r\n        type=\"submit\"\r\n      >\r\n        Update Collection\r\n      </Button>\r\n    </template>\r\n  </Modal>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, reactive, watch } from 'vue'\r\nimport type { Collection, UpdateCollectionRequest } from '@/types/collections'\r\nimport Modal from '@/components/Common/Modal.vue'\r\nimport Input from '@/components/Common/Input.vue'\r\nimport Button from '@/components/Common/Button.vue'\r\n\r\ninterface Props {\r\n  collection: Collection\r\n}\r\n\r\nconst props = defineProps<Props>()\r\n\r\nconst emit = defineEmits<{\r\n  submit: [data: UpdateCollectionRequest]\r\n  close: []\r\n}>()\r\n\r\nconst isSubmitting = ref(false)\r\nconst errorMessage = ref('')\r\nconst errors = reactive<{ name?: string }>({})\r\n\r\nconst formData = reactive<{\r\n  name: string\r\n  description: string\r\n}>({\r\n  name: props.collection.name,\r\n  description: props.collection.description || ''\r\n})\r\n\r\nwatch(\r\n  () => props.collection,\r\n  (newCollection) => {\r\n    formData.name = newCollection.name\r\n    formData.description = newCollection.description || ''\r\n  },\r\n  { immediate: true }\r\n)\r\n\r\nconst validate = (): boolean => {\r\n  Object.keys(errors).forEach((key) => delete errors[key as keyof typeof errors])\r\n  errorMessage.value = ''\r\n\r\n  if (!formData.name.trim()) {\r\n    errors.name = 'Collection name is required'\r\n    return false\r\n  }\r\n\r\n  if (formData.name.length > 255) {\r\n    errors.name = 'Collection name must be 255 characters or less'\r\n    return false\r\n  }\r\n\r\n  return true\r\n}\r\n\r\nconst handleSubmit = (): void => {\r\n  if (!validate()) return\r\n\r\n  isSubmitting.value = true\r\n  errorMessage.value = ''\r\n\r\n  try {\r\n    const data: UpdateCollectionRequest = {\r\n      name: formData.name.trim(),\r\n      description: formData.description.trim() || undefined\r\n    }\r\n\r\n    emit('submit', data)\r\n  } catch (error: any) {\r\n    errorMessage.value = error.message || 'Failed to update collection'\r\n  } finally {\r\n    isSubmitting.value = false\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"css\">\r\n.rename-collection-form {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 16px;\r\n}\r\n\r\n.form-group {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 8px;\r\n}\r\n\r\n.form-label {\r\n  font-size: var(--font-size-sm, 12px);\r\n  font-weight: 500;\r\n  color: var(--color-text, #111827);\r\n}\r\n\r\n.form-textarea {\r\n  width: 100%;\r\n  padding: 8px 12px;\r\n  border: 1px solid var(--color-border, #e5e7eb);\r\n  border-radius: var(--radius-base, 6px);\r\n  font-size: var(--font-size-base, 14px);\r\n  font-family: inherit;\r\n  resize: vertical;\r\n  transition: border-color 150ms ease;\r\n}\r\n\r\n.form-textarea:focus {\r\n  outline: none;\r\n  border-color: var(--color-primary, #3b82f6);\r\n  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\r\n}\r\n\r\n.alert {\r\n  padding: 12px;\r\n  border-radius: var(--radius-base, 6px);\r\n  font-size: var(--font-size-sm, 12px);\r\n}\r\n\r\n.alert--error {\r\n  background: rgba(239, 68, 68, 0.1);\r\n  color: var(--color-error, #ef4444);\r\n  border: 1px solid rgba(239, 68, 68, 0.2);\r\n}\r\n</style>\r\n\r\n\r\n\r\n","<template>\n  <div class=\"collections-page\">\n    <!-- Skip Links for Accessibility -->\n    <a href=\"#collections-main\" class=\"skip-link\">Skip to main content</a>\n    <a href=\"#collections-sidebar\" class=\"skip-link\">Skip to sidebar</a>\n    \n    <!-- Header -->\n    <div class=\"collections-page__header\">\n      <h1 class=\"collections-page__title\">Collections</h1>\n    </div>\n\n    <div class=\"collections-page__layout\">\n      <!-- Sidebar -->\n      <aside id=\"collections-sidebar\" class=\"collections-page__sidebar\" aria-label=\"Collections navigation\">\n        <!-- Special Collections -->\n        <div class=\"special-collections\">\n          <button\n            v-for=\"special in specialCollections\"\n            :key=\"special.id\"\n            :class=\"[\n              'special-collections__item',\n              {\n                'special-collections__item--active':\n                  currentCollectionId === special.id\n              }\n            ]\"\n            @click=\"selectSpecialCollection(special)\"\n            :aria-label=\"`Select ${special.name} collection`\"\n          >\n            <svg\n              class=\"w-5 h-5\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n              aria-hidden=\"true\"\n            >\n              <path\n                v-if=\"special.type === 'favorites'\"\n                stroke-linecap=\"round\"\n                stroke-linejoin=\"round\"\n                stroke-width=\"2\"\n                d=\"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z\"\n              />\n              <path\n                v-else-if=\"special.type === 'recent'\"\n                stroke-linecap=\"round\"\n                stroke-linejoin=\"round\"\n                stroke-width=\"2\"\n                d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"\n              />\n              <path\n                v-else-if=\"special.type === 'my_uploads'\"\n                stroke-linecap=\"round\"\n                stroke-linejoin=\"round\"\n                stroke-width=\"2\"\n                d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\"\n              />\n              <path\n                v-else-if=\"special.type === 'shared_with_me'\"\n                stroke-linecap=\"round\"\n                stroke-linejoin=\"round\"\n                stroke-width=\"2\"\n                d=\"M8.684 13.342C8.885 12.938 9 12.482 9 12c0-.482-.115-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z\"\n              />\n              <path\n                v-else\n                stroke-linecap=\"round\"\n                stroke-linejoin=\"round\"\n                stroke-width=\"2\"\n                d=\"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 002 2h2.945M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\n              />\n            </svg>\n            <span class=\"special-collections__label\">{{ special.name }}</span>\n            <span class=\"special-collections__count\">{{\n              special.asset_count\n            }}</span>\n          </button>\n        </div>\n\n        <!-- Divider -->\n        <div class=\"collections-sidebar__divider\" />\n\n        <!-- Collections Tree -->\n        <CollectionTree\n          :collections=\"collectionsTree\"\n          :expanded-nodes=\"expandedNodes\"\n          :selected-collection-id=\"currentCollectionId\"\n          :dragged-collection=\"draggedCollection\"\n          @select=\"handleSelectCollection\"\n          @toggle-expand=\"handleToggleExpand\"\n          @drag-start=\"handleDragStart\"\n          @drop=\"handleDrop\"\n        />\n      </aside>\n\n      <!-- Main Content -->\n      <main id=\"collections-main\" class=\"collections-page__content\" aria-label=\"Collections content\">\n        <!-- Toolbar -->\n        <div class=\"collections-toolbar\">\n          <!-- Breadcrumbs -->\n          <Breadcrumbs :items=\"breadcrumbs\" />\n\n          <!-- Actions -->\n          <div class=\"collections-toolbar__actions\">\n            <Button\n              v-if=\"canCreateCollection\"\n              variant=\"primary\"\n              @click=\"showCreateModal = true\"\n              aria-label=\"Create new collection\"\n            >\n              <svg\n                class=\"w-5 h-5\"\n                fill=\"none\"\n                stroke=\"currentColor\"\n                viewBox=\"0 0 24 24\"\n                aria-hidden=\"true\"\n              >\n                <path\n                  stroke-linecap=\"round\"\n                  stroke-linejoin=\"round\"\n                  stroke-width=\"2\"\n                  d=\"M12 4v16m8-8H4\"\n                />\n              </svg>\n              New Collection\n            </Button>\n\n            <Button\n              v-if=\"currentCollection && !isSpecialCollection && canEditCollection\"\n              variant=\"secondary\"\n              @click=\"showRenameModal = true\"\n              aria-label=\"Rename collection\"\n            >\n              <svg\n                class=\"w-5 h-5\"\n                fill=\"none\"\n                stroke=\"currentColor\"\n                viewBox=\"0 0 24 24\"\n                aria-hidden=\"true\"\n              >\n                <path\n                  stroke-linecap=\"round\"\n                  stroke-linejoin=\"round\"\n                  stroke-width=\"2\"\n                  d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"\n                />\n              </svg>\n              Rename\n            </Button>\n\n            <Button\n              v-if=\"currentCollection\"\n              variant=\"secondary\"\n              @click=\"toggleFavorite\"\n              :aria-label=\"\n                currentCollection.is_favorite\n                  ? 'Remove from favorites'\n                  : 'Add to favorites'\n              \"\n            >\n              <svg\n                class=\"w-5 h-5\"\n                fill=\"none\"\n                stroke=\"currentColor\"\n                viewBox=\"0 0 24 24\"\n                :class=\"{\n                  'fill-current': currentCollection.is_favorite\n                }\"\n                aria-hidden=\"true\"\n              >\n                <path\n                  stroke-linecap=\"round\"\n                  stroke-linejoin=\"round\"\n                  stroke-width=\"2\"\n                  d=\"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z\"\n                />\n              </svg>\n            </Button>\n\n            <Button\n              v-if=\"currentCollection && !isSpecialCollection && canDeleteCollection\"\n              variant=\"secondary\"\n              @click=\"showDeleteModal = true\"\n              aria-label=\"Delete collection\"\n            >\n              <svg\n                class=\"w-5 h-5\"\n                fill=\"none\"\n                stroke=\"currentColor\"\n                viewBox=\"0 0 24 24\"\n                aria-hidden=\"true\"\n              >\n                <path\n                  stroke-linecap=\"round\"\n                  stroke-linejoin=\"round\"\n                  stroke-width=\"2\"\n                  d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"\n                />\n              </svg>\n              Delete\n            </Button>\n          </div>\n        </div>\n\n        <!-- Empty State -->\n        <div v-if=\"!currentCollection\" class=\"collections-empty\">\n          <svg\n            class=\"w-16 h-16 text-neutral-400\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            viewBox=\"0 0 24 24\"\n            aria-hidden=\"true\"\n          >\n            <path\n              stroke-linecap=\"round\"\n              stroke-linejoin=\"round\"\n              stroke-width=\"2\"\n              d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"\n            />\n          </svg>\n          <p class=\"collections-empty__text\">\n            Select a collection to view assets\n          </p>\n        </div>\n\n        <!-- Assets Grid (if collection selected) -->\n        <div v-else class=\"collections-content\">\n          <!-- Header -->\n          <div class=\"collections-header\">\n            <h2 class=\"collections-header__title\">\n              {{ currentCollection.name }}\n            </h2>\n            <p\n              v-if=\"currentCollection.description\"\n              class=\"collections-header__description\"\n            >\n              {{ currentCollection.description }}\n            </p>\n            <span class=\"collections-header__count\">\n              {{ currentCollection.asset_count }} asset{{\n                currentCollection.asset_count !== 1 ? 's' : ''\n              }}\n            </span>\n          </div>\n\n          <!-- Assets Grid -->\n          <AssetGrid\n            :collection-id=\"isSpecialCollection ? currentCollection.id : currentCollection.id\"\n            @asset-click=\"handleAssetClick\"\n          />\n        </div>\n      </main>\n    </div>\n\n    <!-- Modals -->\n    <CreateCollectionModal\n      v-if=\"showCreateModal\"\n      :parent-id=\"currentCollection?.id || null\"\n      @submit=\"handleCreateCollection\"\n      @close=\"showCreateModal = false\"\n    />\n\n    <RenameCollectionModal\n      v-if=\"showRenameModal && currentCollection\"\n      :collection=\"currentCollection\"\n      @submit=\"handleRenameCollection\"\n      @close=\"showRenameModal = false\"\n    />\n\n    <DeleteConfirmModal\n      v-if=\"showDeleteModal && currentCollection\"\n      :title=\"`Delete collection: ${currentCollection.name}`\"\n      :message=\"'This will also delete all child collections. Are you sure?'\"\n      @confirm=\"handleDeleteCollection\"\n      @cancel=\"showDeleteModal = false\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed, onMounted } from 'vue'\nimport { useRouter, useRoute } from 'vue-router'\nimport { useAuthStore } from '@/stores/authStore'\nimport { useCollectionsStore } from '@/stores/collectionsStore'\nimport { useUIStore } from '@/stores/uiStore'\nimport type { Collection, SpecialCollectionType } from '@/types/collections'\nimport CollectionTree from '@/components/collections/CollectionTree.vue'\nimport Breadcrumbs from '@/components/Common/Breadcrumbs.vue'\nimport Button from '@/components/Common/Button.vue'\nimport AssetGrid from '@/components/collections/AssetGrid.vue'\nimport CreateCollectionModal from '@/components/collections/CreateCollectionModal.vue'\nimport RenameCollectionModal from '@/components/collections/RenameCollectionModal.vue'\nimport DeleteConfirmModal from '@/components/admin/DeleteConfirmModal.vue'\n\n// Hooks\nconst router = useRouter()\nconst route = useRoute()\nconst authStore = useAuthStore()\nconst collectionsStore = useCollectionsStore()\nconst uiStore = useUIStore()\n\n// State\nconst currentCollectionId = ref<number | string | null>(null)\nconst showCreateModal = ref(false)\nconst showRenameModal = ref(false)\nconst showDeleteModal = ref(false)\nconst isLoading = ref(false)\nconst fetchCollectionsRequestId = ref(0)\nconst selectionRequestId = ref(0)\n\n// Computed\nconst collectionsTree = computed(() => collectionsStore.collectionsTree)\nconst currentCollection = computed(() => collectionsStore.currentCollection)\nconst expandedNodes = computed(() =>\n  Array.from(collectionsStore.expandedNodes)\n)\nconst draggedCollection = computed(() => collectionsStore.draggedCollection)\nconst canCreateCollection = computed(() =>\n  collectionsStore.canCreateCollection\n)\nconst canDeleteCollection = computed(() =>\n  collectionsStore.canDeleteCollection\n)\nconst canEditCollection = computed(() =>\n  collectionsStore.canEditCollection\n)\n\nconst specialCollections = computed(() => {\n  const collections: Array<\n    Collection & { type: SpecialCollectionType; id: string | number }\n  > = []\n\n  if (collectionsStore.favorites.length > 0) {\n    collections.push({\n      id: 'favorites',\n      name: 'Favorites',\n      description: '',\n      parent_id: null,\n      is_favorite: false,\n      is_shared: false,\n      visibility: 'private',\n      asset_count: collectionsStore.favorites.reduce(\n        (sum, c) => sum + c.asset_count,\n        0\n      ),\n      created_by: authStore.user?.id || 0,\n      created_at: '',\n      updated_at: '',\n      cover_image_id: null,\n      type: 'favorites'\n    })\n  }\n\n  if (collectionsStore.recentCollections.length > 0) {\n    collections.push({\n      id: 'recent',\n      name: 'Recent',\n      description: '',\n      parent_id: null,\n      is_favorite: false,\n      is_shared: false,\n      visibility: 'private',\n      asset_count: collectionsStore.recentCollections.reduce(\n        (sum, c) => sum + c.asset_count,\n        0\n      ),\n      created_by: authStore.user?.id || 0,\n      created_at: '',\n      updated_at: '',\n      cover_image_id: null,\n      type: 'recent'\n    })\n  }\n\n  if (collectionsStore.sharedWithMe.length > 0) {\n    collections.push({\n      id: 'shared_with_me',\n      name: 'Shared with Me',\n      description: '',\n      parent_id: null,\n      is_favorite: false,\n      is_shared: true,\n      visibility: 'shared',\n      asset_count: collectionsStore.sharedWithMe.reduce(\n        (sum, c) => sum + c.asset_count,\n        0\n      ),\n      created_by: authStore.user?.id || 0,\n      created_at: '',\n      updated_at: '',\n      cover_image_id: null,\n      type: 'shared_with_me'\n    })\n  }\n\n  if (collectionsStore.publicCollections.length > 0) {\n    collections.push({\n      id: 'public_collections',\n      name: 'Public Collections',\n      description: '',\n      parent_id: null,\n      is_favorite: false,\n      is_shared: false,\n      visibility: 'public',\n      asset_count: collectionsStore.publicCollections.reduce(\n        (sum, c) => sum + c.asset_count,\n        0\n      ),\n      created_by: authStore.user?.id || 0,\n      created_at: '',\n      updated_at: '',\n      cover_image_id: null,\n      type: 'public_collections'\n    })\n  }\n\n  return collections\n})\n\nconst isSpecialCollection = computed(() => {\n  if (!currentCollectionId.value) return false\n  return typeof currentCollectionId.value === 'string'\n})\n\nconst breadcrumbs = computed(() => {\n  const items: Array<{ label: string; to: string | null }> = [\n    { label: 'Collections', to: '/collections' }\n  ]\n\n  if (currentCollectionId.value && typeof currentCollectionId.value === 'number') {\n    const breadcrumbPath = collectionsStore.breadcrumbs(currentCollectionId.value)\n    breadcrumbPath.forEach((crumb) => {\n      items.push({\n        label: crumb.name,\n        to: `/collections/${crumb.id}`\n      })\n    })\n  } else if (currentCollectionId.value) {\n    const special = specialCollections.value.find(\n      (s) => s.id === currentCollectionId.value\n    )\n    if (special) {\n      items.push({ label: special.name, to: null })\n    }\n  }\n\n  return items\n})\n\n// Methods\nconst fetchCollections = async (): Promise<void> => {\n  const requestId = ++fetchCollectionsRequestId.value\n  isLoading.value = true\n  try {\n    await collectionsStore.fetchCollections()\n    await collectionsStore.fetchSpecialCollections()\n\n    if (requestId !== fetchCollectionsRequestId.value) {\n      return\n    }\n\n    if (!currentCollectionId.value) {\n      const firstRoot = collectionsStore.rootCollections[0]\n      if (firstRoot) {\n        await selectCollection(firstRoot)\n      }\n    }\n  } catch (error) {\n    uiStore.addNotification({\n      type: 'error',\n      title: 'Error',\n      message: 'Failed to load collections'\n    })\n  } finally {\n    isLoading.value = false\n  }\n}\n\nconst handleSelectCollection = async (collection: Collection): Promise<void> => {\n  const requestId = ++selectionRequestId.value\n  currentCollectionId.value = collection.id\n  await collectionsStore.fetchCollection(collection.id)\n  if (requestId !== selectionRequestId.value) {\n    return\n  }\n}\n\nconst selectSpecialCollection = async (\n  special: Collection & { type: SpecialCollectionType }\n): Promise<void> => {\n  try {\n    currentCollectionId.value = special.id\n    \n    // Load assets for special collections\n    let assets: any[] = []\n    switch (special.type) {\n      case 'favorites':\n        assets = collectionsStore.favorites.flatMap(c => {\n          // Get assets from favorite collections\n          return c.asset_count > 0 ? [] : [] // Placeholder - would fetch from API\n        })\n        break\n      case 'recent':\n        assets = collectionsStore.recentCollections.flatMap(c => {\n          return c.asset_count > 0 ? [] : [] // Placeholder - would fetch from API\n        })\n        break\n      case 'shared_with_me':\n        assets = collectionsStore.sharedWithMe.flatMap(c => {\n          return c.asset_count > 0 ? [] : [] // Placeholder - would fetch from API\n        })\n        break\n      case 'public_collections':\n        assets = collectionsStore.publicCollections.flatMap(c => {\n          return c.asset_count > 0 ? [] : [] // Placeholder - would fetch from API\n        })\n        break\n    }\n    \n    // Set a virtual collection for special collections\n    collectionsStore.setCurrentCollection({\n      id: special.id,\n      name: special.name,\n      description: special.description || '',\n      parent_id: null,\n      is_favorite: special.type === 'favorites',\n      is_shared: special.type === 'shared_with_me' || special.type === 'public_collections',\n      visibility: special.visibility,\n      asset_count: special.asset_count,\n      created_by: authStore.user?.id || 0,\n      created_at: '',\n      updated_at: '',\n      cover_image_id: null\n    } as Collection)\n  } catch (error) {\n    uiStore.addNotification({\n      type: 'error',\n      title: 'Error',\n      message: 'Failed to load special collection'\n    })\n  }\n}\n\nconst selectCollection = (collection: Collection): void => {\n  handleSelectCollection(collection)\n}\n\nconst handleToggleExpand = (nodeId: number): void => {\n  collectionsStore.toggleNodeExpanded(nodeId)\n}\n\nconst handleDragStart = (collection: Collection): void => {\n  collectionsStore.setDraggedCollection(collection)\n}\n\nconst handleDrop = async (\n  targetCollection: Collection,\n  newParentId?: number | null\n): Promise<void> => {\n  const draggedId = collectionsStore.draggedCollection?.id\n  if (!draggedId || typeof draggedId !== 'number') return\n\n  // Prevent dropping on itself or its children\n  if (draggedId === targetCollection.id) {\n    collectionsStore.setDraggedCollection(null)\n    return\n  }\n\n  try {\n    await collectionsStore.moveCollection(\n      draggedId,\n      targetCollection.id,\n      newParentId !== undefined ? newParentId : targetCollection.id\n    )\n    uiStore.addNotification({\n      type: 'success',\n      title: 'Success',\n      message: 'Collection moved successfully'\n    })\n    await fetchCollections()\n  } catch (error) {\n    uiStore.addNotification({\n      type: 'error',\n      title: 'Error',\n      message: 'Failed to move collection'\n    })\n  } finally {\n    collectionsStore.setDraggedCollection(null)\n  }\n}\n\nconst toggleFavorite = async (): Promise<void> => {\n  if (!currentCollection.value || typeof currentCollection.value.id !== 'number')\n    return\n  try {\n    await collectionsStore.toggleFavorite(currentCollection.value.id)\n    uiStore.addNotification({\n      type: 'success',\n      title: 'Success',\n      message: currentCollection.value.is_favorite\n        ? 'Removed from favorites'\n        : 'Added to favorites'\n    })\n  } catch (error) {\n    uiStore.addNotification({\n      type: 'error',\n      title: 'Error',\n      message: 'Failed to toggle favorite'\n    })\n  }\n}\n\nconst handleCreateCollection = async (data: {\n  name: string\n  description?: string\n  visibility?: string\n}): Promise<void> => {\n  try {\n    await collectionsStore.createCollection({\n      ...data,\n      parent_id: currentCollection.value?.id || null,\n      visibility: (data.visibility as 'private' | 'shared' | 'public') || 'private'\n    })\n    showCreateModal.value = false\n    uiStore.addNotification({\n      type: 'success',\n      title: 'Success',\n      message: 'Collection created successfully'\n    })\n    await fetchCollections()\n  } catch (error) {\n    uiStore.addNotification({\n      type: 'error',\n      title: 'Error',\n      message: 'Failed to create collection'\n    })\n  }\n}\n\nconst handleRenameCollection = async (data: {\n  name: string\n  description?: string\n}): Promise<void> => {\n  if (!currentCollection.value) return\n  try {\n    await collectionsStore.updateCollection(currentCollection.value.id, data)\n    showRenameModal.value = false\n    uiStore.addNotification({\n      type: 'success',\n      title: 'Success',\n      message: 'Collection renamed successfully'\n    })\n    await fetchCollections()\n  } catch (error) {\n    uiStore.addNotification({\n      type: 'error',\n      title: 'Error',\n      message: 'Failed to rename collection'\n    })\n  }\n}\n\nconst handleDeleteCollection = async (): Promise<void> => {\n  if (!currentCollection.value || typeof currentCollection.value.id !== 'number')\n    return\n  try {\n    await collectionsStore.deleteCollection(currentCollection.value.id)\n    showDeleteModal.value = false\n    currentCollectionId.value = null\n    uiStore.addNotification({\n      type: 'success',\n      title: 'Success',\n      message: 'Collection deleted successfully'\n    })\n    await fetchCollections()\n  } catch (error) {\n    uiStore.addNotification({\n      type: 'error',\n      title: 'Error',\n      message: 'Failed to delete collection'\n    })\n  }\n}\n\nconst handleAssetClick = (assetId: number): void => {\n  router.push({ name: 'asset-detail', params: { id: assetId } })\n}\n\n// Lifecycle\nonMounted(async () => {\n  // Check if route has collection ID\n  if (route.params.id) {\n    const collectionId = typeof route.params.id === 'string' \n      ? parseInt(route.params.id) \n      : parseInt(route.params.id[0])\n    if (!isNaN(collectionId)) {\n      await collectionsStore.fetchCollection(collectionId)\n      currentCollectionId.value = collectionId\n    }\n  } else {\n    await fetchCollections()\n  }\n})\n</script>\n\n<style scoped lang=\"css\">\n.collections-page {\n  display: flex;\n  flex-direction: column;\n  min-height: 100vh;\n  background: var(--color-background, #f9fafb);\n}\n\n.collections-page__header {\n  padding: 24px;\n  background: var(--color-surface, #ffffff);\n  border-bottom: 1px solid var(--color-border, #e5e7eb);\n}\n\n.collections-page__title {\n  font-size: var(--font-size-3xl, 30px);\n  font-weight: 600;\n  color: var(--color-text, #111827);\n  margin: 0;\n}\n\n.collections-page__layout {\n  display: grid;\n  grid-template-columns: 300px 1fr;\n  flex: 1;\n  min-height: 0;\n}\n\n.collections-page__sidebar {\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n  padding: 16px;\n  background: var(--color-surface, #ffffff);\n  border-right: 1px solid var(--color-border, #e5e7eb);\n  overflow-y: auto;\n  max-height: calc(100vh - 100px);\n}\n\n.collections-page__content {\n  display: flex;\n  flex-direction: column;\n  min-height: 0;\n  overflow-y: auto;\n}\n\n.special-collections {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n}\n\n.special-collections__item {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 8px 12px;\n  border: none;\n  background: transparent;\n  color: var(--color-text-secondary, #6b7280);\n  cursor: pointer;\n  border-radius: var(--radius-base, 6px);\n  font-size: var(--font-size-base, 14px);\n  transition: all 200ms ease;\n  text-align: left;\n  width: 100%;\n}\n\n.special-collections__item:hover {\n  background: var(--color-bg-1, #f9fafb);\n  color: var(--color-text, #111827);\n}\n\n.special-collections__item--active {\n  background: var(--color-primary, #3b82f6);\n  color: white;\n  font-weight: 600;\n}\n\n.special-collections__label {\n  flex: 1;\n}\n\n.special-collections__count {\n  font-size: var(--font-size-sm, 12px);\n  opacity: 0.7;\n}\n\n.collections-sidebar__divider {\n  height: 1px;\n  background: var(--color-border, #e5e7eb);\n  margin: 8px 0;\n}\n\n.collections-toolbar {\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n  padding: 24px;\n  background: var(--color-surface, #ffffff);\n  border-bottom: 1px solid var(--color-border, #e5e7eb);\n}\n\n.collections-toolbar__actions {\n  display: flex;\n  gap: 8px;\n  flex-wrap: wrap;\n}\n\n.collections-empty {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 400px;\n  color: var(--color-text-secondary, #6b7280);\n  gap: 16px;\n}\n\n.collections-empty__text {\n  font-size: var(--font-size-lg, 18px);\n  margin: 0;\n}\n\n.collections-content {\n  padding: 24px;\n  flex: 1;\n  overflow-y: auto;\n}\n\n.collections-header {\n  margin-bottom: 32px;\n}\n\n.collections-header__title {\n  margin: 0 0 8px 0;\n  font-size: var(--font-size-3xl, 30px);\n  font-weight: 600;\n  color: var(--color-text, #111827);\n}\n\n.collections-header__description {\n  margin: 0 0 12px 0;\n  color: var(--color-text-secondary, #6b7280);\n  font-size: var(--font-size-base, 14px);\n  line-height: 1.5;\n}\n\n.collections-header__count {\n  display: inline-block;\n  padding: 4px 12px;\n  background: var(--color-bg-1, #f9fafb);\n  border-radius: var(--radius-base, 6px);\n  font-size: var(--font-size-sm, 12px);\n  color: var(--color-text-secondary, #6b7280);\n  font-weight: 500;\n}\n\n/* Skip Links */\n.skip-link {\n  position: absolute;\n  top: -40px;\n  left: 0;\n  background: var(--color-primary, #3b82f6);\n  color: white;\n  padding: 8px 16px;\n  text-decoration: none;\n  z-index: 1000;\n  border-radius: 0 0 4px 0;\n  font-weight: 600;\n}\n\n.skip-link:focus {\n  top: 0;\n}\n\n/* Responsive */\n@media (max-width: 1024px) {\n  .collections-page__layout {\n    grid-template-columns: 1fr;\n    grid-template-rows: auto 1fr;\n  }\n\n  .collections-page__sidebar {\n    max-height: 300px;\n    border-right: none;\n    border-bottom: 1px solid var(--color-border, #e5e7eb);\n  }\n}\n\n@media (max-width: 768px) {\n  .collections-toolbar {\n    padding: 16px;\n  }\n\n  .collections-toolbar__actions {\n    flex-direction: column;\n  }\n\n  .collections-toolbar__actions button {\n    width: 100%;\n  }\n\n  .collections-content {\n    padding: 16px;\n  }\n}\n</style>\n\n"],"names":["collectionsService","getCollections","__async","this","arguments","query","result","withRetry","apiService","get","params","success","error","data","getCollection","id","includeTree","include_tree","createCollection","post","updateCollection","patch","deleteCollection","delete","moveCollection","newParentId","parent_id","getCollectionAssets","_a","collection_id","__objRest","addAssetsToCollection","collectionId","assetIds","position","asset_ids","removeAssetsFromCollection","reorderCollectionAssets","searchCollections","_0","options","__spreadValues","q","getCollectionTree","rootParentId","duplicateCollection","newName","name","getCollectionStats","exportCollection","format","download_url","shareCollection","shareOptions","getCollectionShares","revokeCollectionShare","shareId","bulkDelete","collectionIds","collection_ids","bulkMove","useCollectionsStore","defineStore","authStore","useAuthStore","uiStore","useUIStore","collectionRequestIds","ref","collections","collection","startCollectionRequest","key","nextId","value","__spreadProps","isLatestCollectionRequest","logCollectionError","context","message","formatApiError","code","extractErrorCode","addNotification","type","title","meta","currentCollection","collectionsTree","selectedCollections","totalCollectionsCount","favorites","recentCollections","sharedWithMe","myUploads","publicCollections","expandedNodes","Set","draggedCollection","isLoading","lastFetchTime","canCreateCollection","computed","hasPermission","canDeleteCollection","canEditCollection","canShareCollection","rootCollections","filter","c","flattenedTree","flatten","nodes","node","push","children","length","breadcrumbs","find","buildPath","level","coll","fetchCollections","now","Date","requestId","response","results","count","buildCollectionTree","err","collectionsList","sorted","sort","a","b","localeCompare","collectionMap","Map","forEach","set","buildTree","parentId","map","invalidateCache","fetchCollection","index","findIndex","newCollection","updatedCollection","is_favorite","f","removeCollectionAndChildren","child","sid","fromId","toId","targetParentId","movedCollection","new_parent_id","bulkCollectionOperation","operation","ids","Error","bulkOperation","toggleFavorite","fetchSpecialCollections","getSpecialCollections","recent","shared_with_me","my_uploads","public_collections","expandNode","nodeId","add","collapseNode","toggleNodeExpanded","has","isNodeExpanded","setDraggedCollection","selectCollections","clearSelection","toggleSelection","indexOf","splice","setCurrentCollection","clearError","persist","paths","props","__props","emit","__emit","dragOverNode","handleDragEnd","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_Fragment","_renderList","class","role","includes","_hoisted_4","onClick","tabindex","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_normalizeClass","selectedCollectionId","draggable","$event","onDragstart","handleDragStart","e","dataTransfer","effectAllowed","setData","String","onDragover","handleDragOver","preventDefault","dropEffect","onDrop","stopPropagation","rect","currentTarget","getBoundingClientRect","isDroppingOnCollection","offsetY","height","handleDrop","onDragend","onKeydown","_withKeys","handleArrowLeft","handleArrowRight","asset_count","fill","stroke","viewBox","d","_hoisted_11","_toDisplayString","_hoisted_12","_createVNode","_Transition","_createBlock","_component_CollectionTree","onSelect","_cache","onToggleExpand","onDragStart","target","parent","assets","formatFileSize","bytes","i","Math","floor","log","round","pow","loadAssets","handleAssetClick","assetId","onMounted","_hoisted_5","asset","label","filename","thumbnail_url","src","alt","loading","_hoisted_10","size","isSubmitting","errorMessage","errors","reactive","formData","description","visibility","visibilityOptions","handleSubmit","Object","keys","trim","Modal","onClose","$emit","footer","Button","variant","onSubmit","Input","modelValue","placeholder","required","hint","autocomplete","rows","_vModelText","_hoisted_3","Select","watch","immediate","router","useRouter","route","useRoute","collectionsStore","currentCollectionId","showCreateModal","showRenameModal","showDeleteModal","fetchCollectionsRequestId","selectionRequestId","Array","from","specialCollections","is_shared","reduce","sum","created_by","user","created_at","updated_at","cover_image_id","_b","_c","_d","isSpecialCollection","items","to","crumb","special","s","firstRoot","selectCollection","handleSelectCollection","selectSpecialCollection","flatMap","handleToggleExpand","targetCollection","draggedId","handleCreateCollection","handleRenameCollection","handleDeleteCollection","parseInt","isNaN","href","_hoisted_13","CollectionTree","_hoisted_14","_hoisted_15","Breadcrumbs","_hoisted_16","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","AssetGrid","onAssetClick","_hoisted_17","CreateCollectionModal","RenameCollectionModal","DeleteConfirmModal","onConfirm","onCancel"],"mappings":"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"}
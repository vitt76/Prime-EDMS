import{b as e,r as a,w as l,c as t,e as s,i as r,f as n,F as u,h as o,l as i,m as d,v as c,n as v,s as p,A as m,j as b,N as x,t as f,C as g,k,B as y,u as h,M as _,O as w,x as q}from"./vue-vendor-B11yH1L4.js";import{e as j,d as C,i as z,S as V}from"./index-CEUju959.js";import{_ as S}from"./Badge.vue_vue_type_script_setup_true_lang-Bp_czRtF.js";import{T as $,_ as U}from"./TagInput-DMflVXC-.js";import{D as B}from"./DateRangePicker-DQgDC4j3.js";import{_ as M}from"./Pagination.vue_vue_type_script_setup_true_lang-DJgozKuc.js";import"./utils-vendor-BYNnTNyD.js";const O={class:"filters-panel",role:"region","aria-label":"Панель фильтров"},P={class:"mb-6"},F={class:"space-y-2",role:"group","aria-label":"Фильтр по типу файла"},R={class:"flex items-center gap-2"},A=["value","aria-label"],I={class:"text-sm text-neutral-700 dark:text-neutral-700"},D={key:0,class:"text-xs text-neutral-500 dark:text-neutral-500"},L={class:"mb-6"},T={class:"mb-6"},E={class:"space-y-2"},N={class:"flex items-center gap-2"},G={class:"mb-6"},H={key:0,class:"mt-2"},J={class:"flex flex-wrap gap-1"},K=["onClick","aria-label","aria-pressed"],Q={class:"mb-6"},W={key:0,class:"space-y-3"},X={class:"flex gap-2"},Y=["onUpdate:modelValue"],Z=["onUpdate:modelValue"],ee=["onClick"],ae={key:0,class:"mb-4 p-3 bg-primary-50 dark:bg-primary-50 rounded-md"},le={class:"flex flex-wrap gap-1"},te={class:"flex gap-2 pt-4 border-t border-neutral-300 dark:border-neutral-300"},se=C(e({__name:"FiltersPanel",props:{facets:{},initialFilters:{}},emits:["apply","reset"],setup(e,{emit:k}){const y=e,h=k,_=[{value:"image",label:"Изображения"},{value:"video",label:"Видео"},{value:"document",label:"Документы"},{value:"audio",label:"Аудио"}],w=a([]),q=a(null),C=a(null),z=a(null),V=a([]),U=a(!1),M=a([]);l(()=>y.initialFilters,e=>{e&&(w.value=e.type||[],q.value=e.date_range||null,e.size&&(C.value=e.size.min?e.size.min/1048576:null,z.value=e.size.max?e.size.max/1048576:null),V.value=e.tags||[],e.custom_metadata&&(M.value=Object.entries(e.custom_metadata).map(([e,a])=>({key:e,value:String(a)}))))},{immediate:!0});const se=t(()=>{var e;return(null==(e=y.facets)?void 0:e.tags)?Object.keys(y.facets.tags).sort((e,a)=>{var l,t,s,r;const n=(null==(t=null==(l=y.facets)?void 0:l.tags)?void 0:t[e])||0;return((null==(r=null==(s=y.facets)?void 0:s.tags)?void 0:r[a])||0)-n}):[]}),re=t(()=>w.value.length>0||null!==q.value||null!==C.value||null!==z.value||V.value.length>0||M.value.length>0),ne=t(()=>{const e={};return w.value.length>0&&(e.type=`Тип: ${w.value.join(", ")}`),q.value&&(e.date=`Дата: ${q.value[0]} - ${q.value[1]}`),null===C.value&&null===z.value||(e.size=`Размер: ${C.value||0} - ${z.value||"∞"} MB`),V.value.length>0&&(e.tags=`Теги: ${V.value.join(", ")}`),e});function ue(){M.value.push({key:"",value:""})}function oe(){const e={};if(w.value.length>0&&(e.type=w.value),q.value&&(e.date_range=q.value),null===C.value&&null===z.value||(e.size={min:C.value?1024*C.value*1024:void 0,max:z.value?1024*z.value*1024:void 0}),V.value.length>0&&(e.tags=V.value),M.value.length>0){const a={};M.value.forEach(e=>{e.key&&e.value&&(a[e.key]=e.value)}),Object.keys(a).length>0&&(e.custom_metadata=a)}h("apply",e)}function ie(){w.value=[],q.value=null,C.value=null,z.value=null,V.value=[],M.value=[],h("reset")}return(a,l)=>{var t;return b(),s("div",O,[r("div",P,[l[6]||(l[6]=r("label",{class:"block text-sm font-semibold text-neutral-900 dark:text-neutral-900 mb-3"}," Тип файла ",-1)),r("div",F,[(b(),s(u,null,o(_,a=>{var t,u;return r("label",{key:a.value,class:"flex items-center justify-between gap-2 cursor-pointer p-2 rounded-md hover:bg-neutral-50 dark:hover:bg-neutral-50 transition-colors"},[r("div",R,[d(r("input",{type:"checkbox",value:a.value,"onUpdate:modelValue":l[0]||(l[0]=e=>w.value=e),class:"w-4 h-4 rounded border-neutral-300 text-primary-500 focus:ring-primary-500 min-w-[44px] min-h-[44px]","aria-label":`Фильтр: ${a.label}`},null,8,A),[[x,w.value]]),r("span",I,f(a.label),1)]),(null==(u=null==(t=e.facets)?void 0:t.type)?void 0:u[a.value])?(b(),s("span",D,f(e.facets.type[a.value]),1)):n("",!0)])}),64))])]),r("div",L,[l[7]||(l[7]=r("label",{class:"block text-sm font-semibold text-neutral-900 dark:text-neutral-900 mb-3"}," Дата добавления ",-1)),i(B,{modelValue:q.value,"onUpdate:modelValue":l[1]||(l[1]=e=>q.value=e)},null,8,["modelValue"])]),r("div",T,[l[9]||(l[9]=r("label",{class:"block text-sm font-semibold text-neutral-900 dark:text-neutral-900 mb-3"}," Размер файла ",-1)),r("div",E,[r("div",N,[d(r("input",{"onUpdate:modelValue":l[2]||(l[2]=e=>C.value=e),type:"number",placeholder:"Мин (MB)",class:"flex-1 px-3 py-2 border border-neutral-300 dark:border-neutral-300 rounded-md text-sm bg-neutral-0 dark:bg-neutral-0 text-neutral-900 dark:text-neutral-900 focus:outline-none focus:ring-2 focus:ring-primary-500 min-h-[44px]","aria-label":"Минимальный размер файла в мегабайтах"},null,512),[[c,C.value,void 0,{number:!0}]]),l[8]||(l[8]=r("span",{class:"text-neutral-500","aria-hidden":"true"},"—",-1)),d(r("input",{"onUpdate:modelValue":l[3]||(l[3]=e=>z.value=e),type:"number",placeholder:"Макс (MB)",class:"flex-1 px-3 py-2 border border-neutral-300 dark:border-neutral-300 rounded-md text-sm bg-neutral-0 dark:bg-neutral-0 text-neutral-900 dark:text-neutral-900 focus:outline-none focus:ring-2 focus:ring-primary-500 min-h-[44px]","aria-label":"Максимальный размер файла в мегабайтах"},null,512),[[c,z.value,void 0,{number:!0}]])])])]),r("div",G,[l[11]||(l[11]=r("label",{class:"block text-sm font-semibold text-neutral-900 dark:text-neutral-900 mb-3"}," Теги ",-1)),i($,{modelValue:V.value,"onUpdate:modelValue":l[4]||(l[4]=e=>V.value=e),suggestions:se.value,placeholder:"Введите тег...","allow-custom":!0},null,8,["modelValue","suggestions"]),(null==(t=e.facets)?void 0:t.tags)&&Object.keys(e.facets.tags).length>0?(b(),s("div",H,[l[10]||(l[10]=r("p",{class:"text-xs text-neutral-500 dark:text-neutral-500 mb-2"},"Популярные теги:",-1)),r("div",J,[(b(!0),s(u,null,o(e.facets.tags,(e,a)=>(b(),s("button",{key:a,class:v(["px-2 py-1 text-xs rounded-md transition-colors min-h-[44px]",V.value.includes(a)?"bg-primary-500 text-white":"bg-neutral-100 dark:bg-neutral-100 text-neutral-700 dark:text-neutral-700 hover:bg-neutral-200 dark:hover:bg-neutral-200"]),onClick:e=>function(e){const a=V.value.indexOf(e);-1===a?V.value.push(e):V.value.splice(a,1)}(a),type:"button","aria-label":`${V.value.includes(a)?"Убрать":"Добавить"} тег ${a}`,"aria-pressed":V.value.includes(a)},f(a)+" ("+f(e)+") ",11,K))),128))])])):n("",!0)]),r("div",Q,[r("button",{class:"flex items-center justify-between w-full text-sm font-semibold text-neutral-900 dark:text-neutral-900 mb-3",onClick:l[5]||(l[5]=e=>U.value=!U.value)},[l[13]||(l[13]=r("span",null,"Дополнительные фильтры",-1)),(b(),s("svg",{class:v(["w-4 h-4 transition-transform",U.value?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...l[12]||(l[12]=[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),U.value?(b(),s("div",W,[(b(!0),s(u,null,o(M.value,(e,a)=>(b(),s("div",{key:a,class:"space-y-1"},[r("div",X,[d(r("input",{"onUpdate:modelValue":a=>e.key=a,type:"text",placeholder:"Ключ",class:"flex-1 px-3 py-2 border border-neutral-300 dark:border-neutral-300 rounded-md text-sm bg-neutral-0 dark:bg-neutral-0 text-neutral-900 dark:text-neutral-900 focus:outline-none focus:ring-2 focus:ring-primary-500"},null,8,Y),[[c,e.key]]),d(r("input",{"onUpdate:modelValue":a=>e.value=a,type:"text",placeholder:"Значение",class:"flex-1 px-3 py-2 border border-neutral-300 dark:border-neutral-300 rounded-md text-sm bg-neutral-0 dark:bg-neutral-0 text-neutral-900 dark:text-neutral-900 focus:outline-none focus:ring-2 focus:ring-primary-500"},null,8,Z),[[c,e.value]]),r("button",{class:"px-2 text-error hover:text-error-600 transition-colors",onClick:e=>function(e){M.value.splice(e,1)}(a),"aria-label":"Удалить фильтр"},[...l[14]||(l[14]=[r("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,ee)])]))),128)),r("button",{class:"text-sm text-primary-500 hover:text-primary-600 transition-colors",onClick:ue}," + Добавить фильтр ")])):n("",!0)]),re.value?(b(),s("div",ae,[l[15]||(l[15]=r("p",{class:"text-xs font-semibold text-neutral-900 dark:text-neutral-900 mb-2"}," Активные фильтры: ",-1)),r("div",le,[(b(!0),s(u,null,o(ne.value,(e,a)=>(b(),g(S,{key:a,variant:"info",size:"sm",class:"cursor-pointer",onClick:e=>function(e){switch(e){case"type":w.value=[];break;case"date":q.value=null;break;case"size":C.value=null,z.value=null;break;case"tags":V.value=[]}}(a)},{default:p(()=>[m(f(e),1)]),_:2},1032,["onClick"]))),128))])])):n("",!0),r("div",te,[i(j,{variant:"primary",size:"sm",class:"flex-1",disabled:!re.value,onClick:oe},{default:p(()=>[...l[16]||(l[16]=[m(" Применить ",-1)])]),_:1},8,["disabled"]),i(j,{variant:"outline",size:"sm",class:"flex-1",disabled:!re.value,onClick:ie},{default:p(()=>[...l[17]||(l[17]=[m(" Сбросить ",-1)])]),_:1},8,["disabled"])])])}}}),[["__scopeId","data-v-52dcbc2f"]]),re={class:"advanced-search-page"},ne={class:"max-w-7xl mx-auto p-6"},ue={class:"mb-6"},oe={class:"grid grid-cols-1 lg:grid-cols-4 gap-6"},ie={class:"lg:col-span-1"},de={class:"bg-neutral-0 dark:bg-neutral-0 border border-neutral-300 dark:border-neutral-300 rounded-lg p-4 sticky top-4"},ce={class:"lg:col-span-3"},ve={class:"flex items-center justify-between mb-4"},pe={class:"text-sm text-neutral-600 dark:text-neutral-600"},me={class:"font-semibold"},be={class:"flex items-center gap-2"},xe={key:0,class:"p-8 text-center"},fe={key:1,class:"p-8 text-center"},ge={class:"text-error"},ke={key:2,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},ye={key:3,class:"p-8 text-center"},he=C(e({__name:"AdvancedSearchPage",setup(e){const t=y(),c=q(),v=z(),p=a("relevance"),x=a(1),j=a(50),C=a({});function S(e){x.value=1,c.push({path:"/dam/search",query:{q:e}})}function $(e){c.push(`/dam/assets/${e}`)}function B(e){c.push(`/dam/assets/${e.id}`)}function O(e){C.value=e,x.value=1;const a={q:t.query.q||"",filters:e,sort:p.value,limit:j.value,offset:0};v.advancedSearch(a)}function P(){C.value={},x.value=1;const e=t.query.q;if(e){const a={q:e,sort:p.value,limit:j.value,offset:0};v.advancedSearch(a)}else v.clearSearch()}function F(){x.value=1;const e={q:t.query.q||"",sort:p.value,limit:j.value,offset:0};v.advancedSearch(e)}function R(e){x.value=e;const a={q:t.query.q||"",sort:p.value,limit:j.value,offset:(e-1)*j.value};v.advancedSearch(a)}function A(){const e=t.query.q;e&&v.performSearch(e,j.value)}return k(()=>{const e=t.query.q;if(e){const a={q:e,sort:p.value,limit:j.value,offset:0};v.advancedSearch(a)}}),l(()=>t.query.q,e=>{if(e&&"string"==typeof e){const a={q:e,filters:C.value,sort:p.value,limit:j.value,offset:(x.value-1)*j.value};v.advancedSearch(a)}}),(e,a)=>(b(),s("div",re,[r("div",ne,[r("div",ue,[a[1]||(a[1]=r("h1",{class:"text-2xl font-bold text-neutral-900 dark:text-neutral-900 mb-4"}," Расширенный поиск ",-1)),i(V,{placeholder:"Введите запрос для поиска...",onSearch:S,onResultSelected:$})]),r("div",oe,[r("div",ie,[r("div",de,[a[2]||(a[2]=r("h2",{class:"text-sm font-semibold text-neutral-900 dark:text-neutral-900 mb-4"}," Фильтры ",-1)),i(se,{facets:h(v).facets,"initial-filters":C.value,onApply:O,onReset:P},null,8,["facets","initial-filters"])])]),r("div",ce,[r("div",ve,[r("div",null,[r("p",pe,[a[3]||(a[3]=m(" Найдено результатов: ",-1)),r("span",me,f(h(v).totalCount),1)])]),r("div",be,[a[5]||(a[5]=r("label",{class:"text-sm text-neutral-600 dark:text-neutral-600"},"Сортировка:",-1)),d(r("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>p.value=e),class:"px-3 py-1 border border-neutral-300 dark:border-neutral-300 rounded-md text-sm bg-neutral-0 dark:bg-neutral-0 text-neutral-900 dark:text-neutral-900",onChange:F},[...a[4]||(a[4]=[w('<option value="relevance" data-v-b5b6476f>По релевантности</option><option value="-date_added" data-v-b5b6476f>Сначала новые</option><option value="date_added" data-v-b5b6476f>Сначала старые</option><option value="label" data-v-b5b6476f>По названию (А-Я)</option><option value="-label" data-v-b5b6476f>По названию (Я-А)</option><option value="-size" data-v-b5b6476f>По размеру (большие)</option><option value="size" data-v-b5b6476f>По размеру (маленькие)</option>',7)])],544),[[_,p.value]])])]),h(v).isLoading?(b(),s("div",xe,[...a[6]||(a[6]=[r("div",{class:"animate-spin h-8 w-8 mx-auto text-primary-500"},null,-1),r("p",{class:"mt-4 text-neutral-600 dark:text-neutral-600"},"Поиск...",-1)])])):h(v).error?(b(),s("div",fe,[r("p",ge,f(h(v).error),1),r("button",{class:"mt-4 px-4 py-2 bg-primary-500 text-white rounded-md hover:bg-primary-600 transition-colors",onClick:A}," Попробовать снова ")])):h(v).hasResults?(b(),s("div",ke,[(b(!0),s(u,null,o(h(v).results,e=>(b(),g(U,{key:e.id,asset:e,"is-selected":!1,"show-checkbox":!1,onOpen:B},null,8,["asset"]))),128))])):(b(),s("div",ye,[...a[7]||(a[7]=[r("svg",{class:"mx-auto h-12 w-12 text-neutral-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1),r("h3",{class:"mt-4 text-lg font-medium text-neutral-900 dark:text-neutral-900"}," Нет результатов ",-1),r("p",{class:"mt-2 text-sm text-neutral-600 dark:text-neutral-600"}," Попробуйте изменить запрос или фильтры ",-1)])])),h(v).totalCount>0?(b(),g(M,{key:4,"current-page":x.value,"total-items":h(v).totalCount,"page-size":j.value,onPageChange:R,class:"mt-6"},null,8,["current-page","total-items","page-size"])):n("",!0)])])])]))}}),[["__scopeId","data-v-b5b6476f"]]);export{he as default};
//# sourceMappingURL=AdvancedSearchPage-CqTnTRpT.js.map

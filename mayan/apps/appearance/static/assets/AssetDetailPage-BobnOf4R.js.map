{"version":3,"file":"AssetDetailPage-BobnOf4R.js","sources":["../../src/services/commentService.ts","../../src/services/websocketService.ts","../../src/utils/constants.ts","../../src/components/DAM/CommentItem.vue","../../src/components/DAM/CommentsThread.vue","../../src/components/DAM/VersionHistory.vue","../../src/components/DAM/MetadataPanel.vue","../../src/pages/AssetDetailPage.vue"],"sourcesContent":["import { apiService } from './apiService'\r\nimport type {\r\n  Comment,\r\n  CreateCommentRequest,\r\n  UpdateCommentRequest,\r\n  PaginatedResponse\r\n} from '@/types/api'\r\n\r\nclass CommentService {\r\n  /**\r\n   * Get comments for an asset\r\n   */\r\n  async getComments(assetId: number): Promise<Comment[]> {\r\n    const response = await apiService.get<PaginatedResponse<Comment>>(\r\n      `/v4/dam/assets/${assetId}/comments/`\r\n    )\r\n    return response.results || []\r\n  }\r\n\r\n  /**\r\n   * Create a new comment\r\n   */\r\n  async createComment(\r\n    assetId: number,\r\n    comment: CreateCommentRequest\r\n  ): Promise<Comment> {\r\n    return apiService.post<Comment>(\r\n      `/v4/dam/assets/${assetId}/comments/`,\r\n      comment\r\n    )\r\n  }\r\n\r\n  /**\r\n   * Update an existing comment\r\n   */\r\n  async updateComment(\r\n    assetId: number,\r\n    commentId: number,\r\n    comment: UpdateCommentRequest\r\n  ): Promise<Comment> {\r\n    return apiService.put<Comment>(\r\n      `/v4/dam/assets/${assetId}/comments/${commentId}/`,\r\n      comment\r\n    )\r\n  }\r\n\r\n  /**\r\n   * Delete a comment\r\n   */\r\n  async deleteComment(assetId: number, commentId: number): Promise<void> {\r\n    return apiService.delete<void>(\r\n      `/v4/dam/assets/${assetId}/comments/${commentId}/`\r\n    )\r\n  }\r\n\r\n  /**\r\n   * Create a reply to a comment\r\n   */\r\n  async createReply(\r\n    assetId: number,\r\n    parentId: number,\r\n    comment: CreateCommentRequest\r\n  ): Promise<Comment> {\r\n    return apiService.post<Comment>(\r\n      `/v4/dam/assets/${assetId}/comments/`,\r\n      {\r\n        ...comment,\r\n        parent_id: parentId\r\n      }\r\n    )\r\n  }\r\n}\r\n\r\nexport const commentService = new CommentService()\r\n\r\n","/**\r\n * WebSocket service stub for real-time updates\r\n * This is a placeholder implementation that can be extended with actual WebSocket connection\r\n */\r\n\r\nimport { WS_URL } from '@/utils/constants'\r\n\r\ntype WebSocketEventType =\r\n  | 'comment_added'\r\n  | 'comment_updated'\r\n  | 'comment_deleted'\r\n  | 'asset_updated'\r\n  | 'version_added'\r\n  | 'notification'\r\n\r\ntype WebSocketEventHandler = (data: unknown) => void\r\n\r\nclass WebSocketService {\r\n  private ws: WebSocket | null = null\r\n  private reconnectAttempts = 0\r\n  private maxReconnectAttempts = 5\r\n  private reconnectDelay = 1000\r\n  private eventHandlers: Map<WebSocketEventType, Set<WebSocketEventHandler>> = new Map()\r\n  private isConnecting = false\r\n\r\n  /**\r\n   * Connect to WebSocket server\r\n   */\r\n  connect(): void {\r\n    if (this.ws?.readyState === WebSocket.OPEN || this.isConnecting) {\r\n      return\r\n    }\r\n\r\n    this.isConnecting = true\r\n\r\n    try {\r\n      const wsUrl = WS_URL\r\n      this.ws = new WebSocket(wsUrl)\r\n\r\n      this.ws.onopen = () => {\r\n        console.log('WebSocket connected')\r\n        this.isConnecting = false\r\n        this.reconnectAttempts = 0\r\n        this.emit('connected', {})\r\n      }\r\n\r\n      this.ws.onmessage = (event) => {\r\n        try {\r\n          const message = JSON.parse(event.data)\r\n          this.handleMessage(message)\r\n        } catch (error) {\r\n          console.error('Failed to parse WebSocket message:', error)\r\n        }\r\n      }\r\n\r\n      this.ws.onerror = (error) => {\r\n        console.error('WebSocket error:', error)\r\n        this.isConnecting = false\r\n      }\r\n\r\n      this.ws.onclose = () => {\r\n        console.log('WebSocket disconnected')\r\n        this.isConnecting = false\r\n        this.ws = null\r\n        this.emit('disconnected', {})\r\n\r\n        // Attempt to reconnect\r\n        if (this.reconnectAttempts < this.maxReconnectAttempts) {\r\n          this.reconnectAttempts++\r\n          setTimeout(() => {\r\n            this.connect()\r\n          }, this.reconnectDelay * this.reconnectAttempts)\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to connect WebSocket:', error)\r\n      this.isConnecting = false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Disconnect from WebSocket server\r\n   */\r\n  disconnect(): void {\r\n    if (this.ws) {\r\n      this.ws.close()\r\n      this.ws = null\r\n    }\r\n    this.reconnectAttempts = this.maxReconnectAttempts // Prevent reconnection\r\n  }\r\n\r\n  /**\r\n   * Subscribe to an event type\r\n   */\r\n  on(eventType: WebSocketEventType, handler: WebSocketEventHandler): () => void {\r\n    if (!this.eventHandlers.has(eventType)) {\r\n      this.eventHandlers.set(eventType, new Set())\r\n    }\r\n    this.eventHandlers.get(eventType)!.add(handler)\r\n\r\n    // Return unsubscribe function\r\n    return () => {\r\n      this.off(eventType, handler)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe from an event type\r\n   */\r\n  off(eventType: WebSocketEventType, handler: WebSocketEventHandler): void {\r\n    const handlers = this.eventHandlers.get(eventType)\r\n    if (handlers) {\r\n      handlers.delete(handler)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Subscribe to asset-specific events (e.g., comments for a specific asset)\r\n   */\r\n  subscribeToAsset(assetId: number): void {\r\n    if (this.ws?.readyState === WebSocket.OPEN) {\r\n      this.ws.send(\r\n        JSON.stringify({\r\n          type: 'subscribe',\r\n          channel: `asset:${assetId}`\r\n        })\r\n      )\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe from asset-specific events\r\n   */\r\n  unsubscribeFromAsset(assetId: number): void {\r\n    if (this.ws?.readyState === WebSocket.OPEN) {\r\n      this.ws.send(\r\n        JSON.stringify({\r\n          type: 'unsubscribe',\r\n          channel: `asset:${assetId}`\r\n        })\r\n      )\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle incoming WebSocket message\r\n   */\r\n  private handleMessage(message: { type: WebSocketEventType; data: unknown }): void {\r\n    const { type, data } = message\r\n    const handlers = this.eventHandlers.get(type)\r\n    if (handlers) {\r\n      handlers.forEach((handler) => {\r\n        try {\r\n          handler(data)\r\n        } catch (error) {\r\n          console.error(`Error in WebSocket event handler for ${type}:`, error)\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Emit a local event (for testing/stubbing)\r\n   */\r\n  private emit(type: WebSocketEventType | 'connected' | 'disconnected', data: unknown): void {\r\n    if (type === 'connected' || type === 'disconnected') {\r\n      // These are internal events, not forwarded\r\n      return\r\n    }\r\n    this.handleMessage({ type, data })\r\n  }\r\n\r\n  /**\r\n   * Check if WebSocket is connected\r\n   */\r\n  get isConnected(): boolean {\r\n    return this.ws?.readyState === WebSocket.OPEN || false\r\n  }\r\n\r\n  /**\r\n   * Simulate a WebSocket event (for testing/stubbing when WebSocket is not available)\r\n   */\r\n  simulateEvent(type: WebSocketEventType, data: unknown): void {\r\n    this.handleMessage({ type, data })\r\n  }\r\n}\r\n\r\nexport const websocketService = new WebSocketService()\r\n\r\n// Auto-connect on import (optional - can be controlled manually)\r\n// websocketService.connect()\r\n\r\n","/**\r\n * Application constants\r\n */\r\n\r\nexport const API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:8000/api'\r\nexport const WS_URL = import.meta.env.VITE_WS_URL || 'ws://localhost:8000/ws'\r\n\r\nexport const APP_TITLE = import.meta.env.VITE_APP_TITLE || 'DAM System'\r\nexport const APP_VERSION = import.meta.env.VITE_APP_VERSION || '1.0.0'\r\n\r\n// Pagination\r\nexport const DEFAULT_PAGE_SIZE = 50\r\nexport const MAX_PAGE_SIZE = 100\r\n\r\n// File upload\r\nexport const MAX_FILE_SIZE = 100 * 1024 * 1024 // 100MB\r\nexport const ALLOWED_IMAGE_TYPES = ['image/jpeg', 'image/png', 'image/gif', 'image/webp']\r\nexport const ALLOWED_VIDEO_TYPES = ['video/mp4', 'video/webm', 'video/ogg']\r\nexport const ALLOWED_DOCUMENT_TYPES = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document']\r\n\r\n// Debounce delays\r\nexport const SEARCH_DEBOUNCE_MS = 300\r\nexport const INPUT_DEBOUNCE_MS = 500\r\n\r\n// Cache TTL\r\nexport const CACHE_TTL = 5 * 60 * 1000 // 5 minutes\r\n\r\n\r\n","<template>\r\n  <div class=\"comment-item\">\r\n    <div class=\"flex gap-3\">\r\n      <!-- Avatar -->\r\n      <div class=\"flex-shrink-0\">\r\n        <div\r\n          v-if=\"comment.author_avatar\"\r\n          class=\"w-10 h-10 rounded-full bg-neutral-200 dark:bg-neutral-200 overflow-hidden\"\r\n        >\r\n          <img :src=\"comment.author_avatar\" :alt=\"comment.author\" class=\"w-full h-full object-cover\" />\r\n        </div>\r\n        <div\r\n          v-else\r\n          class=\"w-10 h-10 rounded-full bg-primary-500 flex items-center justify-center text-white font-semibold\"\r\n        >\r\n          {{ comment.author.charAt(0).toUpperCase() }}\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Comment Content -->\r\n      <div class=\"flex-1\">\r\n        <div class=\"bg-neutral-50 dark:bg-neutral-50 rounded-lg p-3\">\r\n          <!-- Header -->\r\n          <div class=\"flex items-center justify-between mb-2\">\r\n            <div class=\"flex items-center gap-2\">\r\n              <span class=\"font-semibold text-sm text-neutral-900 dark:text-neutral-900\">\r\n                {{ comment.author }}\r\n              </span>\r\n              <span class=\"text-xs text-neutral-600 dark:text-neutral-600\">\r\n                {{ formatRelativeTime(comment.created_date) }}\r\n              </span>\r\n              <span v-if=\"comment.edited\" class=\"text-xs text-neutral-500 dark:text-neutral-500 italic\">\r\n                (отредактировано)\r\n              </span>\r\n            </div>\r\n            <div v-if=\"canEdit\" class=\"flex items-center gap-1\">\r\n              <button\r\n                v-if=\"!isEditing\"\r\n                class=\"text-xs text-neutral-600 dark:text-neutral-600 hover:text-primary-500\"\r\n                @click=\"startEdit\"\r\n              >\r\n                Редактировать\r\n              </button>\r\n              <button\r\n                class=\"text-xs text-neutral-600 dark:text-neutral-600 hover:text-error\"\r\n                @click=\"handleDelete\"\r\n              >\r\n                Удалить\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Comment Text -->\r\n          <div v-if=\"!isEditing\" class=\"text-sm text-neutral-900 dark:text-neutral-900 whitespace-pre-wrap\">\r\n            <span v-for=\"(part, index) in formattedText\" :key=\"index\">\r\n              <span v-if=\"part.type === 'mention'\" class=\"text-primary-500 font-medium\">\r\n                @{{ part.text }}\r\n              </span>\r\n              <span v-else>{{ part.text }}</span>\r\n            </span>\r\n          </div>\r\n\r\n          <!-- Edit Form -->\r\n          <div v-else class=\"space-y-2\">\r\n            <textarea\r\n              v-model=\"editText\"\r\n              class=\"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-300 rounded-md resize-none focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-0 dark:text-neutral-900\"\r\n              rows=\"3\"\r\n              @keydown.esc=\"cancelEdit\"\r\n              @keydown.ctrl.enter=\"saveEdit\"\r\n              @keydown.meta.enter=\"saveEdit\"\r\n            ></textarea>\r\n            <div class=\"flex justify-end gap-2\">\r\n              <Button variant=\"outline\" size=\"sm\" @click=\"cancelEdit\">\r\n                Отмена\r\n              </Button>\r\n              <Button variant=\"primary\" size=\"sm\" @click=\"saveEdit\">\r\n                Сохранить\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Actions -->\r\n          <div v-if=\"!isEditing\" class=\"mt-2 flex items-center gap-4\">\r\n            <button\r\n              class=\"text-xs text-neutral-600 dark:text-neutral-600 hover:text-primary-500\"\r\n              @click=\"handleReply\"\r\n            >\r\n              Ответить\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Replies -->\r\n        <div v-if=\"comment.replies && comment.replies.length > 0\" class=\"mt-3 ml-4 space-y-3 border-l-2 border-neutral-200 dark:border-neutral-200 pl-4\">\r\n          <CommentItem\r\n            v-for=\"reply in comment.replies\"\r\n            :key=\"reply.id\"\r\n            :comment=\"reply\"\r\n            :current-user-id=\"currentUserId\"\r\n            @reply=\"$emit('reply', $event)\"\r\n            @edit=\"$emit('edit', $event, $event)\"\r\n            @delete=\"$emit('delete', $event)\"\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, computed } from 'vue'\r\nimport type { Comment } from '@/types/api'\r\nimport { formatRelativeTime } from '@/utils/formatters'\r\nimport Button from '@/components/Common/Button.vue'\r\n\r\ninterface Props {\r\n  comment: Comment\r\n  currentUserId?: number\r\n}\r\n\r\nconst props = defineProps<Props>()\r\n\r\nconst emit = defineEmits<{\r\n  reply: [comment: Comment]\r\n  edit: [comment: Comment, newText: string]\r\n  delete: [comment: Comment]\r\n}>()\r\n\r\nconst isEditing = ref(false)\r\nconst editText = ref('')\r\n\r\nconst canEdit = computed(() => {\r\n  return props.currentUserId && props.comment.author_id === props.currentUserId\r\n})\r\n\r\nconst formattedText = computed(() => {\r\n  const text = props.comment.text\r\n  const parts: Array<{ type: 'text' | 'mention'; text: string }> = []\r\n  const mentionRegex = /@(\\w+)/g\r\n  let lastIndex = 0\r\n  let match\r\n\r\n  while ((match = mentionRegex.exec(text)) !== null) {\r\n    // Add text before mention\r\n    if (match.index > lastIndex) {\r\n      parts.push({\r\n        type: 'text',\r\n        text: text.substring(lastIndex, match.index)\r\n      })\r\n    }\r\n    // Add mention\r\n    parts.push({\r\n      type: 'mention',\r\n      text: match[1]\r\n    })\r\n    lastIndex = match.index + match[0].length\r\n  }\r\n\r\n  // Add remaining text\r\n  if (lastIndex < text.length) {\r\n    parts.push({\r\n      type: 'text',\r\n      text: text.substring(lastIndex)\r\n    })\r\n  }\r\n\r\n  return parts.length > 0 ? parts : [{ type: 'text', text }]\r\n})\r\n\r\nfunction startEdit() {\r\n  editText.value = props.comment.text\r\n  isEditing.value = true\r\n}\r\n\r\nfunction cancelEdit() {\r\n  isEditing.value = false\r\n  editText.value = ''\r\n}\r\n\r\nfunction saveEdit() {\r\n  if (editText.value.trim() && editText.value !== props.comment.text) {\r\n    emit('edit', props.comment, editText.value.trim())\r\n  }\r\n  isEditing.value = false\r\n}\r\n\r\nfunction handleReply() {\r\n  emit('reply', props.comment)\r\n}\r\n\r\nfunction handleDelete() {\r\n  if (confirm('Вы уверены, что хотите удалить этот комментарий?')) {\r\n    emit('delete', props.comment)\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.comment-item {\r\n  margin-bottom: 0.5rem;\r\n}\r\n</style>\r\n\r\n","<template>\r\n  <div class=\"comments-thread\">\r\n    <div class=\"flex items-center justify-between mb-4\">\r\n      <h3 class=\"text-lg font-semibold text-neutral-900 dark:text-neutral-900\">\r\n        Комментарии ({{ totalCommentsCount }})\r\n      </h3>\r\n    </div>\r\n\r\n    <!-- Add Comment Form -->\r\n    <div class=\"mb-6\">\r\n      <div class=\"flex gap-3\">\r\n        <div class=\"flex-1\">\r\n          <textarea\r\n            v-model=\"newCommentText\"\r\n            :placeholder=\"replyingTo ? `Ответить ${replyingTo.author}...` : 'Добавить комментарий...'\"\r\n            class=\"w-full px-4 py-2 border border-neutral-300 dark:border-neutral-300 rounded-md resize-none focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-neutral-0 dark:text-neutral-900\"\r\n            rows=\"3\"\r\n            @keydown.ctrl.enter=\"handleSubmitComment\"\r\n            @keydown.meta.enter=\"handleSubmitComment\"\r\n            @input=\"handleMentionInput\"\r\n          ></textarea>\r\n          <div v-if=\"replyingTo\" class=\"mt-2 flex items-center gap-2 text-sm text-neutral-600 dark:text-neutral-600\">\r\n            <span>Ответ на комментарий от {{ replyingTo.author }}</span>\r\n            <button\r\n              class=\"text-primary-500 hover:text-primary-600\"\r\n              @click=\"cancelReply\"\r\n            >\r\n              Отмена\r\n            </button>\r\n          </div>\r\n          <div v-if=\"mentionSuggestions.length > 0\" class=\"mt-2\">\r\n            <div class=\"bg-white dark:bg-neutral-0 border border-neutral-300 dark:border-neutral-300 rounded-md shadow-lg max-h-40 overflow-y-auto\">\r\n              <button\r\n                v-for=\"user in mentionSuggestions\"\r\n                :key=\"user\"\r\n                class=\"w-full text-left px-4 py-2 hover:bg-neutral-100 dark:hover:bg-neutral-100 text-sm\"\r\n                @click=\"selectMention(user)\"\r\n              >\r\n                @{{ user }}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"mt-2 flex justify-end gap-2\">\r\n        <Button\r\n          v-if=\"replyingTo\"\r\n          variant=\"outline\"\r\n          size=\"sm\"\r\n          @click=\"cancelReply\"\r\n        >\r\n          Отмена\r\n        </Button>\r\n        <Button\r\n          variant=\"primary\"\r\n          size=\"sm\"\r\n          :disabled=\"!newCommentText.trim() || isSubmitting\"\r\n          :loading=\"isSubmitting\"\r\n          @click=\"handleSubmitComment\"\r\n        >\r\n          {{ replyingTo ? 'Ответить' : 'Отправить' }}\r\n        </Button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Comments List -->\r\n    <div v-if=\"comments.length > 0\" class=\"space-y-4\">\r\n      <CommentItem\r\n        v-for=\"comment in topLevelComments\"\r\n        :key=\"comment.id\"\r\n        :comment=\"comment\"\r\n        :current-user-id=\"currentUserId\"\r\n        @reply=\"handleReply\"\r\n        @edit=\"handleEdit\"\r\n        @delete=\"handleDelete\"\r\n      />\r\n    </div>\r\n\r\n    <!-- Empty State -->\r\n    <div v-else class=\"text-center py-8 text-neutral-600 dark:text-neutral-600\">\r\n      <svg\r\n        class=\"mx-auto h-12 w-12 mb-4\"\r\n        fill=\"none\"\r\n        stroke=\"currentColor\"\r\n        viewBox=\"0 0 24 24\"\r\n      >\r\n        <path\r\n          stroke-linecap=\"round\"\r\n          stroke-linejoin=\"round\"\r\n          stroke-width=\"2\"\r\n          d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\"\r\n        />\r\n      </svg>\r\n      <p>Пока нет комментариев. Будьте первым!</p>\r\n    </div>\r\n\r\n    <!-- Loading State -->\r\n    <div v-if=\"isLoading\" class=\"text-center py-4\">\r\n      <div class=\"animate-spin h-6 w-6 mx-auto text-primary-500\"></div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, computed, onMounted, onUnmounted, watch } from 'vue'\r\nimport { commentService } from '@/services/commentService'\r\nimport { websocketService } from '@/services/websocketService'\r\nimport type { Comment, CreateCommentRequest } from '@/types/api'\r\nimport { formatRelativeTime } from '@/utils/formatters'\r\nimport Button from '@/components/Common/Button.vue'\r\nimport CommentItem from './CommentItem.vue'\r\nimport { useAuthStore } from '@/stores/authStore'\r\n\r\ninterface Props {\r\n  assetId: number\r\n  initialComments?: Comment[]\r\n}\r\n\r\nconst props = defineProps<Props>()\r\n\r\nconst emit = defineEmits<{\r\n  'comment-added': [comment: Comment]\r\n  'comment-updated': [comment: Comment]\r\n  'comment-deleted': [commentId: number]\r\n}>()\r\n\r\nconst authStore = useAuthStore()\r\nconst comments = ref<Comment[]>(props.initialComments || [])\r\nconst newCommentText = ref('')\r\nconst replyingTo = ref<Comment | null>(null)\r\nconst isSubmitting = ref(false)\r\nconst isLoading = ref(false)\r\nconst mentionSuggestions = ref<string[]>([])\r\nconst currentMentionQuery = ref('')\r\n\r\n// Mock user list for mentions (in real app, this would come from API)\r\nconst availableUsers = ref<string[]>(['admin', 'user1', 'user2', 'designer', 'manager'])\r\n\r\nconst currentUserId = computed(() => authStore.user?.id)\r\n\r\nconst topLevelComments = computed(() => {\r\n  return comments.value.filter((c) => !c.parent_id)\r\n})\r\n\r\nconst totalCommentsCount = computed(() => {\r\n  const countReplies = (comment: Comment): number => {\r\n    return 1 + (comment.replies?.reduce((sum, reply) => sum + countReplies(reply), 0) || 0)\r\n  }\r\n  return topLevelComments.value.reduce((sum, comment) => sum + countReplies(comment), 0)\r\n})\r\n\r\nonMounted(async () => {\r\n  if (!props.initialComments) {\r\n    await loadComments()\r\n  }\r\n\r\n  // Subscribe to WebSocket events for real-time updates\r\n  websocketService.subscribeToAsset(props.assetId)\r\n  \r\n  // Listen for comment events\r\n  const unsubscribeAdded = websocketService.on('comment_added', (data: any) => {\r\n    if (data.asset_id === props.assetId) {\r\n      const newComment = data.comment as Comment\r\n      if (newComment.parent_id) {\r\n        const parent = findCommentById(comments.value, newComment.parent_id)\r\n        if (parent) {\r\n          if (!parent.replies) {\r\n            parent.replies = []\r\n          }\r\n          parent.replies.push(newComment)\r\n        }\r\n      } else {\r\n        comments.value.push(newComment)\r\n      }\r\n    }\r\n  })\r\n\r\n  const unsubscribeUpdated = websocketService.on('comment_updated', (data: any) => {\r\n    if (data.asset_id === props.assetId) {\r\n      const updated = data.comment as Comment\r\n      const found = findCommentById(comments.value, updated.id)\r\n      if (found) {\r\n        found.text = updated.text\r\n        found.updated_date = updated.updated_date\r\n        found.edited = true\r\n      }\r\n    }\r\n  })\r\n\r\n  const unsubscribeDeleted = websocketService.on('comment_deleted', (data: any) => {\r\n    if (data.asset_id === props.assetId) {\r\n      const commentId = data.comment_id as number\r\n      // Remove comment from tree\r\n      if (data.parent_id) {\r\n        const parent = findCommentById(comments.value, data.parent_id)\r\n        if (parent?.replies) {\r\n          const index = parent.replies.findIndex((c) => c.id === commentId)\r\n          if (index !== -1) {\r\n            parent.replies.splice(index, 1)\r\n          }\r\n        }\r\n      } else {\r\n        const index = comments.value.findIndex((c) => c.id === commentId)\r\n        if (index !== -1) {\r\n          comments.value.splice(index, 1)\r\n        }\r\n      }\r\n    }\r\n  })\r\n\r\n  // Store unsubscribe functions for cleanup\r\n  ;(window as any).__commentUnsubscribers = [\r\n    unsubscribeAdded,\r\n    unsubscribeUpdated,\r\n    unsubscribeDeleted\r\n  ]\r\n})\r\n\r\nonUnmounted(() => {\r\n  // Unsubscribe from WebSocket events\r\n  websocketService.unsubscribeFromAsset(props.assetId)\r\n  \r\n  // Clean up event handlers\r\n  const unsubscribers = (window as any).__commentUnsubscribers\r\n  if (unsubscribers) {\r\n    unsubscribers.forEach((unsub: () => void) => unsub())\r\n    delete (window as any).__commentUnsubscribers\r\n  }\r\n})\r\n\r\nwatch(() => props.initialComments, (newComments) => {\r\n  if (newComments) {\r\n    comments.value = newComments\r\n  }\r\n})\r\n\r\nasync function loadComments() {\r\n  isLoading.value = true\r\n  try {\r\n    comments.value = await commentService.getComments(props.assetId)\r\n  } catch (error) {\r\n    console.error('Failed to load comments:', error)\r\n  } finally {\r\n    isLoading.value = false\r\n  }\r\n}\r\n\r\nfunction handleMentionInput(event: Event) {\r\n  const textarea = event.target as HTMLTextAreaElement\r\n  const text = textarea.value\r\n  const cursorPos = textarea.selectionStart\r\n  const textBeforeCursor = text.substring(0, cursorPos)\r\n  const mentionMatch = textBeforeCursor.match(/@(\\w*)$/)\r\n\r\n  if (mentionMatch) {\r\n    currentMentionQuery.value = mentionMatch[1]\r\n    const query = currentMentionQuery.value.toLowerCase()\r\n    mentionSuggestions.value = availableUsers.value.filter((user) =>\r\n      user.toLowerCase().startsWith(query) && user.toLowerCase() !== query\r\n    )\r\n  } else {\r\n    mentionSuggestions.value = []\r\n  }\r\n}\r\n\r\nfunction selectMention(username: string) {\r\n  const textarea = document.querySelector('textarea') as HTMLTextAreaElement\r\n  if (!textarea) return\r\n\r\n  const text = newCommentText.value\r\n  const cursorPos = textarea.selectionStart\r\n  const textBeforeCursor = text.substring(0, cursorPos)\r\n  const mentionMatch = textBeforeCursor.match(/@(\\w*)$/)\r\n\r\n  if (mentionMatch) {\r\n    const start = cursorPos - mentionMatch[0].length\r\n    newCommentText.value =\r\n      text.substring(0, start) + `@${username} ` + text.substring(cursorPos)\r\n    mentionSuggestions.value = []\r\n    currentMentionQuery.value = ''\r\n    \r\n    // Set cursor position after mention\r\n    setTimeout(() => {\r\n      textarea.focus()\r\n      const newPos = start + `@${username} `.length\r\n      textarea.setSelectionRange(newPos, newPos)\r\n    }, 0)\r\n  }\r\n}\r\n\r\nasync function handleSubmitComment() {\r\n  if (!newCommentText.value.trim() || isSubmitting.value) return\r\n\r\n  isSubmitting.value = true\r\n  try {\r\n    const mentions = extractMentions(newCommentText.value)\r\n    const commentData: CreateCommentRequest = {\r\n      text: newCommentText.value.trim(),\r\n      mentions,\r\n      parent_id: replyingTo.value?.id\r\n    }\r\n\r\n    const newComment = await commentService.createComment(props.assetId, commentData)\r\n    \r\n    if (replyingTo.value) {\r\n      // Add reply to parent comment\r\n      const parent = findCommentById(comments.value, replyingTo.value.id)\r\n      if (parent) {\r\n        if (!parent.replies) {\r\n          parent.replies = []\r\n        }\r\n        parent.replies.push(newComment)\r\n      }\r\n      replyingTo.value = null\r\n    } else {\r\n      // Add as top-level comment\r\n      comments.value.push(newComment)\r\n    }\r\n\r\n    newCommentText.value = ''\r\n    emit('comment-added', newComment)\r\n  } catch (error) {\r\n    console.error('Failed to create comment:', error)\r\n    // TODO: Show error toast\r\n  } finally {\r\n    isSubmitting.value = false\r\n  }\r\n}\r\n\r\nfunction extractMentions(text: string): string[] {\r\n  const mentionRegex = /@(\\w+)/g\r\n  const mentions: string[] = []\r\n  let match\r\n\r\n  while ((match = mentionRegex.exec(text)) !== null) {\r\n    mentions.push(match[1])\r\n  }\r\n\r\n  return [...new Set(mentions)] // Remove duplicates\r\n}\r\n\r\nfunction findCommentById(commentsList: Comment[], id: number): Comment | null {\r\n  for (const comment of commentsList) {\r\n    if (comment.id === id) return comment\r\n    if (comment.replies) {\r\n      const found = findCommentById(comment.replies, id)\r\n      if (found) return found\r\n    }\r\n  }\r\n  return null\r\n}\r\n\r\nfunction handleReply(comment: Comment) {\r\n  replyingTo.value = comment\r\n  // Scroll to textarea\r\n  setTimeout(() => {\r\n    const textarea = document.querySelector('textarea')\r\n    textarea?.focus()\r\n  }, 100)\r\n}\r\n\r\nfunction cancelReply() {\r\n  replyingTo.value = null\r\n}\r\n\r\nasync function handleEdit(comment: Comment, newText: string) {\r\n  try {\r\n    const updated = await commentService.updateComment(\r\n      props.assetId,\r\n      comment.id,\r\n      { text: newText }\r\n    )\r\n    \r\n    // Update comment in tree\r\n    const found = findCommentById(comments.value, comment.id)\r\n    if (found) {\r\n      found.text = updated.text\r\n      found.updated_date = updated.updated_date\r\n      found.edited = true\r\n    }\r\n    \r\n    emit('comment-updated', updated)\r\n  } catch (error) {\r\n    console.error('Failed to update comment:', error)\r\n  }\r\n}\r\n\r\nasync function handleDelete(comment: Comment) {\r\n  if (!confirm('Вы уверены, что хотите удалить этот комментарий?')) {\r\n    return\r\n  }\r\n\r\n  try {\r\n    await commentService.deleteComment(props.assetId, comment.id)\r\n    \r\n    // Remove comment from tree\r\n    if (comment.parent_id) {\r\n      const parent = findCommentById(comments.value, comment.parent_id)\r\n      if (parent?.replies) {\r\n        const index = parent.replies.findIndex((c) => c.id === comment.id)\r\n        if (index !== -1) {\r\n          parent.replies.splice(index, 1)\r\n        }\r\n      }\r\n    } else {\r\n      const index = comments.value.findIndex((c) => c.id === comment.id)\r\n      if (index !== -1) {\r\n        comments.value.splice(index, 1)\r\n      }\r\n    }\r\n    \r\n    emit('comment-deleted', comment.id)\r\n  } catch (error) {\r\n    console.error('Failed to delete comment:', error)\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.comments-thread {\r\n  padding: 1rem;\r\n}\r\n</style>\r\n\r\n","<template>\r\n  <div class=\"version-history\">\r\n    <div class=\"flex items-center justify-between mb-4\">\r\n      <h3 class=\"text-lg font-semibold text-neutral-900 dark:text-neutral-900\">\r\n        История версий ({{ versions.length }})\r\n      </h3>\r\n    </div>\r\n\r\n    <!-- Versions List -->\r\n    <div v-if=\"versions.length > 0\" class=\"space-y-2\">\r\n      <div\r\n        v-for=\"(version, index) in versions\"\r\n        :key=\"version.id\"\r\n        :class=\"[\r\n          'p-4 rounded-lg border transition-colors',\r\n          version.is_current\r\n            ? 'bg-primary-50 dark:bg-primary-50 border-primary-300 dark:border-primary-300'\r\n            : 'bg-neutral-50 dark:bg-neutral-50 border-neutral-300 dark:border-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-100'\r\n        ]\"\r\n      >\r\n        <div class=\"flex items-start justify-between\">\r\n          <div class=\"flex-1\">\r\n            <div class=\"flex items-center gap-2 mb-2\">\r\n              <span class=\"font-medium text-neutral-900 dark:text-neutral-900\">\r\n                {{ version.filename }}\r\n              </span>\r\n              <Badge\r\n                v-if=\"version.is_current\"\r\n                variant=\"success\"\r\n                size=\"sm\"\r\n              >\r\n                Текущая версия\r\n              </Badge>\r\n              <Badge\r\n                v-else-if=\"index === 0\"\r\n                variant=\"info\"\r\n                size=\"sm\"\r\n              >\r\n                Последняя\r\n              </Badge>\r\n            </div>\r\n            <div class=\"text-sm text-neutral-600 dark:text-neutral-600 space-y-1\">\r\n              <div class=\"flex items-center gap-4\">\r\n                <span>{{ formatDate(version.uploaded_date) }}</span>\r\n                <span v-if=\"version.uploaded_by\">• {{ version.uploaded_by }}</span>\r\n                <span>• {{ formatFileSize(version.size) }}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Actions -->\r\n          <div class=\"flex items-center gap-2 ml-4\">\r\n            <Button\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              @click=\"handleDownload(version)\"\r\n            >\r\n              <svg class=\"w-4 h-4 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path\r\n                  stroke-linecap=\"round\"\r\n                  stroke-linejoin=\"round\"\r\n                  stroke-width=\"2\"\r\n                  d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4\"\r\n                />\r\n              </svg>\r\n              Скачать\r\n            </Button>\r\n            <Button\r\n              v-if=\"!version.is_current && canRestore\"\r\n              variant=\"primary\"\r\n              size=\"sm\"\r\n              @click=\"handleRestore(version)\"\r\n            >\r\n              <svg class=\"w-4 h-4 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path\r\n                  stroke-linecap=\"round\"\r\n                  stroke-linejoin=\"round\"\r\n                  stroke-width=\"2\"\r\n                  d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"\r\n                />\r\n              </svg>\r\n              Восстановить\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Empty State -->\r\n    <div v-else class=\"text-center py-8 text-neutral-600 dark:text-neutral-600\">\r\n      <svg\r\n        class=\"mx-auto h-12 w-12 mb-4\"\r\n        fill=\"none\"\r\n        stroke=\"currentColor\"\r\n        viewBox=\"0 0 24 24\"\r\n      >\r\n        <path\r\n          stroke-linecap=\"round\"\r\n          stroke-linejoin=\"round\"\r\n          stroke-width=\"2\"\r\n          d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n        />\r\n      </svg>\r\n      <p>История версий пуста</p>\r\n    </div>\r\n\r\n    <!-- Loading State -->\r\n    <div v-if=\"isLoading\" class=\"text-center py-4\">\r\n      <div class=\"animate-spin h-6 w-6 mx-auto text-primary-500\"></div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, onMounted, watch } from 'vue'\r\nimport { assetService } from '@/services/assetService'\r\nimport type { Version } from '@/types/api'\r\nimport { formatDate, formatFileSize } from '@/utils/formatters'\r\nimport Button from '@/components/Common/Button.vue'\r\nimport Badge from '@/components/Common/Badge.vue'\r\nimport { useAuthStore } from '@/stores/authStore'\r\n\r\ninterface Props {\r\n  assetId: number\r\n  initialVersions?: Version[]\r\n  canRestore?: boolean\r\n}\r\n\r\nconst props = withDefaults(defineProps<Props>(), {\r\n  canRestore: true\r\n})\r\n\r\nconst emit = defineEmits<{\r\n  'version-download': [version: Version]\r\n  'version-restore': [version: Version]\r\n}>()\r\n\r\nconst authStore = useAuthStore()\r\nconst versions = ref<Version[]>(props.initialVersions || [])\r\nconst isLoading = ref(false)\r\n\r\nonMounted(async () => {\r\n  if (!props.initialVersions) {\r\n    await loadVersions()\r\n  }\r\n})\r\n\r\nwatch(() => props.initialVersions, (newVersions) => {\r\n  if (newVersions) {\r\n    versions.value = newVersions\r\n  }\r\n})\r\n\r\nasync function loadVersions() {\r\n  isLoading.value = true\r\n  try {\r\n    // In real implementation, this would be a separate endpoint\r\n    // For now, we'll get it from asset detail\r\n    const asset = await assetService.getAsset(props.assetId)\r\n    if (asset.version_history) {\r\n      versions.value = asset.version_history\r\n    }\r\n  } catch (error) {\r\n    console.error('Failed to load versions:', error)\r\n  } finally {\r\n    isLoading.value = false\r\n  }\r\n}\r\n\r\nfunction handleDownload(version: Version) {\r\n  if (version.download_url) {\r\n    window.open(version.download_url, '_blank')\r\n  } else {\r\n    // Fallback: construct download URL\r\n    const downloadUrl = `/api/v4/dam/assets/${props.assetId}/versions/${version.id}/download/`\r\n    window.open(downloadUrl, '_blank')\r\n  }\r\n  emit('version-download', version)\r\n}\r\n\r\nasync function handleRestore(version: Version) {\r\n  if (!confirm(`Вы уверены, что хотите восстановить версию \"${version.filename}\"?`)) {\r\n    return\r\n  }\r\n\r\n  try {\r\n    if (version.restore_url) {\r\n      // Use restore URL if available\r\n      await fetch(version.restore_url, { method: 'POST' })\r\n    } else {\r\n      // Fallback: use asset service\r\n      // This would need to be added to assetService\r\n      await assetService.updateAsset(props.assetId, {\r\n        version_id: version.id\r\n      } as any)\r\n    }\r\n\r\n    // Reload versions to update current version\r\n    await loadVersions()\r\n    emit('version-restore', version)\r\n    \r\n    // TODO: Show success toast\r\n  } catch (error) {\r\n    console.error('Failed to restore version:', error)\r\n    // TODO: Show error toast\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.version-history {\r\n  padding: 1rem;\r\n}\r\n</style>\r\n\r\n","<template>\r\n  <div class=\"metadata-panel\">\r\n    <!-- File Details Section -->\r\n    <section class=\"mb-6\">\r\n      <h3 class=\"text-sm font-semibold text-neutral-900 dark:text-neutral-900 mb-3\">\r\n        Информация о файле\r\n      </h3>\r\n      <div class=\"space-y-2 text-sm\">\r\n        <div class=\"flex justify-between\">\r\n          <span class=\"text-neutral-600 dark:text-neutral-600\">Название:</span>\r\n          <span class=\"text-neutral-900 dark:text-neutral-900 font-medium\">{{ asset?.label || 'N/A' }}</span>\r\n        </div>\r\n        <div v-if=\"fileDetails\" class=\"flex justify-between\">\r\n          <span class=\"text-neutral-600 dark:text-neutral-600\">Имя файла:</span>\r\n          <span class=\"text-neutral-900 dark:text-neutral-900\">{{ fileDetails.filename }}</span>\r\n        </div>\r\n        <div class=\"flex justify-between\">\r\n          <span class=\"text-neutral-600 dark:text-neutral-600\">Размер:</span>\r\n          <span class=\"text-neutral-900 dark:text-neutral-900\">{{ asset ? formatFileSize(asset.size) : 'N/A' }}</span>\r\n        </div>\r\n        <div class=\"flex justify-between\">\r\n          <span class=\"text-neutral-600 dark:text-neutral-600\">Тип:</span>\r\n          <span class=\"text-neutral-900 dark:text-neutral-900\">{{ asset?.mime_type || 'N/A' }}</span>\r\n        </div>\r\n        <div class=\"flex justify-between\">\r\n          <span class=\"text-neutral-600 dark:text-neutral-600\">Добавлено:</span>\r\n          <span class=\"text-neutral-900 dark:text-neutral-900\">{{ asset ? formatDate(asset.date_added) : 'N/A' }}</span>\r\n        </div>\r\n        <div v-if=\"fileDetails?.checksum\" class=\"flex justify-between\">\r\n          <span class=\"text-neutral-600 dark:text-neutral-600\">Checksum:</span>\r\n          <span class=\"text-neutral-900 dark:text-neutral-900 font-mono text-xs\">\r\n            {{ truncate(fileDetails.checksum, 16) }}\r\n          </span>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n    <!-- Image Info (EXIF) Section -->\r\n    <section v-if=\"isImage && imageMetadata\" class=\"mb-6\">\r\n      <h3 class=\"text-sm font-semibold text-neutral-900 dark:text-neutral-900 mb-3\">\r\n        Информация об изображении\r\n      </h3>\r\n      <div class=\"space-y-2 text-sm\">\r\n        <div v-if=\"imageMetadata.dimensions\" class=\"flex justify-between\">\r\n          <span class=\"text-neutral-600 dark:text-neutral-600\">Размеры:</span>\r\n          <span class=\"text-neutral-900 dark:text-neutral-900\">\r\n            {{ imageMetadata.dimensions.width }} × {{ imageMetadata.dimensions.height }} px\r\n          </span>\r\n        </div>\r\n        <div v-if=\"imageMetadata.dpi\" class=\"flex justify-between\">\r\n          <span class=\"text-neutral-600 dark:text-neutral-600\">DPI:</span>\r\n          <span class=\"text-neutral-900 dark:text-neutral-900\">{{ imageMetadata.dpi }}</span>\r\n        </div>\r\n        <div v-if=\"imageMetadata.color_space\" class=\"flex justify-between\">\r\n          <span class=\"text-neutral-600 dark:text-neutral-600\">Цветовое пространство:</span>\r\n          <span class=\"text-neutral-900 dark:text-neutral-900\">{{ imageMetadata.color_space }}</span>\r\n        </div>\r\n        <div v-if=\"imageMetadata.camera\" class=\"flex justify-between\">\r\n          <span class=\"text-neutral-600 dark:text-neutral-600\">Камера:</span>\r\n          <span class=\"text-neutral-900 dark:text-neutral-900\">{{ imageMetadata.camera }}</span>\r\n        </div>\r\n        <div v-if=\"imageMetadata.exposure\" class=\"flex justify-between\">\r\n          <span class=\"text-neutral-600 dark:text-neutral-600\">Экспозиция:</span>\r\n          <span class=\"text-neutral-900 dark:text-neutral-900\">{{ imageMetadata.exposure }}</span>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n    <!-- AI Analysis Section -->\r\n    <section v-if=\"aiAnalysis\" class=\"mb-6\">\r\n      <h3 class=\"text-sm font-semibold text-neutral-900 dark:text-neutral-900 mb-3\">\r\n        AI Анализ\r\n      </h3>\r\n      <div v-if=\"aiAnalysis.status === 'completed'\" class=\"space-y-3\">\r\n        <!-- Tags -->\r\n        <div v-if=\"aiAnalysis.tags && aiAnalysis.tags.length > 0\">\r\n          <div class=\"text-xs font-medium text-neutral-600 dark:text-neutral-600 mb-2\">\r\n            Теги:\r\n          </div>\r\n          <div class=\"flex flex-wrap gap-2\">\r\n            <Badge\r\n              v-for=\"tag in aiAnalysis.tags\"\r\n              :key=\"tag\"\r\n              variant=\"info\"\r\n              size=\"sm\"\r\n            >\r\n              {{ tag }}\r\n            </Badge>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Description -->\r\n        <div v-if=\"aiAnalysis.ai_description\">\r\n          <div class=\"text-xs font-medium text-neutral-600 dark:text-neutral-600 mb-2\">\r\n            Описание:\r\n          </div>\r\n          <p class=\"text-sm text-neutral-900 dark:text-neutral-900\">\r\n            {{ aiAnalysis.ai_description }}\r\n          </p>\r\n        </div>\r\n\r\n        <!-- Dominant Colors -->\r\n        <div v-if=\"aiAnalysis.colors && aiAnalysis.colors.length > 0\">\r\n          <div class=\"text-xs font-medium text-neutral-600 dark:text-neutral-600 mb-2\">\r\n            Доминирующие цвета:\r\n          </div>\r\n          <div class=\"flex gap-2\">\r\n            <div\r\n              v-for=\"(color, index) in aiAnalysis.colors\"\r\n              :key=\"index\"\r\n              class=\"w-8 h-8 rounded border border-neutral-300 dark:border-neutral-300\"\r\n              :style=\"{ backgroundColor: color }\"\r\n              :title=\"color\"\r\n            ></div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Objects Detected -->\r\n        <div v-if=\"aiAnalysis.objects_detected && aiAnalysis.objects_detected.length > 0\">\r\n          <div class=\"text-xs font-medium text-neutral-600 dark:text-neutral-600 mb-2\">\r\n            Обнаруженные объекты:\r\n          </div>\r\n          <div class=\"space-y-1\">\r\n            <div\r\n              v-for=\"(obj, index) in aiAnalysis.objects_detected\"\r\n              :key=\"index\"\r\n              class=\"flex items-center justify-between text-sm\"\r\n            >\r\n              <span class=\"text-neutral-900 dark:text-neutral-900\">{{ obj.name }}</span>\r\n              <span class=\"text-neutral-600 dark:text-neutral-600\">\r\n                {{ Math.round(obj.confidence * 100) }}%\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div v-else-if=\"aiAnalysis.status === 'processing'\" class=\"text-sm text-neutral-600 dark:text-neutral-600\">\r\n        <div class=\"flex items-center gap-2\">\r\n          <div class=\"animate-spin h-4 w-4 border-2 border-primary-500 border-t-transparent rounded-full\"></div>\r\n          <span>Анализ выполняется...</span>\r\n        </div>\r\n      </div>\r\n      <div v-else class=\"text-sm text-neutral-600 dark:text-neutral-600\">\r\n        AI анализ недоступен\r\n      </div>\r\n    </section>\r\n\r\n    <!-- Version History Section -->\r\n    <section class=\"mb-6\">\r\n      <VersionHistory\r\n        v-if=\"asset?.id\"\r\n        :asset-id=\"asset.id\"\r\n        :initial-versions=\"versionHistory\"\r\n        @version-download=\"handleVersionDownload\"\r\n        @version-restore=\"handleVersionRestore\"\r\n      />\r\n    </section>\r\n\r\n    <!-- Comments Section -->\r\n    <section class=\"mb-6\">\r\n      <CommentsThread\r\n        v-if=\"asset?.id\"\r\n        :asset-id=\"asset.id\"\r\n        :initial-comments=\"comments\"\r\n        @comment-added=\"handleCommentAdded\"\r\n        @comment-updated=\"handleCommentUpdated\"\r\n        @comment-deleted=\"handleCommentDeleted\"\r\n      />\r\n    </section>\r\n\r\n    <!-- Actions Section -->\r\n    <section class=\"border-t border-neutral-300 dark:border-neutral-300 pt-4\">\r\n      <div class=\"flex flex-col gap-2\">\r\n        <Button\r\n          variant=\"primary\"\r\n          size=\"md\"\r\n          class=\"w-full\"\r\n          @click=\"$emit('download')\"\r\n        >\r\n          <svg class=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path\r\n              stroke-linecap=\"round\"\r\n              stroke-linejoin=\"round\"\r\n              stroke-width=\"2\"\r\n              d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4\"\r\n            />\r\n          </svg>\r\n          Скачать\r\n        </Button>\r\n        <Button\r\n          variant=\"outline\"\r\n          size=\"md\"\r\n          class=\"w-full\"\r\n          @click=\"$emit('share')\"\r\n        >\r\n          <svg class=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path\r\n              stroke-linecap=\"round\"\r\n              stroke-linejoin=\"round\"\r\n              stroke-width=\"2\"\r\n              d=\"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.552 3.546a2 2 0 002.938-2.187l.546-2.59A4.998 4.998 0 0017 12c0-.482-.114-.938-.316-1.342m0 2.684L12.448 8.454a2 2 0 00-2.938-2.187l-.546 2.59A4.998 4.998 0 007 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684\"\r\n            />\r\n          </svg>\r\n          Поделиться\r\n        </Button>\r\n      </div>\r\n    </section>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { computed } from 'vue'\r\nimport type { Asset, AssetDetailResponse, FileDetails, AIAnalysis, Comment, Version } from '@/types/api'\r\nimport { formatFileSize, formatDate, truncate } from '@/utils/formatters'\r\nimport Button from '@/components/Common/Button.vue'\r\nimport Badge from '@/components/Common/Badge.vue'\r\nimport CommentsThread from './CommentsThread.vue'\r\nimport VersionHistory from './VersionHistory.vue'\r\n\r\ninterface Props {\r\n  asset: Asset | AssetDetailResponse | null\r\n}\r\n\r\nconst props = defineProps<Props>()\r\n\r\nconst emit = defineEmits<{\r\n  download: []\r\n  share: []\r\n  'version-select': [versionId: number]\r\n  'comment-added': [comment: Comment]\r\n  'comment-updated': [comment: Comment]\r\n  'comment-deleted': [commentId: number]\r\n  'version-download': [version: Version]\r\n  'version-restore': [version: Version]\r\n}>()\r\n\r\nfunction handleCommentAdded(comment: Comment) {\r\n  emit('comment-added', comment)\r\n}\r\n\r\nfunction handleCommentUpdated(comment: Comment) {\r\n  emit('comment-updated', comment)\r\n}\r\n\r\nfunction handleCommentDeleted(commentId: number) {\r\n  emit('comment-deleted', commentId)\r\n}\r\n\r\nfunction handleVersionDownload(version: Version) {\r\n  emit('version-download', version)\r\n}\r\n\r\nfunction handleVersionRestore(version: Version) {\r\n  emit('version-restore', version)\r\n  emit('version-select', version.id)\r\n}\r\n\r\n// Extract data from asset\r\nconst fileDetails = computed<FileDetails | null>(() => {\r\n  if (!props.asset) return null\r\n  if ('file_details' in props.asset) {\r\n    return props.asset.file_details\r\n  }\r\n  return null\r\n})\r\n\r\nconst aiAnalysis = computed<AIAnalysis | null>(() => {\r\n  if (!props.asset) return null\r\n  if ('ai_analysis' in props.asset && props.asset.ai_analysis) {\r\n    return props.asset.ai_analysis\r\n  }\r\n  return null\r\n})\r\n\r\nconst comments = computed<Comment[]>(() => {\r\n  if (!props.asset) return []\r\n  if ('comments' in props.asset && props.asset.comments) {\r\n    return props.asset.comments\r\n  }\r\n  return []\r\n})\r\n\r\nconst versionHistory = computed<Version[]>(() => {\r\n  if (!props.asset) return []\r\n  if ('version_history' in props.asset && props.asset.version_history) {\r\n    return props.asset.version_history\r\n  }\r\n  return []\r\n})\r\n\r\nconst isImage = computed(() => {\r\n  return props.asset?.mime_type?.startsWith('image/') || false\r\n})\r\n\r\nconst imageMetadata = computed(() => {\r\n  if (!isImage.value || !props.asset) return null\r\n\r\n  // Extract image metadata from asset metadata or file_details\r\n  const metadata = props.asset.metadata || {}\r\n  const details = fileDetails.value\r\n\r\n  // Try to extract dimensions from various sources\r\n  let dimensions = null\r\n  if (metadata.dimensions) {\r\n    dimensions = metadata.dimensions\r\n  } else if (metadata.width && metadata.height) {\r\n    dimensions = { width: metadata.width, height: metadata.height }\r\n  } else if (details && 'width' in details && 'height' in details) {\r\n    dimensions = { width: details.width, height: details.height }\r\n  }\r\n\r\n  return {\r\n    dimensions,\r\n    dpi: metadata.dpi || metadata.resolution || null,\r\n    color_space: metadata.color_space || metadata.colorProfile || null,\r\n    camera: metadata.camera || metadata.make || null,\r\n    exposure: metadata.exposure || metadata.exposureTime || null\r\n  }\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.metadata-panel {\r\n  height: 100%;\r\n  overflow-y: auto;\r\n  padding: 1.5rem;\r\n}\r\n</style>\r\n\r\n","<template>\r\n  <div class=\"asset-detail-page\">\r\n    <!-- Loading State -->\r\n    <div v-if=\"assetStore.isLoading && !assetStore.currentAsset\" class=\"p-8 text-center\">\r\n      <div class=\"animate-spin h-8 w-8 mx-auto text-primary-500\"></div>\r\n      <p class=\"mt-4 text-neutral-600 dark:text-neutral-600\">Загрузка...</p>\r\n    </div>\r\n\r\n    <!-- Error State -->\r\n    <div v-else-if=\"assetStore.error && !assetStore.currentAsset\" class=\"p-8 text-center\">\r\n      <div class=\"max-w-md mx-auto\">\r\n        <svg\r\n          class=\"mx-auto h-12 w-12 text-error\"\r\n          fill=\"none\"\r\n          stroke=\"currentColor\"\r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path\r\n            stroke-linecap=\"round\"\r\n            stroke-linejoin=\"round\"\r\n            stroke-width=\"2\"\r\n            d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n          />\r\n        </svg>\r\n        <h3 class=\"mt-4 text-lg font-medium text-neutral-900 dark:text-neutral-900\">\r\n          Ошибка загрузки\r\n        </h3>\r\n        <p class=\"mt-2 text-sm text-neutral-600 dark:text-neutral-600\">\r\n          {{ assetStore.error }}\r\n        </p>\r\n        <button\r\n          class=\"mt-4 px-4 py-2 bg-primary-500 text-white rounded-md hover:bg-primary-600 transition-colors\"\r\n          @click=\"handleRetry\"\r\n        >\r\n          Попробовать снова\r\n        </button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Asset Detail Content -->\r\n    <div v-else-if=\"assetStore.currentAsset\" class=\"asset-detail-content\">\r\n      <div class=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n        <!-- Preview Pane (Left 60% on desktop) -->\r\n        <div class=\"lg:col-span-2\">\r\n          <div class=\"bg-neutral-50 dark:bg-neutral-50 rounded-lg p-4\">\r\n            <!-- Image/Video Preview -->\r\n            <div class=\"relative w-full bg-neutral-100 dark:bg-neutral-100 rounded-lg overflow-hidden\" style=\"aspect-ratio: 16/9; min-height: 400px;\">\r\n              <img\r\n                v-if=\"isImage\"\r\n                :src=\"previewUrl\"\r\n                :alt=\"assetStore.currentAsset.label\"\r\n                class=\"w-full h-full object-contain\"\r\n                @error=\"handleImageError\"\r\n              />\r\n              <video\r\n                v-else-if=\"isVideo\"\r\n                :src=\"previewUrl\"\r\n                controls\r\n                class=\"w-full h-full object-contain\"\r\n              >\r\n                Ваш браузер не поддерживает видео.\r\n              </video>\r\n              <div\r\n                v-else\r\n                class=\"w-full h-full flex items-center justify-center\"\r\n              >\r\n                <div class=\"text-center\">\r\n                  <svg\r\n                    class=\"mx-auto h-16 w-16 text-neutral-400\"\r\n                    fill=\"none\"\r\n                    stroke=\"currentColor\"\r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path\r\n                      stroke-linecap=\"round\"\r\n                      stroke-linejoin=\"round\"\r\n                      stroke-width=\"2\"\r\n                      d=\"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z\"\r\n                    />\r\n                  </svg>\r\n                  <p class=\"mt-4 text-neutral-600 dark:text-neutral-600\">\r\n                    Предпросмотр недоступен для этого типа файла\r\n                  </p>\r\n                  <button\r\n                    class=\"mt-4 px-4 py-2 bg-primary-500 text-white rounded-md hover:bg-primary-600 transition-colors\"\r\n                    @click=\"handleDownload\"\r\n                  >\r\n                    Скачать файл\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              <!-- Zoom Controls (for images) -->\r\n              <div\r\n                v-if=\"isImage\"\r\n                class=\"absolute bottom-4 right-4 flex gap-2\"\r\n              >\r\n                <button\r\n                  class=\"p-2 bg-white dark:bg-neutral-800 rounded-md shadow-md hover:bg-neutral-100 dark:hover:bg-neutral-700 transition-colors\"\r\n                  @click=\"zoomOut\"\r\n                  aria-label=\"Уменьшить\"\r\n                >\r\n                  <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path\r\n                      stroke-linecap=\"round\"\r\n                      stroke-linejoin=\"round\"\r\n                      stroke-width=\"2\"\r\n                      d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7\"\r\n                    />\r\n                  </svg>\r\n                </button>\r\n                <button\r\n                  class=\"p-2 bg-white dark:bg-neutral-800 rounded-md shadow-md hover:bg-neutral-100 dark:hover:bg-neutral-700 transition-colors\"\r\n                  @click=\"zoomIn\"\r\n                  aria-label=\"Увеличить\"\r\n                >\r\n                  <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path\r\n                      stroke-linecap=\"round\"\r\n                      stroke-linejoin=\"round\"\r\n                      stroke-width=\"2\"\r\n                      d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6m3-3H7\"\r\n                    />\r\n                  </svg>\r\n                </button>\r\n                <button\r\n                  class=\"p-2 bg-white dark:bg-neutral-800 rounded-md shadow-md hover:bg-neutral-100 dark:hover:bg-neutral-700 transition-colors\"\r\n                  @click=\"resetZoom\"\r\n                  aria-label=\"Сбросить масштаб\"\r\n                >\r\n                  <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path\r\n                      stroke-linecap=\"round\"\r\n                      stroke-linejoin=\"round\"\r\n                      stroke-width=\"2\"\r\n                      d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"\r\n                    />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n\r\n              <!-- Navigation Arrows (if related assets available) -->\r\n              <div\r\n                v-if=\"relatedAssets.length > 0\"\r\n                class=\"absolute top-1/2 left-4 transform -translate-y-1/2\"\r\n              >\r\n                <button\r\n                  v-if=\"previousAsset\"\r\n                  class=\"p-2 bg-white dark:bg-neutral-800 rounded-full shadow-md hover:bg-neutral-100 dark:hover:bg-neutral-700 transition-colors\"\r\n                  @click=\"navigateToAsset(previousAsset.id)\"\r\n                  aria-label=\"Предыдущий актив\"\r\n                >\r\n                  <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path\r\n                      stroke-linecap=\"round\"\r\n                      stroke-linejoin=\"round\"\r\n                      stroke-width=\"2\"\r\n                      d=\"M15 19l-7-7 7-7\"\r\n                    />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n              <div\r\n                v-if=\"relatedAssets.length > 0\"\r\n                class=\"absolute top-1/2 right-4 transform -translate-y-1/2\"\r\n              >\r\n                <button\r\n                  v-if=\"nextAsset\"\r\n                  class=\"p-2 bg-white dark:bg-neutral-800 rounded-full shadow-md hover:bg-neutral-100 dark:hover:bg-neutral-700 transition-colors\"\r\n                  @click=\"navigateToAsset(nextAsset.id)\"\r\n                  aria-label=\"Следующий актив\"\r\n                >\r\n                  <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path\r\n                      stroke-linecap=\"round\"\r\n                      stroke-linejoin=\"round\"\r\n                      stroke-width=\"2\"\r\n                      d=\"M9 5l7 7-7 7\"\r\n                    />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Asset Title -->\r\n            <div class=\"mt-4\">\r\n              <h1 class=\"text-2xl font-bold text-neutral-900 dark:text-neutral-900\">\r\n                {{ assetStore.currentAsset.label }}\r\n              </h1>\r\n              <p v-if=\"assetStore.currentAsset.tags && assetStore.currentAsset.tags.length > 0\" class=\"mt-2 flex flex-wrap gap-2\">\r\n                <Badge\r\n                  v-for=\"tag in assetStore.currentAsset.tags\"\r\n                  :key=\"tag\"\r\n                  variant=\"info\"\r\n                  size=\"sm\"\r\n                >\r\n                  {{ tag }}\r\n                </Badge>\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Metadata Panel (Right 40% on desktop) -->\r\n        <div class=\"lg:col-span-1\">\r\n          <div class=\"bg-neutral-0 dark:bg-neutral-0 border border-neutral-300 dark:border-neutral-300 rounded-lg sticky top-4 max-h-[calc(100vh-8rem)] overflow-y-auto\">\r\n            <MetadataPanel\r\n              :asset=\"assetStore.currentAsset\"\r\n              @download=\"handleDownload\"\r\n              @share=\"handleShare\"\r\n              @version-select=\"handleVersionSelect\"\r\n              @comment-added=\"handleCommentAdded\"\r\n              @comment-updated=\"handleCommentUpdated\"\r\n              @comment-deleted=\"handleCommentDeleted\"\r\n              @version-download=\"handleVersionDownload\"\r\n              @version-restore=\"handleVersionRestore\"\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, computed, onMounted, onUnmounted } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport { useAssetStore } from '@/stores/assetStore'\r\nimport MetadataPanel from '@/components/DAM/MetadataPanel.vue'\r\nimport Badge from '@/components/Common/Badge.vue'\r\nimport type { Asset, Comment, Version } from '@/types/api'\r\n\r\nconst route = useRoute()\r\nconst router = useRouter()\r\nconst assetStore = useAssetStore()\r\n\r\nconst zoomLevel = ref(1)\r\nconst imageError = ref(false)\r\n\r\n// Get preview URL\r\nconst previewUrl = computed(() => {\r\n  const asset = assetStore.currentAsset\r\n  if (!asset) return ''\r\n  return asset.preview_url || asset.thumbnail_url || ''\r\n})\r\n\r\n// Check file type\r\nconst isImage = computed(() => {\r\n  const asset = assetStore.currentAsset\r\n  if (!asset) return false\r\n  return asset.mime_type?.startsWith('image/') || false\r\n})\r\n\r\nconst isVideo = computed(() => {\r\n  const asset = assetStore.currentAsset\r\n  if (!asset) return false\r\n  return asset.mime_type?.startsWith('video/') || false\r\n})\r\n\r\n// Related assets (placeholder - would come from API)\r\nconst relatedAssets = computed<Asset[]>(() => {\r\n  // In real implementation, this would fetch related assets from API\r\n  return []\r\n})\r\n\r\nconst currentAssetIndex = computed(() => {\r\n  if (!assetStore.currentAsset) return -1\r\n  return relatedAssets.value.findIndex((a) => a.id === assetStore.currentAsset?.id)\r\n})\r\n\r\nconst previousAsset = computed(() => {\r\n  const index = currentAssetIndex.value\r\n  if (index > 0) {\r\n    return relatedAssets.value[index - 1]\r\n  }\r\n  return null\r\n})\r\n\r\nconst nextAsset = computed(() => {\r\n  const index = currentAssetIndex.value\r\n  if (index >= 0 && index < relatedAssets.value.length - 1) {\r\n    return relatedAssets.value[index + 1]\r\n  }\r\n  return null\r\n})\r\n\r\nonMounted(async () => {\r\n  const assetId = parseInt(route.params.id as string, 10)\r\n  if (assetId && (!assetStore.currentAsset || assetStore.currentAsset.id !== assetId)) {\r\n    await assetStore.getAssetDetail(assetId)\r\n  }\r\n\r\n  // Keyboard navigation\r\n  document.addEventListener('keydown', handleKeyDown)\r\n})\r\n\r\nonUnmounted(() => {\r\n  document.removeEventListener('keydown', handleKeyDown)\r\n})\r\n\r\nfunction handleRetry() {\r\n  const assetId = parseInt(route.params.id as string, 10)\r\n  if (assetId) {\r\n    assetStore.getAssetDetail(assetId)\r\n  }\r\n}\r\n\r\nfunction handleDownload() {\r\n  const asset = assetStore.currentAsset\r\n  if (!asset) return\r\n\r\n  // In real implementation, this would trigger download via API\r\n  const downloadUrl = asset.preview_url || asset.thumbnail_url\r\n  if (downloadUrl) {\r\n    window.open(downloadUrl, '_blank')\r\n  }\r\n}\r\n\r\nfunction handleShare() {\r\n  // TODO: Open share modal\r\n  console.log('Share asset:', assetStore.currentAsset?.id)\r\n}\r\n\r\nfunction handleVersionSelect(versionId: number) {\r\n  // TODO: Load specific version\r\n  console.log('Select version:', versionId)\r\n}\r\n\r\nfunction handleCommentAdded(comment: Comment) {\r\n  // Refresh asset detail to get updated comments\r\n  const assetId = parseInt(route.params.id as string, 10)\r\n  if (assetId) {\r\n    assetStore.getAssetDetail(assetId)\r\n  }\r\n}\r\n\r\nfunction handleCommentUpdated(comment: Comment) {\r\n  // Refresh asset detail to get updated comments\r\n  const assetId = parseInt(route.params.id as string, 10)\r\n  if (assetId) {\r\n    assetStore.getAssetDetail(assetId)\r\n  }\r\n}\r\n\r\nfunction handleCommentDeleted(commentId: number) {\r\n  // Refresh asset detail to get updated comments\r\n  const assetId = parseInt(route.params.id as string, 10)\r\n  if (assetId) {\r\n    assetStore.getAssetDetail(assetId)\r\n  }\r\n}\r\n\r\nfunction handleVersionDownload(version: Version) {\r\n  // Version download is handled in VersionHistory component\r\n  console.log('Download version:', version.id)\r\n}\r\n\r\nfunction handleVersionRestore(version: Version) {\r\n  // Refresh asset detail after restore\r\n  const assetId = parseInt(route.params.id as string, 10)\r\n  if (assetId) {\r\n    assetStore.getAssetDetail(assetId)\r\n  }\r\n}\r\n\r\nfunction handleImageError() {\r\n  imageError.value = true\r\n}\r\n\r\nfunction zoomIn() {\r\n  zoomLevel.value = Math.min(zoomLevel.value + 0.25, 3)\r\n}\r\n\r\nfunction zoomOut() {\r\n  zoomLevel.value = Math.max(zoomLevel.value - 0.25, 0.5)\r\n}\r\n\r\nfunction resetZoom() {\r\n  zoomLevel.value = 1\r\n}\r\n\r\nfunction navigateToAsset(assetId: number) {\r\n  router.push(`/dam/assets/${assetId}`)\r\n}\r\n\r\nfunction handleKeyDown(event: KeyboardEvent) {\r\n  // Arrow keys for navigation\r\n  if (event.key === 'ArrowLeft' && previousAsset.value) {\r\n    navigateToAsset(previousAsset.value.id)\r\n  } else if (event.key === 'ArrowRight' && nextAsset.value) {\r\n    navigateToAsset(nextAsset.value.id)\r\n  }\r\n}\r\n</script>\r\n\r\n\r\n<style scoped>\r\n.asset-detail-page {\r\n  width: 100%;\r\n  min-height: calc(100vh - 4rem);\r\n  padding: 1.5rem;\r\n}\r\n\r\n.asset-detail-content {\r\n  max-width: 1400px;\r\n  margin: 0 auto;\r\n}\r\n\r\n@media (max-width: 1024px) {\r\n  .asset-detail-content {\r\n    padding: 1rem;\r\n  }\r\n}\r\n</style>\r\n"],"names":["commentService","getComments","assetId","__async","this","apiService","get","results","createComment","comment","post","updateComment","commentId","put","deleteComment","delete","createReply","parentId","parent_id","websocketService","constructor","__publicField","Map","connect","_a","ws","readyState","WebSocket","OPEN","isConnecting","wsUrl","onopen","reconnectAttempts","emit","onmessage","event","message","JSON","parse","data","handleMessage","error","onerror","onclose","maxReconnectAttempts","setTimeout","reconnectDelay","disconnect","close","on","eventType","handler","eventHandlers","has","set","Set","add","off","handlers","subscribeToAsset","send","stringify","type","channel","unsubscribeFromAsset","forEach","isConnected","simulateEvent","props","__props","__emit","isEditing","ref","editText","canEdit","computed","currentUserId","author_id","formattedText","text","parts","mentionRegex","match","lastIndex","exec","index","push","substring","length","startEdit","value","cancelEdit","saveEdit","trim","handleReply","handleDelete","confirm","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","author_avatar","_hoisted_4","src","alt","author","class","_hoisted_6","_toDisplayString","charAt","toUpperCase","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_unref","created_date","edited","_hoisted_13","_hoisted_14","onClick","_hoisted_18","$event","rows","onKeydown","_hoisted_20","_createVNode","Button","variant","size","_cache","_hoisted_15","_Fragment","_renderList","part","key","_hoisted_16","_hoisted_17","_hoisted_21","replies","_hoisted_22","reply","_createBlock","_component_CommentItem","id","onReply","$emit","onEdit","onDelete","authStore","useAuthStore","comments","initialComments","newCommentText","replyingTo","isSubmitting","isLoading","mentionSuggestions","currentMentionQuery","availableUsers","user","topLevelComments","filter","c","totalCommentsCount","countReplies","reduce","sum","handleMentionInput","textarea","target","cursorPos","selectionStart","mentionMatch","query","toLowerCase","startsWith","handleSubmitComment","mentions","extractMentions","commentData","newComment","parent","findCommentById","commentsList","found","document","querySelector","focus","cancelReply","handleEdit","newText","updated","updated_date","findIndex","splice","onMounted","loadComments","unsubscribeAdded","asset_id","unsubscribeUpdated","unsubscribeDeleted","comment_id","window","__commentUnsubscribers","onUnmounted","unsubscribers","unsub","watch","newComments","_hoisted_5","placeholder","onInput","username","start","newPos","setSelectionRange","selectMention","disabled","loading","CommentItem","fill","stroke","viewBox","d","versions","initialVersions","loadVersions","asset","assetService","getAsset","version_history","newVersions","version","_normalizeClass","is_current","filename","Badge","formatDate","uploaded_date","uploaded_by","download_url","open","downloadUrl","handleDownload","canRestore","restore_url","fetch","method","updateAsset","version_id","handleRestore","handleCommentAdded","handleCommentUpdated","handleCommentDeleted","handleVersionDownload","handleVersionRestore","fileDetails","file_details","aiAnalysis","ai_analysis","versionHistory","isImage","_b","mime_type","imageMetadata","metadata","details","dimensions","width","height","dpi","resolution","color_space","colorProfile","camera","make","exposure","exposureTime","label","formatFileSize","date_added","_c","checksum","_hoisted_19","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","status","_hoisted_29","tags","_hoisted_30","_hoisted_31","tag","ai_description","_hoisted_32","_hoisted_33","colors","_hoisted_34","_hoisted_35","color","style","title","objects_detected","_hoisted_37","_hoisted_38","obj","_hoisted_39","name","_hoisted_40","Math","round","confidence","_hoisted_41","_hoisted_42","_hoisted_43","_d","VersionHistory","onVersionDownload","onVersionRestore","_hoisted_44","_e","CommentsThread","onCommentAdded","onCommentUpdated","onCommentDeleted","_hoisted_45","_hoisted_46","route","useRoute","router","useRouter","assetStore","useAssetStore","zoomLevel","imageError","previewUrl","currentAsset","preview_url","thumbnail_url","isVideo","relatedAssets","currentAssetIndex","a","previousAsset","nextAsset","handleRetry","parseInt","params","getAssetDetail","handleShare","handleVersionSelect","versionId","handleImageError","zoomIn","min","zoomOut","max","resetZoom","navigateToAsset","handleKeyDown","addEventListener","removeEventListener","onError","controls","MetadataPanel","onDownload","onShare","onVersionSelect"],"mappings":"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"}
var e=Object.defineProperty,l=Object.defineProperties,o=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,i=(l,o,a)=>o in l?e(l,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[o]=a,s=(e,l)=>{for(var o in l||(l={}))n.call(l,o)&&i(e,o,l[o]);if(a)for(var o of a(l))t.call(l,o)&&i(e,o,l[o]);return e},r=(e,a)=>l(e,o(a)),d=(e,l,o)=>new Promise((a,n)=>{var t=e=>{try{s(o.next(e))}catch(l){n(l)}},i=e=>{try{s(o.throw(e))}catch(l){n(l)}},s=e=>e.done?a(e.value):Promise.resolve(e.value).then(t,i);s((o=o.apply(e,l)).next())});import{b as u,r as c,c as v,k as p,a as m,e as f,q as w,G as k,f as h,i as y,F as b,h as g,j as _,n as x,t as C,P as N,w as z,l as j,s as M,m as V,v as S,A as W,x as D,C as $}from"./vue-vendor-B11yH1L4.js";import{d as O,e as A,u as P,l as q}from"./index-CEUju959.js";import{u as E}from"./adminStore-BAcaV1Pb.js";import{_ as R}from"./Input.vue_vue_type_script_setup_true_lang--8g8gQXi.js";import{_ as U}from"./Select.vue_vue_type_script_setup_true_lang-8BshTy_O.js";import{D as T}from"./DeleteConfirmModal-FrXl2jew.js";import"./utils-vendor-BYNnTNyD.js";import"./Modal.vue_vue_type_script_setup_true_lang-Cpe0tIsY.js";const I=["width","height"],B=["d"],Y=["onMousedown","onClick","aria-label"],H={class:"workflow-node__header"},L={class:"workflow-node__type-icon"},X={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},F={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},J={key:2,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},G={class:"workflow-node__name"},Z={key:0,class:"workflow-node__description"},K=["width","height"],Q=["onClick"],ee=["d"],le=["x","y"],oe=O(u({__name:"WorkflowCanvas",props:{nodes:{},transitions:{},zoom:{default:1},pan:{default:()=>({x:0,y:0})},selectedNodeId:{default:null},selectedTransitionId:{default:null},showGrid:{type:Boolean,default:!0}},emits:["node-click","transition-click","node-drag","pan-change","zoom-change"],setup(e,{emit:l}){const o=e,a=l,n=c(null),t=c(2e3),i=c(2e3),s=c(!1),r=c({x:0,y:0}),d=c(!1),u=c(null),N=c({x:0,y:0}),z=v(()=>({transform:`translate(${o.pan.x}px, ${o.pan.y}px) scale(${o.zoom})`,transformOrigin:"0 0"})),j=e=>({left:`${e.position.x}px`,top:`${e.position.y}px`}),M=e=>{const l=o.nodes.find(l=>l.id===e.from_node),a=o.nodes.find(l=>l.id===e.to_node);if(!l||!a)return"";const n=l.position.x+100,t=l.position.y+50,i=a.position.x+100,s=a.position.y+50,r=i-n;return`M ${n} ${t} C ${n+.5*r} ${t}, ${i-.5*r} ${s}, ${i} ${s}`},V=e=>{const l=o.nodes.find(l=>l.id===e.from_node),a=o.nodes.find(l=>l.id===e.to_node);return l&&a?(l.position.x+a.position.x)/2+100:0},S=e=>{const l=o.nodes.find(l=>l.id===e.from_node),a=o.nodes.find(l=>l.id===e.to_node);return l&&a?(l.position.y+a.position.y)/2+50:0},W=e=>{const l=e.deltaY>0?-.1:.1,n=Math.max(.5,Math.min(2,o.zoom+l));a("zoom-change",n)},D=e=>{(1===e.button||0===e.button&&e.ctrlKey)&&(s.value=!0,r.value={x:e.clientX-o.pan.x,y:e.clientY-o.pan.y},e.preventDefault())},$=e=>{var l;if(s.value)a("pan-change",{x:e.clientX-r.value.x,y:e.clientY-r.value.y});else if(d.value&&u.value){const t=null==(l=n.value)?void 0:l.getBoundingClientRect();if(t){const l=(e.clientX-t.left-o.pan.x)/o.zoom,n=(e.clientY-t.top-o.pan.y)/o.zoom;a("node-drag",u.value,{x:l,y:n})}}},O=()=>{s.value=!1,d.value=!1,u.value=null},A=()=>{s.value=!1,d.value=!1,u.value=null},P=()=>{d.value=!1,u.value=null};return p(()=>{n.value&&(t.value=n.value.offsetWidth||2e3,i.value=n.value.offsetHeight||2e3)}),m(()=>{s.value=!1,d.value=!1}),(l,s)=>(_(),f("div",{ref_key:"canvasRef",ref:n,class:"workflow-canvas",style:k(z.value),onWheel:w(W,["prevent"]),onMousedown:D,onMousemove:$,onMouseup:O,onMouseleave:A},[e.showGrid?(_(),f("svg",{key:0,class:"workflow-canvas__grid",width:t.value,height:i.value},[y("defs",null,[y("pattern",{id:"grid",width:20,height:20,patternUnits:"userSpaceOnUse"},[y("path",{d:"M 20 0 L 0 0 0 20",fill:"none",stroke:"var(--color-border, #e5e7eb)","stroke-width":"1"},null,8,B)])]),s[1]||(s[1]=y("rect",{width:"100%",height:"100%",fill:"url(#grid)"},null,-1))],8,I)):h("",!0),(_(!0),f(b,null,g(e.nodes,l=>(_(),f("div",{key:l.id,class:x(["workflow-node",`workflow-node--${l.type}`,{"workflow-node--selected":e.selectedNodeId===l.id}]),style:k(j(l)),onMousedown:w(e=>((e,l)=>{var a;if(0===e.button&&!e.ctrlKey){d.value=!0,u.value=l.id;const t=null==(a=n.value)?void 0:a.getBoundingClientRect();t&&(N.value={x:e.clientX-t.left-l.position.x*o.zoom,y:e.clientY-t.top-l.position.y*o.zoom})}})(e,l),["stop"]),onClick:w(e=>(e=>{a("node-click",e)})(l),["stop"]),draggable:!0,onDragstart:s[0]||(s[0]=e=>{e.preventDefault()}),onDragend:P,role:"button",tabindex:"0","aria-label":`Workflow node: ${l.name}`},[y("div",H,[y("span",L,["start"===l.type?(_(),f("svg",X,[...s[2]||(s[2]=[y("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"},null,-1),y("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):"end"===l.type?(_(),f("svg",F,[...s[3]||(s[3]=[y("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1),y("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"},null,-1)])])):(_(),f("svg",J,[...s[4]||(s[4]=[y("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,-1)])]))]),y("span",G,C(l.name),1)]),l.description?(_(),f("p",Z,C(l.description),1)):h("",!0)],46,Y))),128)),(_(),f("svg",{class:"workflow-canvas__transitions",width:t.value,height:i.value},[s[5]||(s[5]=y("defs",null,[y("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"10",refX:"9",refY:"3",orient:"auto"},[y("polygon",{points:"0 0, 10 3, 0 6",fill:"var(--color-text, #111827)"})])],-1)),(_(!0),f(b,null,g(e.transitions,l=>(_(),f("g",{key:l.id,onClick:w(e=>(e=>{a("transition-click",e)})(l),["stop"]),class:x(["workflow-transition",{"workflow-transition--selected":e.selectedTransitionId===l.id}])},[y("path",{d:M(l),fill:"none",stroke:"var(--color-text, #111827)","stroke-width":"2","marker-end":"url(#arrowhead)",class:"workflow-transition__line"},null,8,ee),y("text",{x:V(l),y:S(l),class:"workflow-transition__label","text-anchor":"middle","dominant-baseline":"middle"},C(l.label||"â†’"),9,le)],10,Q))),128))],8,K))],36))}}),[["__scopeId","data-v-a3e547b4"]]),ae={class:"node-editor"},ne={class:"node-editor__header"},te={class:"form-group"},ie={class:"form-group"},se={class:"form-group"},re={class:"form-group"},de={class:"role-checkboxes"},ue=["value","checked","onChange"],ce={class:"form-group"},ve={class:"action-checkboxes"},pe=["value","checked","onChange"],me={class:"node-editor__actions"},fe=O(u({__name:"NodeEditor",props:{node:{},workflowNodes:{}},emits:["save","delete","cancel"],setup(e,{emit:l}){const o=e,a=l,n=c(!1),t=N({}),i=N({name:o.node.name,type:o.node.type,description:o.node.description||"",allowed_roles:[...o.node.allowed_roles],actions:[...o.node.actions]}),d=[{value:"start",label:"Start"},{value:"state",label:"State"},{value:"end",label:"End"}],u=[{value:"admin",label:"Administrator"},{value:"editor",label:"Editor"},{value:"viewer",label:"Viewer"}],v=[{value:"approve",label:"Approve"},{value:"reject",label:"Reject"},{value:"request_changes",label:"Request Changes"},{value:"publish",label:"Publish"},{value:"archive",label:"Archive"}];z(()=>o.node,e=>{i.name=e.name,i.type=e.type,i.description=e.description||"",i.allowed_roles=[...e.allowed_roles],i.actions=[...e.actions]},{immediate:!0});const p=()=>{if(Object.keys(t).forEach(e=>delete t[e]),i.name.trim()||(t.name="Node name is required"),0===Object.keys(t).length){n.value=!0;try{const e=r(s({},o.node),{name:i.name.trim(),type:i.type,description:i.description.trim()||void 0,allowed_roles:i.allowed_roles,actions:i.actions});a("save",e)}finally{n.value=!1}}},m=()=>{confirm("Delete this node? All connected transitions will also be removed.")&&a("delete",o.node.id)};return(e,l)=>(_(),f("div",ae,[y("div",ne,[l[5]||(l[5]=y("h3",{class:"node-editor__title"},"Node Properties",-1)),j(A,{variant:"ghost",size:"sm",onClick:l[0]||(l[0]=l=>e.$emit("cancel")),"aria-label":"Close editor"},{default:M(()=>[...l[4]||(l[4]=[y("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[y("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),_:1})]),y("form",{onSubmit:w(p,["prevent"]),class:"node-editor__form"},[y("div",te,[j(R,{modelValue:i.name,"onUpdate:modelValue":l[1]||(l[1]=e=>i.name=e),label:"Node Name",required:"",error:t.name},null,8,["modelValue","error"])]),y("div",ie,[j(U,{modelValue:i.type,"onUpdate:modelValue":l[2]||(l[2]=e=>i.type=e),options:d,label:"Node Type",required:"",error:t.type,disabled:"start"===i.type},null,8,["modelValue","error","disabled"])]),y("div",se,[l[6]||(l[6]=y("label",{class:"form-label"},"Description",-1)),V(y("textarea",{"onUpdate:modelValue":l[3]||(l[3]=e=>i.description=e),class:"form-textarea",rows:"3",placeholder:"Optional description"},null,512),[[S,i.description]])]),y("div",re,[l[7]||(l[7]=y("label",{class:"form-label"},"Allowed Roles",-1)),y("div",de,[(_(),f(b,null,g(u,e=>y("label",{key:e.value,class:"checkbox-label"},[y("input",{type:"checkbox",value:e.value,checked:i.allowed_roles.includes(e.value),onChange:l=>((e,l)=>{l.target.checked?i.allowed_roles.includes(e)||i.allowed_roles.push(e):i.allowed_roles=i.allowed_roles.filter(l=>l!==e)})(e.value,l),class:"checkbox-input"},null,40,ue),y("span",null,C(e.label),1)])),64))])]),y("div",ce,[l[8]||(l[8]=y("label",{class:"form-label"},"Available Actions",-1)),y("div",ve,[(_(),f(b,null,g(v,e=>y("label",{key:e.value,class:"checkbox-label"},[y("input",{type:"checkbox",value:e.value,checked:i.actions.some(l=>l.action_type===e.value),onChange:l=>((e,l)=>{var o;if(l.target.checked){const l={id:`action-${Date.now()}`,label:(null==(o=v.find(l=>l.value===e))?void 0:o.label)||e,action_type:e,target_node_id:""};i.actions.push(l)}else i.actions=i.actions.filter(l=>l.action_type!==e)})(e.value,l),class:"checkbox-input"},null,40,pe),y("span",null,C(e.label),1)])),64))])]),y("div",me,[j(A,{variant:"danger",size:"sm",onClick:m,type:"button"},{default:M(()=>[...l[9]||(l[9]=[W(" Delete Node ",-1)])]),_:1}),j(A,{variant:"primary",type:"submit",loading:n.value},{default:M(()=>[...l[10]||(l[10]=[W(" Save Node ",-1)])]),_:1},8,["loading"])])],32)]))}}),[["__scopeId","data-v-740730d2"]]),we={class:"transition-editor"},ke={class:"transition-editor__header"},he={class:"form-group"},ye={class:"form-group"},be={class:"form-group"},ge={class:"form-group"},_e={class:"form-group"},xe={key:0,class:"form-group"},Ce={key:0,class:"condition-params"},Ne={key:1,class:"condition-params"},ze={key:2,class:"condition-params"},je={class:"transition-editor__actions"},Me=O(u({__name:"TransitionEditor",props:{transition:{},workflowNodes:{}},emits:["save","delete","cancel"],setup(e,{emit:l}){const o=e,a=l,n=c(!1),t=N({}),i=N({label:o.transition.label||"",description:o.transition.description||"",condition:o.transition.condition}),d=c("none"),u=c(""),p=c(""),m=c(0),k=v(()=>{const e=o.workflowNodes.find(e=>e.id===o.transition.from_node);return(null==e?void 0:e.name)||o.transition.from_node}),b=v(()=>{const e=o.workflowNodes.find(e=>e.id===o.transition.to_node);return(null==e?void 0:e.name)||o.transition.to_node}),g=[{value:"none",label:"No Condition"},{value:"role",label:"User Role"},{value:"action",label:"User Action"},{value:"time",label:"Time-based"}],x=[{value:"admin",label:"Administrator"},{value:"editor",label:"Editor"},{value:"viewer",label:"Viewer"}],C=[{value:"approve",label:"Approve"},{value:"reject",label:"Reject"},{value:"request_changes",label:"Request Changes"},{value:"publish",label:"Publish"},{value:"archive",label:"Archive"}];z(()=>o.transition,e=>{if(i.label=e.label||"",i.description=e.description||"",i.condition=e.condition,e.condition){const l=e.condition;"role"===l.field?(d.value="role",u.value=String(l.value)):"action"===l.field?(d.value="action",p.value=String(l.value)):"days"===l.field&&(d.value="time",m.value=Number(l.value))}else d.value="none"},{immediate:!0});const D=()=>{i.condition=void 0,u.value="",p.value="",m.value=0},$=()=>{if(Object.keys(t).forEach(e=>delete t[e]),i.label.trim()||(t.label="Transition label is required"),0===Object.keys(t).length){n.value=!0;try{let e;if("none"!==d.value)switch(d.value){case"role":e={field:"role",operator:"equals",value:u.value};break;case"action":e={field:"action",operator:"equals",value:p.value};break;case"time":e={field:"days",operator:"greater_than",value:m.value}}const l=r(s({},o.transition),{label:i.label.trim(),description:i.description.trim()||void 0,condition:e});a("save",l)}finally{n.value=!1}}},O=()=>{confirm("Delete this transition?")&&a("delete",o.transition.id)};return(e,l)=>(_(),f("div",we,[y("div",ke,[l[8]||(l[8]=y("h3",{class:"transition-editor__title"},"Transition Properties",-1)),j(A,{variant:"ghost",size:"sm",onClick:l[0]||(l[0]=l=>e.$emit("cancel")),"aria-label":"Close editor"},{default:M(()=>[...l[7]||(l[7]=[y("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[y("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),_:1})]),y("form",{onSubmit:w($,["prevent"]),class:"transition-editor__form"},[y("div",he,[l[9]||(l[9]=y("label",{class:"form-label"},"From Node",-1)),j(R,{"model-value":k.value,disabled:"",readonly:""},null,8,["model-value"])]),y("div",ye,[l[10]||(l[10]=y("label",{class:"form-label"},"To Node",-1)),j(R,{"model-value":b.value,disabled:"",readonly:""},null,8,["model-value"])]),y("div",be,[j(R,{modelValue:i.label,"onUpdate:modelValue":l[1]||(l[1]=e=>i.label=e),label:"Label",placeholder:"e.g., Approve",required:"",error:t.label},null,8,["modelValue","error"])]),y("div",ge,[l[11]||(l[11]=y("label",{class:"form-label"},"Description",-1)),V(y("textarea",{"onUpdate:modelValue":l[2]||(l[2]=e=>i.description=e),class:"form-textarea",rows:"3",placeholder:"Optional description"},null,512),[[S,i.description]])]),y("div",_e,[j(U,{modelValue:d.value,"onUpdate:modelValue":l[3]||(l[3]=e=>d.value=e),options:g,label:"Condition Type",onChange:D},null,8,["modelValue"])]),"none"!==d.value?(_(),f("div",xe,["role"===d.value?(_(),f("div",Ce,[j(U,{modelValue:u.value,"onUpdate:modelValue":l[4]||(l[4]=e=>u.value=e),options:x,label:"Required Role"},null,8,["modelValue"])])):h("",!0),"action"===d.value?(_(),f("div",Ne,[j(U,{modelValue:p.value,"onUpdate:modelValue":l[5]||(l[5]=e=>p.value=e),options:C,label:"Required Action"},null,8,["modelValue"])])):h("",!0),"time"===d.value?(_(),f("div",ze,[j(R,{modelValue:m.value,"onUpdate:modelValue":l[6]||(l[6]=e=>m.value=e),modelModifiers:{number:!0},type:"number",label:"Days",placeholder:"0"},null,8,["modelValue"])])):h("",!0)])):h("",!0),y("div",je,[j(A,{variant:"danger",size:"sm",onClick:O,type:"button"},{default:M(()=>[...l[12]||(l[12]=[W(" Delete Transition ",-1)])]),_:1}),j(A,{variant:"primary",type:"submit",loading:n.value},{default:M(()=>[...l[13]||(l[13]=[W(" Save Transition ",-1)])]),_:1},8,["loading"])])],32)]))}}),[["__scopeId","data-v-ccb07380"]]),Ve={class:"workflow-designer"},Se={class:"workflow-designer__toolbar"},We={key:1,class:"workflow-designer__workflow-info"},De={class:"workflow-designer__zoom-controls"},$e={class:"zoom-level"},Oe={class:"workflow-designer__layout"},Ae={class:"workflow-designer__canvas-area"},Pe={class:"workflow-designer__properties"},qe={key:2,class:"properties-empty"},Ee=O(u({__name:"WorkflowDesignerPage",setup(e){const l=D(),o=P(),a=E(),n=q(),t=c(null),i=c(null),r=c(null),u=c(null),m=c(null),b=c(null),g=c(!1),x=c(1),z=c({x:0,y:0}),V=c(!0),S=c(!1),O=c({x:0,y:0}),U=N({name:"",description:"",nodes:[],transitions:[]}),I=v(()=>o.hasPermission.value("admin.workflow_manage")),B=v(()=>o.hasPermission.value("admin.workflow_manage")),Y=v(()=>U.nodes.some(e=>"start"===e.type)),H=v(()=>!!t.value&&(U.name!==t.value.name||U.description!==(t.value.description||"")||JSON.stringify(U.nodes)!==JSON.stringify(t.value.nodes)||JSON.stringify(U.transitions)!==JSON.stringify(t.value.transitions))),L=v(()=>({left:`${O.value.x}px`,top:`${O.value.y}px`})),X=()=>d(this,null,function*(){try{yield a.fetchWorkflows()}catch(e){n.addNotification({type:"error",title:"Error",message:"Failed to load workflows"})}}),F=()=>{t.value=null,U.name="New Workflow",U.description="",U.nodes=[],U.transitions=[],i.value=null,r.value=null,u.value=null,m.value=null},J=()=>d(this,null,function*(){if(!U.name.trim())return void n.addNotification({type:"warning",title:"Warning",message:"Workflow name is required"});if(0===U.nodes.length)return void n.addNotification({type:"warning",title:"Warning",message:"Workflow must have at least one node"});if(!Y.value)return void n.addNotification({type:"warning",title:"Warning",message:"Workflow must have at least one start node"});if(U.nodes.some(e=>"end"===e.type)){g.value=!0;try{if(t.value){const e={name:U.name,description:U.description||void 0,nodes:U.nodes,transitions:U.transitions};yield a.updateWorkflow(t.value.id,e),n.addNotification({type:"success",title:"Success",message:"Workflow updated successfully"})}else{const e={name:U.name,description:U.description||void 0,nodes:U.nodes,transitions:U.transitions,is_active:!1},l=yield a.createWorkflow(e);t.value=l,n.addNotification({type:"success",title:"Success",message:"Workflow created successfully"})}yield X()}catch(e){n.addNotification({type:"error",title:"Error",message:"Failed to save workflow"})}finally{g.value=!1}}else n.addNotification({type:"warning",title:"Warning",message:"Workflow must have at least one end node"})}),G=()=>{t.value&&(b.value=t.value)},Z=()=>d(this,null,function*(){if(b.value)try{yield a.deleteWorkflow(b.value.id),b.value=null,t.value=null,n.addNotification({type:"success",title:"Success",message:"Workflow deleted successfully"}),yield X()}catch(e){n.addNotification({type:"error",title:"Error",message:"Failed to delete workflow"})}}),K=e=>{i.value=e,r.value=e.id,u.value=null,m.value=null},Q=e=>{u.value=e,m.value=e.id,i.value=null,r.value=null},ee=(e,l)=>{const o=U.nodes.find(l=>l.id===e);o&&(o.position=s({},l))},le=e=>{z.value=s({},e)},ae=e=>{x.value=e},ne=()=>{x.value=Math.min(2,x.value+.1)},te=()=>{x.value=Math.max(.5,x.value-.1)},ie=()=>{x.value=1,z.value={x:0,y:0}},se=e=>{if("start"===e&&Y.value)return void n.addNotification({type:"warning",title:"Warning",message:"Workflow can only have one start node"});const l={id:`node-${Date.now()}`,name:"start"===e?"Start":"end"===e?"End":"New State",type:e,position:{x:O.value.x/x.value-z.value.x/x.value,y:O.value.y/x.value-z.value.y/x.value},allowed_roles:[],actions:[]};U.nodes.push(l),S.value=!1,i.value=l,r.value=l.id},re=e=>{const l=U.nodes.findIndex(l=>l.id===e.id);-1!==l&&(U.nodes[l]=s({},e)),i.value=null,r.value=null},de=e=>{U.nodes=U.nodes.filter(l=>l.id!==e),U.transitions=U.transitions.filter(l=>l.from_node!==e&&l.to_node!==e),i.value=null,r.value=null},ue=e=>{const l=U.transitions.findIndex(l=>l.id===e.id);-1!==l?U.transitions[l]=s({},e):U.transitions.push(e),u.value=null,m.value=null},ce=e=>{U.transitions=U.transitions.filter(l=>l.id!==e),u.value=null,m.value=null};return p(()=>d(this,null,function*(){o.hasPermission.value("admin.workflow_manage")?(yield X(),document.addEventListener("contextmenu",e=>{e.target.closest(".workflow-designer__canvas-area")?(e.preventDefault(),O.value={x:e.clientX,y:e.clientY},S.value=!0):S.value=!1}),document.addEventListener("click",()=>{S.value=!1})):yield l.push({name:"forbidden"})})),(e,l)=>(_(),f("div",Ve,[y("div",Se,[I.value?(_(),$(A,{key:0,variant:"primary",onClick:F,"aria-label":"Create new workflow"},{default:M(()=>[...l[8]||(l[8]=[y("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[y("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),W(" Create Workflow ",-1)])]),_:1})):h("",!0),t.value?(_(),f("div",We,[j(R,{modelValue:U.name,"onUpdate:modelValue":l[0]||(l[0]=e=>U.name=e),placeholder:"Workflow name",class:"workflow-name-input"},null,8,["modelValue"]),j(A,{variant:"secondary",size:"sm",onClick:J,loading:g.value,disabled:!H.value},{default:M(()=>[...l[9]||(l[9]=[W(" Save ",-1)])]),_:1},8,["loading","disabled"]),j(A,{variant:"ghost",size:"sm",onClick:G,disabled:!B.value},{default:M(()=>[...l[10]||(l[10]=[W(" Delete ",-1)])]),_:1},8,["disabled"])])):h("",!0),y("div",De,[j(A,{variant:"ghost",size:"sm",onClick:te,disabled:x.value<=.5,"aria-label":"Zoom out"},{default:M(()=>[...l[11]||(l[11]=[y("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[y("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"})],-1)])]),_:1},8,["disabled"]),y("span",$e,C(Math.round(100*x.value))+"%",1),j(A,{variant:"ghost",size:"sm",onClick:ne,disabled:x.value>=2,"aria-label":"Zoom in"},{default:M(()=>[...l[12]||(l[12]=[y("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[y("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6m3-3H7"})],-1)])]),_:1},8,["disabled"]),j(A,{variant:"ghost",size:"sm",onClick:ie,"aria-label":"Reset zoom"},{default:M(()=>[...l[13]||(l[13]=[W(" Reset ",-1)])]),_:1})])]),y("div",Oe,[y("div",Ae,[j(oe,{nodes:U.nodes,transitions:U.transitions,zoom:x.value,pan:z.value,"selected-node-id":r.value,"selected-transition-id":m.value,"show-grid":V.value,onNodeClick:K,onTransitionClick:Q,onNodeDrag:ee,onPanChange:le,onZoomChange:ae},null,8,["nodes","transitions","zoom","pan","selected-node-id","selected-transition-id","show-grid"])]),y("div",Pe,[i.value?(_(),$(fe,{key:0,node:i.value,"workflow-nodes":U.nodes,onSave:re,onDelete:de,onCancel:l[1]||(l[1]=e=>i.value=null)},null,8,["node","workflow-nodes"])):u.value?(_(),$(Me,{key:1,transition:u.value,"workflow-nodes":U.nodes,onSave:ue,onDelete:ce,onCancel:l[2]||(l[2]=e=>u.value=null)},null,8,["transition","workflow-nodes"])):(_(),f("div",qe,[...l[14]||(l[14]=[y("p",null,"Select a node or transition to edit",-1)])]))])]),S.value?(_(),f("div",{key:0,class:"node-menu",style:k(L.value),onClick:l[6]||(l[6]=w(()=>{},["stop"]))},[j(A,{variant:"ghost",size:"sm",onClick:l[3]||(l[3]=e=>se("start")),disabled:Y.value},{default:M(()=>[...l[15]||(l[15]=[W(" Add Start Node ",-1)])]),_:1},8,["disabled"]),j(A,{variant:"ghost",size:"sm",onClick:l[4]||(l[4]=e=>se("state"))},{default:M(()=>[...l[16]||(l[16]=[W(" Add State Node ",-1)])]),_:1}),j(A,{variant:"ghost",size:"sm",onClick:l[5]||(l[5]=e=>se("end"))},{default:M(()=>[...l[17]||(l[17]=[W(" Add End Node ",-1)])]),_:1})],4)):h("",!0),b.value?(_(),$(T,{key:1,title:`Delete Workflow: ${b.value.name}`,message:"This action cannot be undone. Are you sure?",onConfirm:Z,onCancel:l[7]||(l[7]=e=>b.value=null)},null,8,["title"])):h("",!0)]))}}),[["__scopeId","data-v-933ca9a3"]]);export{Ee as default};
//# sourceMappingURL=WorkflowDesignerPage-DHAlsbUd.js.map

var e=Object.defineProperty,l=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,a=(l,u,t)=>u in l?e(l,u,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[u]=t,n=(e,n)=>{for(var r in n||(n={}))u.call(n,r)&&a(e,r,n[r]);if(l)for(var r of l(n))t.call(n,r)&&a(e,r,n[r]);return e},r=(e,l,u)=>new Promise((t,a)=>{var n=e=>{try{s(u.next(e))}catch(l){a(l)}},r=e=>{try{s(u.throw(e))}catch(l){a(l)}},s=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,r);s((u=u.apply(e,l)).next())});import{d as s,r as i,c as o}from"./vue-vendor-B11yH1L4.js";import{a as c,u as v,f as h}from"./index-CEUju959.js";const f=new class{getUsers(e){return r(this,null,function*(){const l={};return(null==e?void 0:e.page)&&(l.page=e.page),(null==e?void 0:e.page_size)&&(l.page_size=e.page_size),(null==e?void 0:e.role)&&(l.role=e.role),(null==e?void 0:e.status)&&(l.status=e.status),(null==e?void 0:e.search)&&(l.search=e.search),c.get("/v4/admin/users/",{params:l},!1)})}getUser(e){return r(this,null,function*(){return c.get(`/v4/admin/users/${e}/`,void 0,!0)})}createUser(e){return r(this,null,function*(){return c.post("/v4/admin/users/",e)})}updateUser(e,l){return r(this,null,function*(){return c.put(`/v4/admin/users/${e}/`,l)})}deleteUser(e){return r(this,null,function*(){return c.delete(`/v4/admin/users/${e}/`)})}bulkUserOperation(e){return r(this,null,function*(){return c.post("/v4/admin/users/bulk/",e)})}getSchemas(e){return r(this,null,function*(){const l={};return(null==e?void 0:e.page)&&(l.page=e.page),(null==e?void 0:e.page_size)&&(l.page_size=e.page_size),(null==e?void 0:e.applies_to)&&(l.applies_to=e.applies_to),void 0!==(null==e?void 0:e.is_active)&&(l.is_active=e.is_active),(null==e?void 0:e.search)&&(l.search=e.search),c.get("/v4/admin/schemas/",{params:l},!0)})}getSchema(e){return r(this,null,function*(){return c.get(`/v4/admin/schemas/${e}/`,void 0,!0)})}createSchema(e){return r(this,null,function*(){return c.post("/v4/admin/schemas/",e)})}updateSchema(e,l){return r(this,null,function*(){return c.put(`/v4/admin/schemas/${e}/`,l)})}deleteSchema(e){return r(this,null,function*(){return c.delete(`/v4/admin/schemas/${e}/`)})}getWorkflows(e){return r(this,null,function*(){const l={};return(null==e?void 0:e.page)&&(l.page=e.page),(null==e?void 0:e.page_size)&&(l.page_size=e.page_size),void 0!==(null==e?void 0:e.is_active)&&(l.is_active=e.is_active),(null==e?void 0:e.search)&&(l.search=e.search),c.get("/v4/admin/workflows/",{params:l},!0)})}getWorkflow(e){return r(this,null,function*(){return c.get(`/v4/admin/workflows/${e}/`,void 0,!0)})}createWorkflow(e){return r(this,null,function*(){return c.post("/v4/admin/workflows/",e)})}updateWorkflow(e,l){return r(this,null,function*(){return c.put(`/v4/admin/workflows/${e}/`,l)})}deleteWorkflow(e){return r(this,null,function*(){return c.delete(`/v4/admin/workflows/${e}/`)})}},d=s("admin",()=>{const e=v(),l=i([]),u=i(0),t=i([]),a=i({role:"",status:"",search:""}),s=i([]),c=i(0),d=i(null),m=i([]),p=i(0),w=i(null),y=i(null),g=i(!1),k=i(null),U=i(null),_=o(()=>e.hasPermission.value("admin.user_create")),S=o(()=>e.hasPermission.value("admin.user_edit")),W=o(()=>e.hasPermission.value("admin.user_delete")),b=o(()=>e.hasPermission.value("admin.schema_manage")),C=o(()=>e.hasPermission.value("admin.workflow_manage")),P=o(()=>{let e=l.value;if(a.value.role&&(e=e.filter(e=>e.role===a.value.role)),a.value.status&&("active"===a.value.status?e=e.filter(e=>e.is_active):"inactive"===a.value.status&&(e=e.filter(e=>!e.is_active))),a.value.search){const l=a.value.search.toLowerCase();e=e.filter(e=>e.username.toLowerCase().includes(l)||e.email.toLowerCase().includes(l)||e.first_name.toLowerCase().includes(l)||e.last_name.toLowerCase().includes(l))}return e}),z=o(()=>t.value.length),O=o(()=>!1);function $(e){return r(this,null,function*(){const t=Date.now();if(!(U.value&&t-U.value<3e5&&l.value.length>0)||e){g.value=!0,k.value=null;try{const r=n(n({},a.value),e),s=yield f.getUsers(r);l.value=s.results,u.value=s.count,U.value=t}catch(r){throw k.value=h(r),l.value=[],u.value=0,r}finally{g.value=!1}}})}return{users:l,totalUsersCount:u,selectedUsers:t,usersFilters:a,schemas:s,totalSchemasCount:c,currentSchema:d,workflows:m,totalWorkflowsCount:p,currentWorkflow:w,selectedNode:y,isLoading:g,error:k,lastFetchTime:U,canCreateUser:_,canEditUser:S,canDeleteUser:W,canManageSchemas:b,canManageWorkflows:C,filteredUsers:P,selectedUsersCount:z,hasUnsavedChanges:O,fetchUsers:$,createUser:function(e){return r(this,null,function*(){g.value=!0,k.value=null;try{const t=yield f.createUser(e);return l.value.push(t),u.value++,U.value=null,t}catch(t){throw k.value=h(t),t}finally{g.value=!1}})},updateUser:function(e,u){return r(this,null,function*(){g.value=!0,k.value=null;try{const t=yield f.updateUser(e,u),a=l.value.findIndex(l=>l.id===e);return-1!==a&&(l.value[a]=t),U.value=null,t}catch(t){throw k.value=h(t),t}finally{g.value=!1}})},deleteUser:function(e){return r(this,null,function*(){g.value=!0,k.value=null;try{yield f.deleteUser(e),l.value=l.value.filter(l=>l.id!==e),u.value--,t.value=t.value.filter(l=>l!==e),U.value=null}catch(a){throw k.value=h(a),a}finally{g.value=!1}})},bulkUserOperation:function(e){return r(this,null,function*(){if(e.ids.length>100)throw new Error("Maximum 100 users allowed per bulk operation");g.value=!0,k.value=null;try{const l=yield f.bulkUserOperation(e);return yield $(),l}catch(l){throw k.value=h(l),l}finally{g.value=!1}})},selectUsers:function(e){t.value=e},clearUserSelection:function(){t.value=[]},setUsersFilters:function(e){a.value=n(n({},a.value),e)},clearUsersFilters:function(){a.value={role:"",status:"",search:""}},fetchSchemas:function(e){return r(this,null,function*(){g.value=!0,k.value=null;try{const l=yield f.getSchemas(e);s.value=l.results,c.value=l.count}catch(l){throw k.value=h(l),s.value=[],c.value=0,l}finally{g.value=!1}})},getSchema:function(e){return r(this,null,function*(){g.value=!0,k.value=null;try{const l=yield f.getSchema(e);return d.value=l,l}catch(l){throw k.value=h(l),d.value=null,l}finally{g.value=!1}})},createSchema:function(e){return r(this,null,function*(){g.value=!0,k.value=null;try{const l=yield f.createSchema(e);return s.value.push(l),c.value++,l}catch(l){throw k.value=h(l),l}finally{g.value=!1}})},updateSchema:function(e,l){return r(this,null,function*(){var u;g.value=!0,k.value=null;try{const t=yield f.updateSchema(e,l),a=s.value.findIndex(l=>l.id===e);return-1!==a&&(s.value[a]=t),(null==(u=d.value)?void 0:u.id)===e&&(d.value=t),t}catch(t){throw k.value=h(t),t}finally{g.value=!1}})},deleteSchema:function(e){return r(this,null,function*(){var l;g.value=!0,k.value=null;try{yield f.deleteSchema(e),s.value=s.value.filter(l=>l.id!==e),c.value--,(null==(l=d.value)?void 0:l.id)===e&&(d.value=null)}catch(u){throw k.value=h(u),u}finally{g.value=!1}})},setCurrentSchema:function(e){d.value=e},fetchWorkflows:function(e){return r(this,null,function*(){g.value=!0,k.value=null;try{const l=yield f.getWorkflows(e);m.value=l.results,p.value=l.count}catch(l){throw k.value=h(l),m.value=[],p.value=0,l}finally{g.value=!1}})},getWorkflow:function(e){return r(this,null,function*(){g.value=!0,k.value=null;try{const l=yield f.getWorkflow(e);return w.value=l,l}catch(l){throw k.value=h(l),w.value=null,l}finally{g.value=!1}})},createWorkflow:function(e){return r(this,null,function*(){g.value=!0,k.value=null;try{const l=yield f.createWorkflow(e);return m.value.push(l),p.value++,l}catch(l){throw k.value=h(l),l}finally{g.value=!1}})},updateWorkflow:function(e,l){return r(this,null,function*(){var u;g.value=!0,k.value=null;try{const t=yield f.updateWorkflow(e,l),a=m.value.findIndex(l=>l.id===e);return-1!==a&&(m.value[a]=t),(null==(u=w.value)?void 0:u.id)===e&&(w.value=t),t}catch(t){throw k.value=h(t),t}finally{g.value=!1}})},deleteWorkflow:function(e){return r(this,null,function*(){var l;g.value=!0,k.value=null;try{yield f.deleteWorkflow(e),m.value=m.value.filter(l=>l.id!==e),p.value--,(null==(l=w.value)?void 0:l.id)===e&&(w.value=null)}catch(u){throw k.value=h(u),u}finally{g.value=!1}})},setCurrentWorkflow:function(e){w.value=e},setSelectedNode:function(e){y.value=e},clearError:function(){k.value=null},invalidateCache:function(){U.value=null}}},{persist:{paths:["usersFilters"]}});export{d as u};
//# sourceMappingURL=adminStore-BAcaV1Pb.js.map

var e=(e,a,l)=>new Promise((t,n)=>{var r=e=>{try{u(l.next(e))}catch(a){n(a)}},s=e=>{try{u(l.throw(e))}catch(a){n(a)}},u=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,s);u((l=l.apply(e,a)).next())});import{b as a,r as l,c as t,w as n,k as r,e as s,l as u,s as o,i,f as c,t as d,A as v,F as p,h as f,q as m,x,j as h}from"./vue-vendor-FOQ7SlVG.js";import{u as y,e as g,_ as b}from"./index-Bkz-5-QE.js";import{_ as k}from"./Input.vue_vue_type_script_setup_true_lang-2ZgOsU_G.js";import"./utils-vendor-C6ZCcsv1.js";const w={class:"min-h-screen flex items-center justify-center bg-neutral-50 dark:bg-neutral-900 px-4"},C={class:"text-center mb-6"},_={class:"text-sm text-neutral-600 dark:text-neutral-400 mt-2"},F={key:0,class:"space-y-6"},P={class:"text-center"},L={class:"inline-block p-4 bg-white border-2 border-dashed border-neutral-300 rounded-lg"},z=["src"],S={key:1,class:"w-48 h-48 flex items-center justify-center text-neutral-500"},T={class:"space-y-2"},j={class:"flex items-center space-x-2"},A={class:"flex-1 p-2 bg-neutral-100 dark:bg-neutral-800 rounded text-sm font-mono text-center select-all"},B={class:"space-y-3"},R={class:"flex items-center justify-between"},I={class:"grid grid-cols-2 gap-2"},M={key:1,class:"space-y-4"},V={class:"text-center"},q={class:"text-center"},Q=["disabled"],U={key:2,class:"mt-4 p-4 bg-red-50 border border-red-200 rounded-md"},E={class:"flex"},O={class:"ml-3"},G={class:"text-sm text-red-800"},H={class:"ml-auto pl-3"},$={key:3,class:"mt-4 p-4 bg-green-50 border border-green-200 rounded-md"},D={class:"flex"},J={class:"ml-3"},K={class:"text-sm text-green-800"},N={class:"ml-auto pl-3"},W=a({__name:"Login2FAPage",setup(a){const W=x(),X=y(),Y=l(!1),Z=l(""),ee=l(""),ae=l(null),le=l(null),te=l(!1),ne=l(!1),re=l(!1),se=l(!1),ue=l(!1),oe=l(0),ie=l(!1),ce=t(()=>{var e,a;return null!=(a=null==(e=X.twoFactorSetup)?void 0:e.secret)?a:""}),de=t(()=>{var e,a;return null!=(a=null==(e=X.twoFactorSetup)?void 0:e.qr_code_url)?a:""}),ve=t(()=>{var e,a;return null!=(a=null==(e=X.twoFactorSetup)?void 0:e.backup_codes)?a:[]});function pe(){return e(this,null,function*(){var e,a;if(Z.value&&6===Z.value.length){te.value=!0,ee.value="",ae.value="";try{const e=se.value?"backup_code":"totp";(yield X.verifyTwoFactor(Z.value,e)).success?(le.value="Authentication successful!",yield ye()):ee.value="Invalid code. Please try again."}catch(l){429===(null==(e=null==l?void 0:l.response)?void 0:e.status)?ae.value="Too many attempts. Please wait before trying again.":401===(null==(a=null==l?void 0:l.response)?void 0:a.status)?ee.value="Invalid code. Please check and try again.":ae.value="Verification failed. Please try again."}finally{te.value=!1}}else ee.value="Please enter a valid 6-digit code"})}function fe(){return e(this,null,function*(){ne.value=!0,ae.value="";try{Y.value=!1,le.value="Setup complete! Please enter your first authentication code."}catch(e){ae.value="Failed to complete setup. Please try again."}finally{ne.value=!1}})}function me(){return e(this,null,function*(){re.value=!0,ae.value="";try{yield X.regenerateBackupCodes(),le.value="Backup codes regenerated successfully."}catch(e){ae.value="Failed to regenerate backup codes. Please try again."}finally{re.value=!1}})}function xe(){return e(this,null,function*(){if(ce.value)try{yield navigator.clipboard.writeText(ce.value),ie.value=!0,setTimeout(()=>{ie.value=!1},2e3)}catch(e){}})}function he(){return e(this,null,function*(){if(!ue.value)try{!function(){oe.value=30,ue.value=!0;const e=setInterval(()=>{oe.value--,oe.value<=0&&(ue.value=!1,clearInterval(e))},1e3)}(),le.value="Code resent. Please check your authenticator app."}catch(e){ae.value="Failed to resend code. Please try again."}})}function ye(){return e(this,null,function*(){const e=W.currentRoute.value.query.returnTo||"/";yield W.push(e)})}return n(Z,()=>{ee.value&&(ee.value="")}),r(()=>{!function(){e(this,null,function*(){var e;try{yield X.checkTwoFactorStatus(),(null==(e=X.twoFactorStatus)?void 0:e.enabled)?X.twoFactorPending?Y.value=!1:yield ye():(Y.value=!0,yield X.enableTwoFactor())}catch(a){ae.value="Failed to initialize 2FA. Please try again."}})}()}),(e,a)=>(h(),s("div",w,[u(b,{class:"w-full max-w-md"},{default:o(()=>[i("div",C,[a[4]||(a[4]=i("h1",{class:"text-2xl font-semibold text-neutral-900 dark:text-neutral-100"}," Two-Factor Authentication ",-1)),i("p",_,d(Y.value?"Set up your authenticator app":"Enter your authentication code"),1)]),Y.value?(h(),s("div",F,[i("div",P,[i("div",L,[de.value?(h(),s("img",{key:0,src:de.value,alt:"QR Code for TOTP setup",class:"w-48 h-48"},null,8,z)):(h(),s("div",S,[...a[5]||(a[5]=[i("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"},null,-1)])]))]),a[6]||(a[6]=i("p",{class:"text-xs text-neutral-500 mt-2 max-w-xs mx-auto"}," Scan this QR code with your authenticator app (Google Authenticator, Authy, etc.) ",-1))]),i("div",T,[a[8]||(a[8]=i("label",{class:"text-sm font-medium text-neutral-700 dark:text-neutral-300"}," Or enter this code manually: ",-1)),i("div",j,[i("code",A,d(ce.value),1),u(g,{variant:"outline",size:"sm",onClick:xe,title:ie.value?"Copied!":"Copy to clipboard"},{default:o(()=>[...a[7]||(a[7]=[i("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1)])]),_:1},8,["title"])])]),i("div",B,[i("div",R,[a[10]||(a[10]=i("label",{class:"text-sm font-medium text-neutral-700 dark:text-neutral-300"}," Backup Codes ",-1)),u(g,{variant:"ghost",size:"sm",onClick:me,loading:re.value},{default:o(()=>[...a[9]||(a[9]=[v(" Regenerate ",-1)])]),_:1},8,["loading"])]),i("div",I,[(h(!0),s(p,null,f(ve.value,e=>(h(),s("code",{key:e,class:"p-2 bg-neutral-100 dark:bg-neutral-800 rounded text-xs font-mono text-center select-all"},d(e),1))),128))]),a[11]||(a[11]=i("p",{class:"text-xs text-amber-600 dark:text-amber-400"}," ⚠️ Save these backup codes in a secure place. Each code can only be used once. ",-1))]),u(g,{variant:"primary",class:"w-full",onClick:fe,loading:ne.value},{default:o(()=>[...a[12]||(a[12]=[v(" I've scanned the QR code ",-1)])]),_:1},8,["loading"])])):(h(),s("div",M,[i("form",{onSubmit:m(pe,["prevent"]),class:"space-y-4"},[u(k,{modelValue:Z.value,"onUpdate:modelValue":a[0]||(a[0]=e=>Z.value=e),type:"text",label:"Authentication Code",placeholder:"000000",maxlength:6,required:!0,error:ee.value,disabled:te.value,class:"text-center text-lg tracking-widest",inputmode:"numeric",pattern:"[0-9]*",autocomplete:"one-time-code"},null,8,["modelValue","error","disabled"]),u(g,{type:"submit",variant:"primary",class:"w-full",loading:te.value,disabled:!Z.value||6!==Z.value.length},{default:o(()=>[...a[13]||(a[13]=[v(" Verify Code ",-1)])]),_:1},8,["loading","disabled"])],32),i("div",V,[i("button",{onClick:a[1]||(a[1]=e=>se.value=!se.value),class:"text-sm text-primary-600 hover:text-primary-500 dark:text-primary-400"},d(se.value?"Use authenticator code":"Use backup code instead"),1)]),i("div",q,[i("button",{onClick:he,class:"text-sm text-neutral-600 hover:text-neutral-500 dark:text-neutral-400",disabled:ue.value},d(ue.value?`Resend in ${oe.value}s`:"Resend code"),9,Q)])])),ae.value?(h(),s("div",U,[i("div",E,[a[15]||(a[15]=i("div",{class:"flex-shrink-0"},[i("svg",{class:"h-5 w-5 text-red-400",fill:"currentColor",viewBox:"0 0 20 20"},[i("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),i("div",O,[i("p",G,d(ae.value),1)]),i("div",H,[i("button",{onClick:a[2]||(a[2]=e=>ae.value=null),class:"inline-flex rounded-md p-1.5 text-red-500 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-red-600"},[...a[14]||(a[14]=[i("svg",{class:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20"},[i("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])])])])])):c("",!0),le.value?(h(),s("div",$,[i("div",D,[a[17]||(a[17]=i("div",{class:"flex-shrink-0"},[i("svg",{class:"h-5 w-5 text-green-400",fill:"currentColor",viewBox:"0 0 20 20"},[i("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})])],-1)),i("div",J,[i("p",K,d(le.value),1)]),i("div",N,[i("button",{onClick:a[3]||(a[3]=e=>le.value=null),class:"inline-flex rounded-md p-1.5 text-green-500 hover:bg-green-100 focus:outline-none focus:ring-2 focus:ring-green-600"},[...a[16]||(a[16]=[i("svg",{class:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20"},[i("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])])])])])):c("",!0)]),_:1})]))}});export{W as default};
//# sourceMappingURL=Login2FAPage-DpeX_qsg.js.map

{"version":3,"file":"DashboardPage-DzscEweA.js","sources":["../../src/services/dashboardService.ts","../../src/stores/dashboardStore.ts","../../src/pages/DashboardPage.vue"],"sourcesContent":["import { apiService } from './apiService'\r\n\r\nexport interface DashboardStats {\r\n  documents: {\r\n    total: number\r\n    with_analysis: number\r\n    without_analysis: number\r\n  }\r\n  analyses: {\r\n    completed: number\r\n    processing: number\r\n    pending: number\r\n    failed: number\r\n  }\r\n  providers: Array<{\r\n    provider: string\r\n    count: number\r\n  }>\r\n}\r\n\r\nexport interface ActivityItem {\r\n  id: number\r\n  type: 'upload' | 'download' | 'share' | 'comment' | 'tag' | 'delete'\r\n  user: string\r\n  user_id: number\r\n  asset_id?: number\r\n  asset_label?: string\r\n  timestamp: string\r\n  description: string\r\n}\r\n\r\nexport interface StorageMetrics {\r\n  total_size: number\r\n  used_size: number\r\n  available_size: number\r\n  usage_percentage: number\r\n  by_type: Array<{\r\n    type: string\r\n    count: number\r\n    size: number\r\n  }>\r\n}\r\n\r\nclass DashboardService {\r\n  /**\r\n   * Get dashboard statistics\r\n   */\r\n  async getDashboardStats(): Promise<DashboardStats> {\r\n    return apiService.get<DashboardStats>(\r\n      '/v4/dam/dashboard-stats/',\r\n      undefined,\r\n      true // Cache for 5 minutes\r\n    )\r\n  }\r\n\r\n  /**\r\n   * Get activity feed\r\n   */\r\n  async getActivityFeed(limit = 20): Promise<ActivityItem[]> {\r\n    // TODO: Replace with actual activity endpoint when available\r\n    // For now, return empty array (endpoint doesn't exist yet)\r\n    try {\r\n      return await apiService.get<ActivityItem[]>(\r\n        '/v4/dam/activity/',\r\n        { params: { limit } } as any,\r\n        false\r\n      )\r\n    } catch {\r\n      // Fallback to empty array if endpoint doesn't exist\r\n      return []\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get storage metrics\r\n   */\r\n  async getStorageMetrics(): Promise<StorageMetrics> {\r\n    // TODO: Replace with actual storage endpoint when available\r\n    return apiService.get<StorageMetrics>(\r\n      '/v4/dam/storage-metrics/',\r\n      undefined,\r\n      true // Cache for 5 minutes\r\n    ).catch(() => {\r\n      // Fallback to calculated metrics from assets\r\n      return {\r\n        total_size: 0,\r\n        used_size: 0,\r\n        available_size: 0,\r\n        usage_percentage: 0,\r\n        by_type: []\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nexport const dashboardService = new DashboardService()\r\n\r\n","import { defineStore } from 'pinia'\r\nimport { ref, computed } from 'vue'\r\nimport { dashboardService, type DashboardStats, type ActivityItem, type StorageMetrics } from '@/services/dashboardService'\r\nimport { formatApiError } from '@/utils/errors'\r\n\r\nexport const useDashboardStore = defineStore(\r\n  'dashboard',\r\n  () => {\r\n    // State\r\n    const stats = ref<DashboardStats | null>(null)\r\n    const activityFeed = ref<ActivityItem[]>([])\r\n    const storageMetrics = ref<StorageMetrics | null>(null)\r\n    const isLoading = ref(false)\r\n    const error = ref<string | null>(null)\r\n    const lastUpdated = ref<Date | null>(null)\r\n\r\n    // Getters\r\n    const hasRecentActivity = computed(() => activityFeed.value.length > 0)\r\n    const storageUsagePercentage = computed(() => {\r\n      if (!storageMetrics.value) return 0\r\n      return storageMetrics.value.usage_percentage\r\n    })\r\n    const formattedStorageUsed = computed(() => {\r\n      if (!storageMetrics.value) return '0 B'\r\n      return formatBytes(storageMetrics.value.used_size)\r\n    })\r\n    const formattedStorageTotal = computed(() => {\r\n      if (!storageMetrics.value) return '0 B'\r\n      return formatBytes(storageMetrics.value.total_size)\r\n    })\r\n\r\n    // Actions\r\n    async function fetchDashboardStats() {\r\n      isLoading.value = true\r\n      error.value = null\r\n\r\n      try {\r\n        const data = await dashboardService.getDashboardStats()\r\n        stats.value = data\r\n        lastUpdated.value = new Date()\r\n      } catch (err) {\r\n        error.value = formatApiError(err)\r\n        throw err\r\n      } finally {\r\n        isLoading.value = false\r\n      }\r\n    }\r\n\r\n    async function fetchActivityFeed(limit = 20) {\r\n      try {\r\n        const data = await dashboardService.getActivityFeed(limit)\r\n        activityFeed.value = data\r\n      } catch (err) {\r\n        // Activity feed is optional, don't throw\r\n        console.warn('Failed to fetch activity feed:', err)\r\n        activityFeed.value = []\r\n      }\r\n    }\r\n\r\n    async function fetchStorageMetrics() {\r\n      try {\r\n        const data = await dashboardService.getStorageMetrics()\r\n        storageMetrics.value = data\r\n      } catch (err) {\r\n        // Storage metrics are optional, don't throw\r\n        console.warn('Failed to fetch storage metrics:', err)\r\n        storageMetrics.value = null\r\n      }\r\n    }\r\n\r\n    async function refresh() {\r\n      await Promise.all([\r\n        fetchDashboardStats(),\r\n        fetchActivityFeed(),\r\n        fetchStorageMetrics()\r\n      ])\r\n    }\r\n\r\n    // Helper function\r\n    function formatBytes(bytes: number): string {\r\n      if (bytes === 0) return '0 B'\r\n      const k = 1024\r\n      const sizes = ['B', 'KB', 'MB', 'GB', 'TB']\r\n      const i = Math.floor(Math.log(bytes) / Math.log(k))\r\n      return `${Math.round((bytes / Math.pow(k, i)) * 100) / 100} ${sizes[i]}`\r\n    }\r\n\r\n    return {\r\n      // State\r\n      stats,\r\n      activityFeed,\r\n      storageMetrics,\r\n      isLoading,\r\n      error,\r\n      lastUpdated,\r\n      // Getters\r\n      hasRecentActivity,\r\n      storageUsagePercentage,\r\n      formattedStorageUsed,\r\n      formattedStorageTotal,\r\n      // Actions\r\n      fetchDashboardStats,\r\n      fetchActivityFeed,\r\n      fetchStorageMetrics,\r\n      refresh\r\n    }\r\n  },\r\n  {\r\n    persist: false // Don't persist dashboard data\r\n  }\r\n)\r\n\r\n\r\n\r\n","<template>\r\n  <div class=\"dashboard-page min-h-screen bg-neutral-50 dark:bg-neutral-50\">\r\n    <div class=\"container mx-auto px-4 py-8\">\r\n      <!-- Welcome Banner -->\r\n      <div class=\"mb-8\">\r\n        <h1 class=\"text-3xl font-bold text-neutral-900 dark:text-neutral-900 mb-2\">\r\n          Добро пожаловать, {{ userName }}!\r\n        </h1>\r\n        <p class=\"text-neutral-600 dark:text-neutral-600\">\r\n          Обзор вашей DAM системы\r\n        </p>\r\n      </div>\r\n\r\n      <!-- Loading State -->\r\n      <div v-if=\"dashboardStore.isLoading && !dashboardStore.stats\" class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8\">\r\n        <div\r\n          v-for=\"i in 4\"\r\n          :key=\"i\"\r\n          class=\"bg-neutral-100 dark:bg-neutral-100 rounded-lg p-6 animate-pulse\"\r\n        >\r\n          <div class=\"h-4 bg-neutral-300 dark:bg-neutral-300 rounded w-1/2 mb-4\"></div>\r\n          <div class=\"h-8 bg-neutral-300 dark:bg-neutral-300 rounded w-3/4\"></div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Error State -->\r\n      <div\r\n        v-else-if=\"dashboardStore.error && !dashboardStore.stats\"\r\n        class=\"mb-8 p-4 bg-error/10 border border-error rounded-lg\"\r\n      >\r\n        <p class=\"text-error\">{{ dashboardStore.error }}</p>\r\n        <button\r\n          class=\"mt-4 px-4 py-2 bg-primary-500 text-white rounded-md hover:bg-primary-600 transition-colors min-h-[44px]\"\r\n          @click=\"dashboardStore.refresh()\"\r\n          type=\"button\"\r\n          aria-label=\"Повторить загрузку\"\r\n        >\r\n          Попробовать снова\r\n        </button>\r\n      </div>\r\n\r\n      <!-- Stats Cards -->\r\n      <div\r\n        v-if=\"dashboardStore.stats\"\r\n        class=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8\"\r\n        role=\"region\"\r\n        aria-label=\"Статистика системы\"\r\n      >\r\n        <!-- Total Documents -->\r\n        <Card class=\"p-6\">\r\n          <div class=\"flex items-center justify-between mb-4\">\r\n            <h3 class=\"text-sm font-medium text-neutral-600 dark:text-neutral-600\">\r\n              Всего документов\r\n            </h3>\r\n            <svg\r\n              class=\"w-8 h-8 text-primary-500\"\r\n              fill=\"none\"\r\n              stroke=\"currentColor\"\r\n              viewBox=\"0 0 24 24\"\r\n              aria-hidden=\"true\"\r\n            >\r\n              <path\r\n                stroke-linecap=\"round\"\r\n                stroke-linejoin=\"round\"\r\n                stroke-width=\"2\"\r\n                d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"\r\n              />\r\n            </svg>\r\n          </div>\r\n          <p class=\"text-3xl font-bold text-neutral-900 dark:text-neutral-900\">\r\n            {{ dashboardStore.stats.documents.total.toLocaleString() }}\r\n          </p>\r\n          <p class=\"text-sm text-neutral-600 dark:text-neutral-600 mt-2\">\r\n            {{ dashboardStore.stats.documents.with_analysis }} с AI анализом\r\n          </p>\r\n        </Card>\r\n\r\n        <!-- Completed Analyses -->\r\n        <Card class=\"p-6\">\r\n          <div class=\"flex items-center justify-between mb-4\">\r\n            <h3 class=\"text-sm font-medium text-neutral-600 dark:text-neutral-600\">\r\n              Завершенных анализов\r\n            </h3>\r\n            <svg\r\n              class=\"w-8 h-8 text-success\"\r\n              fill=\"none\"\r\n              stroke=\"currentColor\"\r\n              viewBox=\"0 0 24 24\"\r\n              aria-hidden=\"true\"\r\n            >\r\n              <path\r\n                stroke-linecap=\"round\"\r\n                stroke-linejoin=\"round\"\r\n                stroke-width=\"2\"\r\n                d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n              />\r\n            </svg>\r\n          </div>\r\n          <p class=\"text-3xl font-bold text-neutral-900 dark:text-neutral-900\">\r\n            {{ dashboardStore.stats.analyses.completed.toLocaleString() }}\r\n          </p>\r\n          <p class=\"text-sm text-neutral-600 dark:text-neutral-600 mt-2\">\r\n            {{ dashboardStore.stats.analyses.processing }} в обработке\r\n          </p>\r\n        </Card>\r\n\r\n        <!-- Pending Analyses -->\r\n        <Card class=\"p-6\">\r\n          <div class=\"flex items-center justify-between mb-4\">\r\n            <h3 class=\"text-sm font-medium text-neutral-600 dark:text-neutral-600\">\r\n              Ожидающих анализа\r\n            </h3>\r\n            <svg\r\n              class=\"w-8 h-8 text-warning\"\r\n              fill=\"none\"\r\n              stroke=\"currentColor\"\r\n              viewBox=\"0 0 24 24\"\r\n              aria-hidden=\"true\"\r\n            >\r\n              <path\r\n                stroke-linecap=\"round\"\r\n                stroke-linejoin=\"round\"\r\n                stroke-width=\"2\"\r\n                d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n              />\r\n            </svg>\r\n          </div>\r\n          <p class=\"text-3xl font-bold text-neutral-900 dark:text-neutral-900\">\r\n            {{ dashboardStore.stats.analyses.pending.toLocaleString() }}\r\n          </p>\r\n          <p class=\"text-sm text-neutral-600 dark:text-neutral-600 mt-2\">\r\n            {{ dashboardStore.stats.analyses.failed }} ошибок\r\n          </p>\r\n        </Card>\r\n\r\n        <!-- Storage Usage -->\r\n        <Card class=\"p-6\">\r\n          <div class=\"flex items-center justify-between mb-4\">\r\n            <h3 class=\"text-sm font-medium text-neutral-600 dark:text-neutral-600\">\r\n              Использовано хранилища\r\n            </h3>\r\n            <svg\r\n              class=\"w-8 h-8 text-primary-500\"\r\n              fill=\"none\"\r\n              stroke=\"currentColor\"\r\n              viewBox=\"0 0 24 24\"\r\n              aria-hidden=\"true\"\r\n            >\r\n              <path\r\n                stroke-linecap=\"round\"\r\n                stroke-linejoin=\"round\"\r\n                stroke-width=\"2\"\r\n                d=\"M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4\"\r\n              />\r\n            </svg>\r\n          </div>\r\n          <p class=\"text-3xl font-bold text-neutral-900 dark:text-neutral-900\">\r\n            {{ dashboardStore.formattedStorageUsed }}\r\n          </p>\r\n          <p class=\"text-sm text-neutral-600 dark:text-neutral-600 mt-2\">\r\n            из {{ dashboardStore.formattedStorageTotal }}\r\n            ({{ dashboardStore.storageUsagePercentage }}%)\r\n          </p>\r\n        </Card>\r\n      </div>\r\n\r\n      <!-- Main Content Grid -->\r\n      <div class=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n        <!-- Left Column: Recent Assets & Activity Feed -->\r\n        <div class=\"lg:col-span-2 space-y-6\">\r\n          <!-- Recent Assets -->\r\n          <Card class=\"p-6\">\r\n            <div class=\"flex items-center justify-between mb-4\">\r\n              <h2 class=\"text-xl font-semibold text-neutral-900 dark:text-neutral-900\">\r\n                Недавние активы\r\n              </h2>\r\n              <router-link\r\n                to=\"/dam/gallery\"\r\n                class=\"text-sm text-primary-500 hover:text-primary-600 transition-colors min-h-[44px] flex items-center\"\r\n                aria-label=\"Перейти к галерее активов\"\r\n              >\r\n                Смотреть все →\r\n              </router-link>\r\n            </div>\r\n            <div v-if=\"recentAssets.length === 0\" class=\"text-center py-8\">\r\n              <p class=\"text-neutral-600 dark:text-neutral-600\">\r\n                Нет недавних активов\r\n              </p>\r\n            </div>\r\n            <div\r\n              v-else\r\n              class=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4\"\r\n              role=\"grid\"\r\n              aria-label=\"Недавние активы\"\r\n            >\r\n              <div\r\n                v-for=\"asset in recentAssets\"\r\n                :key=\"asset.id\"\r\n                class=\"cursor-pointer\"\r\n                @click=\"goToAsset(asset.id)\"\r\n                @keydown.enter=\"goToAsset(asset.id)\"\r\n                role=\"gridcell\"\r\n                tabindex=\"0\"\r\n                :aria-label=\"`Актив: ${asset.label}`\"\r\n              >\r\n                <div class=\"relative aspect-square bg-neutral-100 dark:bg-neutral-100 rounded-lg overflow-hidden mb-2\">\r\n                  <img\r\n                    v-if=\"asset.thumbnail_url\"\r\n                    :src=\"asset.thumbnail_url\"\r\n                    :alt=\"asset.label\"\r\n                    class=\"w-full h-full object-cover\"\r\n                    loading=\"lazy\"\r\n                  />\r\n                  <div\r\n                    v-else\r\n                    class=\"w-full h-full flex items-center justify-center\"\r\n                  >\r\n                    <svg\r\n                      class=\"w-12 h-12 text-neutral-400\"\r\n                      fill=\"none\"\r\n                      stroke=\"currentColor\"\r\n                      viewBox=\"0 0 24 24\"\r\n                      aria-hidden=\"true\"\r\n                    >\r\n                      <path\r\n                        stroke-linecap=\"round\"\r\n                        stroke-linejoin=\"round\"\r\n                        stroke-width=\"2\"\r\n                        d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"\r\n                      />\r\n                    </svg>\r\n                  </div>\r\n                </div>\r\n                <p class=\"text-sm font-medium text-neutral-900 dark:text-neutral-900 truncate\">\r\n                  {{ asset.label }}\r\n                </p>\r\n                <p class=\"text-xs text-neutral-600 dark:text-neutral-600\">\r\n                  {{ formatDate(asset.date_added) }}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </Card>\r\n\r\n          <!-- Activity Feed -->\r\n          <Card class=\"p-6\">\r\n            <h2 class=\"text-xl font-semibold text-neutral-900 dark:text-neutral-900 mb-4\">\r\n              Активность\r\n            </h2>\r\n            <div v-if=\"dashboardStore.activityFeed.length === 0\" class=\"text-center py-8\">\r\n              <p class=\"text-neutral-600 dark:text-neutral-600\">\r\n                Нет недавней активности\r\n              </p>\r\n            </div>\r\n            <div\r\n              v-else\r\n              class=\"space-y-4\"\r\n              role=\"list\"\r\n              aria-label=\"Лента активности\"\r\n            >\r\n              <div\r\n                v-for=\"activity in dashboardStore.activityFeed\"\r\n                :key=\"activity.id\"\r\n                class=\"flex items-start gap-4 p-3 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-100 transition-colors\"\r\n                role=\"listitem\"\r\n              >\r\n                <div class=\"flex-shrink-0 w-10 h-10 rounded-full bg-primary-100 dark:bg-primary-100 flex items-center justify-center\">\r\n                  <svg\r\n                    class=\"w-5 h-5 text-primary-500\"\r\n                    fill=\"none\"\r\n                    stroke=\"currentColor\"\r\n                    viewBox=\"0 0 24 24\"\r\n                    aria-hidden=\"true\"\r\n                  >\r\n                    <path\r\n                      stroke-linecap=\"round\"\r\n                      stroke-linejoin=\"round\"\r\n                      stroke-width=\"2\"\r\n                      :d=\"getActivityIcon(activity.type)\"\r\n                    />\r\n                  </svg>\r\n                </div>\r\n                <div class=\"flex-1 min-w-0\">\r\n                  <p class=\"text-sm text-neutral-900 dark:text-neutral-900\">\r\n                    <span class=\"font-medium\">{{ activity.user }}</span>\r\n                    {{ activity.description }}\r\n                    <span\r\n                      v-if=\"activity.asset_label\"\r\n                      class=\"font-medium\"\r\n                    >\r\n                      {{ activity.asset_label }}\r\n                    </span>\r\n                  </p>\r\n                  <p class=\"text-xs text-neutral-600 dark:text-neutral-600 mt-1\">\r\n                    {{ formatRelativeTime(activity.timestamp) }}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </Card>\r\n        </div>\r\n\r\n        <!-- Right Column: Storage Metrics & Quick Actions -->\r\n        <div class=\"space-y-6\">\r\n          <!-- Storage Metrics -->\r\n          <Card class=\"p-6\" v-if=\"dashboardStore.storageMetrics\">\r\n            <h2 class=\"text-xl font-semibold text-neutral-900 dark:text-neutral-900 mb-4\">\r\n              Хранилище\r\n            </h2>\r\n            <div class=\"mb-4\">\r\n              <div class=\"flex items-center justify-between mb-2\">\r\n                <span class=\"text-sm text-neutral-600 dark:text-neutral-600\">\r\n                  Использовано\r\n                </span>\r\n                <span class=\"text-sm font-medium text-neutral-900 dark:text-neutral-900\">\r\n                  {{ dashboardStore.storageUsagePercentage }}%\r\n                </span>\r\n              </div>\r\n              <div class=\"w-full bg-neutral-200 dark:bg-neutral-200 rounded-full h-2\">\r\n                <div\r\n                  class=\"bg-primary-500 h-2 rounded-full transition-all duration-300\"\r\n                  :style=\"{ width: `${dashboardStore.storageUsagePercentage}%` }\"\r\n                  role=\"progressbar\"\r\n                  :aria-valuenow=\"dashboardStore.storageUsagePercentage\"\r\n                  aria-valuemin=\"0\"\r\n                  aria-valuemax=\"100\"\r\n                  :aria-label=\"`Использовано ${dashboardStore.storageUsagePercentage}% хранилища`\"\r\n                ></div>\r\n              </div>\r\n              <div class=\"mt-4 space-y-2\">\r\n                <div class=\"flex justify-between text-sm\">\r\n                  <span class=\"text-neutral-600 dark:text-neutral-600\">Использовано:</span>\r\n                  <span class=\"font-medium text-neutral-900 dark:text-neutral-900\">\r\n                    {{ dashboardStore.formattedStorageUsed }}\r\n                  </span>\r\n                </div>\r\n                <div class=\"flex justify-between text-sm\">\r\n                  <span class=\"text-neutral-600 dark:text-neutral-600\">Всего:</span>\r\n                  <span class=\"font-medium text-neutral-900 dark:text-neutral-900\">\r\n                    {{ dashboardStore.formattedStorageTotal }}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </Card>\r\n\r\n          <!-- Quick Actions -->\r\n          <Card class=\"p-6\">\r\n            <h2 class=\"text-xl font-semibold text-neutral-900 dark:text-neutral-900 mb-4\">\r\n              Быстрые действия\r\n            </h2>\r\n            <div class=\"space-y-2\">\r\n              <router-link\r\n                to=\"/dam/gallery\"\r\n                class=\"block w-full px-4 py-3 bg-primary-500 text-white rounded-md hover:bg-primary-600 transition-colors text-center font-medium min-h-[44px] flex items-center justify-center\"\r\n                aria-label=\"Перейти к галерее активов\"\r\n              >\r\n                Просмотреть активы\r\n              </router-link>\r\n              <button\r\n                class=\"w-full px-4 py-3 bg-neutral-100 dark:bg-neutral-100 text-neutral-900 dark:text-neutral-900 rounded-md hover:bg-neutral-200 dark:hover:bg-neutral-200 transition-colors font-medium min-h-[44px]\"\r\n                @click=\"handleUpload\"\r\n                type=\"button\"\r\n                aria-label=\"Загрузить новый актив\"\r\n              >\r\n                Загрузить актив\r\n              </button>\r\n              <router-link\r\n                to=\"/distribution\"\r\n                class=\"block w-full px-4 py-3 bg-neutral-100 dark:bg-neutral-100 text-neutral-900 dark:text-neutral-900 rounded-md hover:bg-neutral-200 dark:hover:bg-neutral-200 transition-colors text-center font-medium min-h-[44px] flex items-center justify-center\"\r\n                aria-label=\"Перейти к публикациям\"\r\n              >\r\n                Управление публикациями\r\n              </router-link>\r\n            </div>\r\n          </Card>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { onMounted, computed } from 'vue'\r\nimport { useRouter } from 'vue-router'\r\nimport { useDashboardStore } from '@/stores/dashboardStore'\r\nimport { useAssetStore } from '@/stores/assetStore'\r\nimport { useAuthStore } from '@/stores/authStore'\r\nimport Card from '@/components/Common/Card.vue'\r\nimport type { Asset } from '@/types/api'\r\nimport { formatDate, formatRelativeTime } from '@/utils/formatters'\r\n\r\nconst router = useRouter()\r\nconst dashboardStore = useDashboardStore()\r\nconst assetStore = useAssetStore()\r\nconst authStore = useAuthStore()\r\n\r\nconst userName = computed(() => {\r\n  return authStore.user?.first_name || authStore.user?.username || 'Пользователь'\r\n})\r\n\r\nconst recentAssets = computed<Asset[]>(() => {\r\n  // Get recent assets from assetStore (first 8)\r\n  return assetStore.assets.slice(0, 8)\r\n})\r\n\r\nfunction goToAsset(assetId: number) {\r\n  router.push(`/dam/assets/${assetId}`)\r\n}\r\n\r\nfunction handleUpload() {\r\n  // Emit event to open upload modal (handled by parent layout)\r\n  // For now, navigate to gallery\r\n  router.push('/dam/gallery')\r\n}\r\n\r\n// formatRelativeTime is imported from utils/formatters\r\n\r\nfunction getActivityIcon(type: string): string {\r\n  const icons: Record<string, string> = {\r\n    upload: 'M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12',\r\n    download: 'M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4',\r\n    share: 'M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.552 3.546a2 2 0 002.938-2.187l.546-2.59A4.998 4.998 0 0017 12c0-.482-.114-.938-.316-1.342m0 2.684L12.448 8.454a2 2 0 00-2.938-2.187l-.546 2.59A4.998 4.998 0 007 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684',\r\n    comment: 'M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z',\r\n    tag: 'M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z',\r\n    delete: 'M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16'\r\n  }\r\n  return icons[type] || icons.upload\r\n}\r\n\r\nonMounted(async () => {\r\n  // Load dashboard data\r\n  await dashboardStore.refresh()\r\n  \r\n  // Load recent assets if not loaded\r\n  if (assetStore.assets.length === 0) {\r\n    await assetStore.fetchAssets({ page_size: 8 })\r\n  }\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.dashboard-page {\r\n  padding-top: calc(var(--header-height, 64px) + 1rem);\r\n}\r\n</style>\r\n\r\n"],"names":["dashboardService","getDashboardStats","__async","this","apiService","get","getActivityFeed","limit","params","e","getStorageMetrics","catch","total_size","used_size","available_size","usage_percentage","by_type","useDashboardStore","defineStore","stats","ref","activityFeed","storageMetrics","isLoading","error","lastUpdated","hasRecentActivity","computed","value","length","storageUsagePercentage","formattedStorageUsed","formatBytes","formattedStorageTotal","fetchDashboardStats","data","Date","err","formatApiError","fetchActivityFeed","fetchStorageMetrics","bytes","i","Math","floor","log","round","pow","refresh","Promise","all","persist","router","useRouter","dashboardStore","assetStore","useAssetStore","authStore","useAuthStore","userName","_a","user","first_name","_b","username","recentAssets","assets","slice","goToAsset","assetId","push","handleUpload","getActivityIcon","type","icons","upload","download","share","comment","tag","delete","onMounted","fetchAssets","page_size","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_toDisplayString","_cache","class","_unref","_hoisted_5","_Fragment","_renderList","key","_hoisted_6","_hoisted_7","onClick","$event","_hoisted_8","_createVNode","Card","fill","stroke","viewBox","d","_hoisted_9","documents","total","toLocaleString","_hoisted_10","with_analysis","_hoisted_11","analyses","completed","_hoisted_12","processing","_hoisted_13","pending","_hoisted_14","failed","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_component_router_link","to","_hoisted_20","_hoisted_21","asset","id","onKeydown","_withKeys","role","tabindex","label","_hoisted_23","thumbnail_url","src","alt","loading","_hoisted_25","_hoisted_26","_hoisted_27","date_added","_hoisted_28","_hoisted_29","activity","_hoisted_30","_hoisted_31","_hoisted_33","_hoisted_34","_hoisted_35","_createTextVNode","description","asset_label","_hoisted_36","_hoisted_37","timestamp","_hoisted_38","_createBlock","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","style","_normalizeStyle","width","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_49"],"mappings":"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"}
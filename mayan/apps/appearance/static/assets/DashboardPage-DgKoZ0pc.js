var t=(t,e,a)=>new Promise((l,r)=>{var s=t=>{try{i(a.next(t))}catch(e){r(e)}},n=t=>{try{i(a.throw(t))}catch(e){r(e)}},i=t=>t.done?l(t.value):Promise.resolve(t.value).then(s,n);i((a=a.apply(t,e)).next())});import{d as e,r as a,c as l,b as r,k as s,e as n,i,f as o,t as u,u as d,F as c,h as m,l as x,s as g,z as h,A as p,C as f,G as v,x as b,j as k,p as y}from"./vue-vendor-FOQ7SlVG.js";import{a as w,f as M,u as _,_ as j,b as S,c as z,d as B}from"./index-Bkz-5-QE.js";import{u as A}from"./assetStore-B6Z4Z7K7.js";import"./utils-vendor-C6ZCcsv1.js";const C=new class{getDashboardStats(){return t(this,null,function*(){return w.get("/v4/dam/dashboard-stats/",void 0,!0)})}getActivityFeed(e=20){return t(this,null,function*(){try{return yield w.get("/v4/dam/activity/",{params:{limit:e}},!1)}catch(t){return[]}})}getStorageMetrics(){return t(this,null,function*(){return w.get("/v4/dam/storage-metrics/",void 0,!0).catch(()=>({total_size:0,used_size:0,available_size:0,usage_percentage:0,by_type:[]}))})}},L=e("dashboard",()=>{const e=a(null),r=a([]),s=a(null),n=a(!1),i=a(null),o=a(null),u=l(()=>r.value.length>0),d=l(()=>s.value?s.value.usage_percentage:0),c=l(()=>s.value?p(s.value.used_size):"0 B"),m=l(()=>s.value?p(s.value.total_size):"0 B");function x(){return t(this,null,function*(){n.value=!0,i.value=null;try{const t=yield C.getDashboardStats();e.value=t,o.value=new Date}catch(t){throw i.value=M(t),t}finally{n.value=!1}})}function g(e=20){return t(this,null,function*(){try{const t=yield C.getActivityFeed(e);r.value=t}catch(t){r.value=[]}})}function h(){return t(this,null,function*(){try{const t=yield C.getStorageMetrics();s.value=t}catch(t){s.value=null}})}function p(t){if(0===t)return"0 B";const e=Math.floor(Math.log(t)/Math.log(1024));return`${Math.round(t/Math.pow(1024,e)*100)/100} ${["B","KB","MB","GB","TB"][e]}`}return{stats:e,activityFeed:r,storageMetrics:s,isLoading:n,error:i,lastUpdated:o,hasRecentActivity:u,storageUsagePercentage:d,formattedStorageUsed:c,formattedStorageTotal:m,fetchDashboardStats:x,fetchActivityFeed:g,fetchStorageMetrics:h,refresh:function(){return t(this,null,function*(){yield Promise.all([x(),g(),h()])})}}},{persist:!1}),P={class:"dashboard-page min-h-screen bg-neutral-50 dark:bg-neutral-50"},U={class:"container mx-auto px-4 py-8"},F={class:"mb-8"},V={class:"text-3xl font-bold text-neutral-900 dark:text-neutral-900 mb-2"},D={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8"},$={key:1,class:"mb-8 p-4 bg-error/10 border border-error rounded-lg"},T={class:"text-error"},H={key:2,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",role:"region","aria-label":"Статистика системы"},K={class:"text-3xl font-bold text-neutral-900 dark:text-neutral-900"},G={class:"text-sm text-neutral-600 dark:text-neutral-600 mt-2"},I={class:"text-3xl font-bold text-neutral-900 dark:text-neutral-900"},q={class:"text-sm text-neutral-600 dark:text-neutral-600 mt-2"},R={class:"text-3xl font-bold text-neutral-900 dark:text-neutral-900"},E={class:"text-sm text-neutral-600 dark:text-neutral-600 mt-2"},J={class:"text-3xl font-bold text-neutral-900 dark:text-neutral-900"},N={class:"text-sm text-neutral-600 dark:text-neutral-600 mt-2"},O={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Q={class:"lg:col-span-2 space-y-6"},W={class:"flex items-center justify-between mb-4"},X={key:0,class:"text-center py-8"},Y={key:1,class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",role:"grid","aria-label":"Недавние активы"},Z=["onClick","onKeydown","aria-label"],tt={class:"relative aspect-square bg-neutral-100 dark:bg-neutral-100 rounded-lg overflow-hidden mb-2"},et=["src","alt"],at={key:1,class:"w-full h-full flex items-center justify-center"},lt={class:"text-sm font-medium text-neutral-900 dark:text-neutral-900 truncate"},rt={class:"text-xs text-neutral-600 dark:text-neutral-600"},st={key:0,class:"text-center py-8"},nt={key:1,class:"space-y-4",role:"list","aria-label":"Лента активности"},it={class:"flex-shrink-0 w-10 h-10 rounded-full bg-primary-100 dark:bg-primary-100 flex items-center justify-center"},ot={class:"w-5 h-5 text-primary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},ut=["d"],dt={class:"flex-1 min-w-0"},ct={class:"text-sm text-neutral-900 dark:text-neutral-900"},mt={class:"font-medium"},xt={key:0,class:"font-medium"},gt={class:"text-xs text-neutral-600 dark:text-neutral-600 mt-1"},ht={class:"space-y-6"},pt={class:"mb-4"},ft={class:"flex items-center justify-between mb-2"},vt={class:"text-sm font-medium text-neutral-900 dark:text-neutral-900"},bt={class:"w-full bg-neutral-200 dark:bg-neutral-200 rounded-full h-2"},kt=["aria-valuenow","aria-label"],yt={class:"mt-4 space-y-2"},wt={class:"flex justify-between text-sm"},Mt={class:"font-medium text-neutral-900 dark:text-neutral-900"},_t={class:"flex justify-between text-sm"},jt={class:"font-medium text-neutral-900 dark:text-neutral-900"},St={class:"space-y-2"},zt=B(r({__name:"DashboardPage",setup(e){const a=b(),r=L(),w=A(),M=_(),B=l(()=>{var t,e;return(null==(t=M.user)?void 0:t.first_name)||(null==(e=M.user)?void 0:e.username)||"Пользователь"}),C=l(()=>w.assets.slice(0,8));function zt(t){a.push(`/dam/assets/${t}`)}function Bt(){a.push("/dam/gallery")}function At(t){const e={upload:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12",download:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4",share:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.552 3.546a2 2 0 002.938-2.187l.546-2.59A4.998 4.998 0 0017 12c0-.482-.114-.938-.316-1.342m0 2.684L12.448 8.454a2 2 0 00-2.938-2.187l-.546 2.59A4.998 4.998 0 007 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684",comment:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z",tag:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z",delete:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"};return e[t]||e.upload}return s(()=>t(this,null,function*(){yield r.refresh(),0===w.assets.length&&(yield w.fetchAssets({page_size:8}))})),(t,e)=>{const a=h("router-link");return k(),n("div",P,[i("div",U,[i("div",F,[i("h1",V," Добро пожаловать, "+u(B.value)+"! ",1),e[1]||(e[1]=i("p",{class:"text-neutral-600 dark:text-neutral-600"}," Обзор вашей DAM системы ",-1))]),d(r).isLoading&&!d(r).stats?(k(),n("div",D,[(k(),n(c,null,m(4,t=>i("div",{key:t,class:"bg-neutral-100 dark:bg-neutral-100 rounded-lg p-6 animate-pulse"},[...e[2]||(e[2]=[i("div",{class:"h-4 bg-neutral-300 dark:bg-neutral-300 rounded w-1/2 mb-4"},null,-1),i("div",{class:"h-8 bg-neutral-300 dark:bg-neutral-300 rounded w-3/4"},null,-1)])])),64))])):d(r).error&&!d(r).stats?(k(),n("div",$,[i("p",T,u(d(r).error),1),i("button",{class:"mt-4 px-4 py-2 bg-primary-500 text-white rounded-md hover:bg-primary-600 transition-colors min-h-[44px]",onClick:e[0]||(e[0]=t=>d(r).refresh()),type:"button","aria-label":"Повторить загрузку"}," Попробовать снова ")])):o("",!0),d(r).stats?(k(),n("div",H,[x(j,{class:"p-6"},{default:g(()=>[e[3]||(e[3]=i("div",{class:"flex items-center justify-between mb-4"},[i("h3",{class:"text-sm font-medium text-neutral-600 dark:text-neutral-600"}," Всего документов "),i("svg",{class:"w-8 h-8 text-primary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),i("p",K,u(d(r).stats.documents.total.toLocaleString()),1),i("p",G,u(d(r).stats.documents.with_analysis)+" с AI анализом ",1)]),_:1}),x(j,{class:"p-6"},{default:g(()=>[e[4]||(e[4]=i("div",{class:"flex items-center justify-between mb-4"},[i("h3",{class:"text-sm font-medium text-neutral-600 dark:text-neutral-600"}," Завершенных анализов "),i("svg",{class:"w-8 h-8 text-success",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),i("p",I,u(d(r).stats.analyses.completed.toLocaleString()),1),i("p",q,u(d(r).stats.analyses.processing)+" в обработке ",1)]),_:1}),x(j,{class:"p-6"},{default:g(()=>[e[5]||(e[5]=i("div",{class:"flex items-center justify-between mb-4"},[i("h3",{class:"text-sm font-medium text-neutral-600 dark:text-neutral-600"}," Ожидающих анализа "),i("svg",{class:"w-8 h-8 text-warning",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),i("p",R,u(d(r).stats.analyses.pending.toLocaleString()),1),i("p",E,u(d(r).stats.analyses.failed)+" ошибок ",1)]),_:1}),x(j,{class:"p-6"},{default:g(()=>[e[6]||(e[6]=i("div",{class:"flex items-center justify-between mb-4"},[i("h3",{class:"text-sm font-medium text-neutral-600 dark:text-neutral-600"}," Использовано хранилища "),i("svg",{class:"w-8 h-8 text-primary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"})])],-1)),i("p",J,u(d(r).formattedStorageUsed),1),i("p",N," из "+u(d(r).formattedStorageTotal)+" ("+u(d(r).storageUsagePercentage)+"%) ",1)]),_:1})])):o("",!0),i("div",O,[i("div",Q,[x(j,{class:"p-6"},{default:g(()=>[i("div",W,[e[8]||(e[8]=i("h2",{class:"text-xl font-semibold text-neutral-900 dark:text-neutral-900"}," Недавние активы ",-1)),x(a,{to:"/dam/gallery",class:"text-sm text-primary-500 hover:text-primary-600 transition-colors min-h-[44px] flex items-center","aria-label":"Перейти к галерее активов"},{default:g(()=>[...e[7]||(e[7]=[p(" Смотреть все → ",-1)])]),_:1})]),0===C.value.length?(k(),n("div",X,[...e[9]||(e[9]=[i("p",{class:"text-neutral-600 dark:text-neutral-600"}," Нет недавних активов ",-1)])])):(k(),n("div",Y,[(k(!0),n(c,null,m(C.value,t=>(k(),n("div",{key:t.id,class:"cursor-pointer",onClick:e=>zt(t.id),onKeydown:y(e=>zt(t.id),["enter"]),role:"gridcell",tabindex:"0","aria-label":`Актив: ${t.label}`},[i("div",tt,[t.thumbnail_url?(k(),n("img",{key:0,src:t.thumbnail_url,alt:t.label,class:"w-full h-full object-cover",loading:"lazy"},null,8,et)):(k(),n("div",at,[...e[10]||(e[10]=[i("svg",{class:"w-12 h-12 text-neutral-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])]))]),i("p",lt,u(t.label),1),i("p",rt,u(d(S)(t.date_added)),1)],40,Z))),128))]))]),_:1}),x(j,{class:"p-6"},{default:g(()=>[e[12]||(e[12]=i("h2",{class:"text-xl font-semibold text-neutral-900 dark:text-neutral-900 mb-4"}," Активность ",-1)),0===d(r).activityFeed.length?(k(),n("div",st,[...e[11]||(e[11]=[i("p",{class:"text-neutral-600 dark:text-neutral-600"}," Нет недавней активности ",-1)])])):(k(),n("div",nt,[(k(!0),n(c,null,m(d(r).activityFeed,t=>(k(),n("div",{key:t.id,class:"flex items-start gap-4 p-3 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-100 transition-colors",role:"listitem"},[i("div",it,[(k(),n("svg",ot,[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:At(t.type)},null,8,ut)]))]),i("div",dt,[i("p",ct,[i("span",mt,u(t.user),1),p(" "+u(t.description)+" ",1),t.asset_label?(k(),n("span",xt,u(t.asset_label),1)):o("",!0)]),i("p",gt,u(d(z)(t.timestamp)),1)])]))),128))]))]),_:1})]),i("div",ht,[d(r).storageMetrics?(k(),f(j,{key:0,class:"p-6"},{default:g(()=>[e[16]||(e[16]=i("h2",{class:"text-xl font-semibold text-neutral-900 dark:text-neutral-900 mb-4"}," Хранилище ",-1)),i("div",pt,[i("div",ft,[e[13]||(e[13]=i("span",{class:"text-sm text-neutral-600 dark:text-neutral-600"}," Использовано ",-1)),i("span",vt,u(d(r).storageUsagePercentage)+"% ",1)]),i("div",bt,[i("div",{class:"bg-primary-500 h-2 rounded-full transition-all duration-300",style:v({width:`${d(r).storageUsagePercentage}%`}),role:"progressbar","aria-valuenow":d(r).storageUsagePercentage,"aria-valuemin":"0","aria-valuemax":"100","aria-label":`Использовано ${d(r).storageUsagePercentage}% хранилища`},null,12,kt)]),i("div",yt,[i("div",wt,[e[14]||(e[14]=i("span",{class:"text-neutral-600 dark:text-neutral-600"},"Использовано:",-1)),i("span",Mt,u(d(r).formattedStorageUsed),1)]),i("div",_t,[e[15]||(e[15]=i("span",{class:"text-neutral-600 dark:text-neutral-600"},"Всего:",-1)),i("span",jt,u(d(r).formattedStorageTotal),1)])])])]),_:1})):o("",!0),x(j,{class:"p-6"},{default:g(()=>[e[19]||(e[19]=i("h2",{class:"text-xl font-semibold text-neutral-900 dark:text-neutral-900 mb-4"}," Быстрые действия ",-1)),i("div",St,[x(a,{to:"/dam/gallery",class:"block w-full px-4 py-3 bg-primary-500 text-white rounded-md hover:bg-primary-600 transition-colors text-center font-medium min-h-[44px] flex items-center justify-center","aria-label":"Перейти к галерее активов"},{default:g(()=>[...e[17]||(e[17]=[p(" Просмотреть активы ",-1)])]),_:1}),i("button",{class:"w-full px-4 py-3 bg-neutral-100 dark:bg-neutral-100 text-neutral-900 dark:text-neutral-900 rounded-md hover:bg-neutral-200 dark:hover:bg-neutral-200 transition-colors font-medium min-h-[44px]",onClick:Bt,type:"button","aria-label":"Загрузить новый актив"}," Загрузить актив "),x(a,{to:"/distribution",class:"block w-full px-4 py-3 bg-neutral-100 dark:bg-neutral-100 text-neutral-900 dark:text-neutral-900 rounded-md hover:bg-neutral-200 dark:hover:bg-neutral-200 transition-colors text-center font-medium min-h-[44px] flex items-center justify-center","aria-label":"Перейти к публикациям"},{default:g(()=>[...e[18]||(e[18]=[p(" Управление публикациями ",-1)])]),_:1})])]),_:1})])])])])}}}),[["__scopeId","data-v-b41bbc25"]]);export{zt as default};
//# sourceMappingURL=DashboardPage-DgKoZ0pc.js.map

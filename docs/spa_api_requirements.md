# Требования к новому SPA и соответствие REST API

Документ фиксирует ключевые пользовательские сценарии будущего фронтенда и доступные/нехватающие REST‑операции Mayan EDMS. Используем его как чек‑лист при расширении `docs/api_surface.md` и дальнейшей реализации API.

## 1. Документы и файлы

| Сценарий | Текущий API | Примечания |
| --- | --- | --- |
| Создать документ и загрузить файл | `POST /api/v4/documents/documents/` (+ `sources` upload) | Работает, но UI зависит от wizard’ов источников. SPA нужен универсальный upload endpoint (включая drag&drop) + получение списка источников. |
| Получить список документов/фильтры | `GET /api/v4/documents/documents/` (фильтры query) | Имеется, но надо документировать параметры поиска/ordering. |
| Просмотр/скачивание файлов, страниц | `GET /api/v4/documents/document_files/`, `/api/v4/documents/document_file_pages/` | Нужно подтвердить наличие signed URLs для превью. |
| Массовые действия (trash, restore, delete) | `POST /api/v4/documents/trashed_documents/<id>/restore/` etc. | REST есть, но нет bulk‑endpoint — требуется. |

## 2. Типы документов, метаданные и поля

| Сценарий | Текущий API | Пробелы |
| --- | --- | --- |
| Управление типами документов | `GET/POST /api/v4/documents/document_types/` | CRUD покрыт. |
| Управление схемами метаданных | `GET/POST /api/v4/metadata/metadata_types/` | Есть, но документация отсутствует. |
| Назначение метаданных документу | `POST /api/v4/metadata/document_types/<id>/metadata_types/add/` | Нет простого bulk‑апдейта → требуется новый endpoint. |

## 3. Теги, кабинеты, избранное

| Сценарий | Текущий API | Пробелы |
| --- | --- | --- |
| CRUD тегов | `GET/POST /api/v4/tags/tags/` | Нужно описать связи документ↔тег. |
| Добавить документы в кабинет | `/api/v4/cabinets/cabinets/<id>/documents/` | REST существует, но нет фильтров поиска кабинетов. |
| Workspaces/избранное | `/api/v4/documents/favorites/` | Требуется пагинация и поиск. |

## 4. Поиск и динамические индексы

| Сценарий | Текущий API | Пробелы |
| --- | --- | --- |
| Фултекст поиск | `/api/v4/dynamic_search/search/` | Нужно описать синтаксис, дать примеры. |
| Навигация по индексам | `/api/v4/indexes/index_templates/` | Нет REST для экспорта дерева индексов → нужно добавить. |

## 5. Пользователи, группы, ACL

| Сценарий | Текущий API | Пробелы |
| --- | --- | --- |
| CRUD пользователей | `/api/v4/user_management/users/` | Не документировано в `api_surface`. |
| Управление ролями/ACL | `/api/v4/acls/access_controls/` и related | Требуется удобный способ получить effective permissions документа. |
| Управление API‑токенами | Только `/authentication/tokens/` HTML | Нет REST → добавить `api/v4/auth/tokens/`. |

## 6. Smart Settings и конфигурация

| Сценарий | Текущий API | Пробелы |
| --- | --- | --- |
| Чтение/обновление настроек | нет удобного REST | Нужно предоставить read/write endpoint с валидацией и аудитом. |
| Просмотр очередей/рабочих процессов | отсутствует | Возможен read‑only endpoint `system/queues/`. |

## 7. Логи, задания, уведомления

| Сценарий | Текущий API | Пробелы |
| --- | --- | --- |
| Просмотр фоновых задач (Celery) | `api/v4/task_manager/tasks/` (встроено) | Нужно описать, проверить фильтры. |
| Аудит‑лог | `/api/v4/events/events/` | Требуются фильтры по документу/пользователю. |
| Уведомления | отсутствует | Требуется новый endpoint (либо интеграция с events). |

## 8. Публикации/Distribution и DAM

Уже задокументировано в `docs/api_surface.md` (см. существующие разделы). Никаких новых требований на этом шаге.

---

Следующие шаги:

1. На основе таблиц выше обновить `docs/api_surface.md`, добавив разделы «Документы», «Метаданные», «Пользователи» и т.д. (Шаг 3 плана).
2. Для строк «Пробелы» подготовить мини‑спеки (URI, метод, payload, ACL) и зафиксировать в новой секции «Новые эндпоинты» (Шаг 4).
3. Реализовать приоритетные из них (например, bulk‑метаданные, Smart Settings REST, API tokens) и покрыть тестами (Шаг 5).


# ARCHITECTURE STATUS REPORT ‚Äî Prime-EDMS (08.12.2025)

**–¶–µ–ª—å:** –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –¥—Ä–µ–π—Ñ. –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π.  
**–û–±–ª–∞—Å—Ç—å:** Backend (Django/Mayan), Frontend (Vue 3), Headless API —Å–ª–æ–π, Image Editor.  
**–ê–≤—Ç–æ—Ä:** Lead Software Architect

---

## 1) –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –∫–æ–¥–æ–º)

- **Headless API –ø–æ–¥–∫–ª—é—á–µ–Ω –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ `/api/v4/headless/`**:
  - password/change, config/document_types (list/detail), activity/feed, dashboard/activity, favorites (list/toggle), documents/my_uploads, documents/{id}/versions/new_from_edit.
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã** (`OptimizedDocumentListSerializer`, `OptimizedDocumentSerializer`) –≤–∫–ª—é—á–∞—é—Ç `document_type_id` (write_only –≤ detail), file_latest, preview/thumbnail, ai_analysis.
- **Token + Session auth** –∞–∫—Ç–∏–≤–Ω—ã; interceptor –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ –¥–æ–±–∞–≤–ª—è–µ—Ç `Authorization: Token ...` –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç 401/403/404 (headless).
- **Image Editor**: MediaEditorModal –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π `blob:` URL + `crossOrigin='anonymous'`, —Ä–∏—Å—É–µ—Ç —Ç–æ–ª—å–∫–æ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ blob ‚Üí –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â—ë–Ω **tainted canvas**.
- **Editor save**: `POST /api/v4/headless/documents/{id}/versions/new_from_edit/` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —á–µ—Ä–µ–∑ Pillow, file_new).
- **Admin/Docs list**: —Ñ—Ä–æ–Ω—Ç –∏ –±—ç–∫–µ–Ω–¥ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ REST `/api/v4/documents/optimized/`, `/api/v4/users/`, `/api/v4/groups/` –∏ —Ç.–¥.

---

## 2) –ß—Ç–æ —Å–ª–æ–º–∞–Ω–æ –∏–ª–∏ —É—Å—Ç–∞—Ä–µ–ª–æ

| –û–±–ª–∞—Å—Ç—å | –°–∏–º–ø—Ç–æ–º | –ü—Ä–∏—á–∏–Ω–∞ | –°—Ç–∞—Ç—É—Å |
|---------|---------|---------|--------|
| –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è (SPA) | –ù–µ—Ç –≤—ã–∑–æ–≤–∞ –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–º BFF | `authService.changePassword` —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `VITE_BFF_ENABLED=true`; UI –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ñ—Ñ–ª–∞–π–Ω | ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –°–ë–û–ô |
| Activity Feed (–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è) | –ù–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–π –ª–µ–Ω—Ç—ã | –í —Å–µ—Ä–≤–∏—Å–µ –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ dashboard `/headless/dashboard/activity/`; `/headless/activity/feed/` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –°–ë–û–ô |
| –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ñ–æ—Ä–º—ã –∑–∞–≥—Ä—É–∑–∫–∏ | –í–æ–∑–º–æ–∂–Ω—ã 400 –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑-–∑–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö metadata | `documentTypeService` –≤–∫–ª—é—á–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ BFF; –±–µ–∑ –Ω–µ–≥–æ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è | üî¥ –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ |
| ACL –Ω–∞ –∫–Ω–æ–ø–∫—É ¬´–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å¬ª | 403 –≤–æ–∑–º–æ–∂–µ–Ω –≤ —Ä–∞–Ω—Ç–∞–π–º–µ | –ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ mime-type –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ | üü° –°—Ä–µ–¥–Ω–∏–π |
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è V4 | –ù–µ –æ—Ç—Ä–∞–∂–∞–µ—Ç –ø–æ—è–≤–ª–µ–Ω–∏–µ headless endpoints –∏ —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ—Ä–æ–Ω—Ç–∞ | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –¥—Ä–µ–π—Ñ | üî¥ –¢—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

---

## 3) Roadmap –±–ª–∏–∂–∞–π—à–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π (1‚Äì2 –Ω–µ–¥–µ–ª–∏)

1. **–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–∞ headless API:**
   - –í–∫–ª—é—á–∏—Ç—å `VITE_BFF_ENABLED=true` –Ω–∞ stage/prod, –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å `authService.changePassword`.
   - –î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å –¥–ª—è `/api/v4/headless/activity/feed/` (filter/pagination) –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ UI.
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `documentTypeService` –≤—Å–µ–≥–¥–∞ (–Ω–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ BFF) –∏–ª–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å BFF=on; –≤–∞–ª–∏–¥–∞—Ü–∏—è metadata –ø–µ—Ä–µ–¥ upload –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞.
2. **ACL/UX –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞:**
   - –ü–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º ¬´–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å¬ª –ø—Ä–æ–≤–µ—Ä—è—Ç—å –¥–æ—Å—Ç—É–ø (HEAD `/api/v4/documents/{id}/` –∏–ª–∏ —Ä–∞–Ω–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞ ACL); graceful 403.
3. **–¢–µ—Å—Ç—ã –∏ —Å–º–æ–∫–∏:**
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å `verify_api.sh` —Å TOKEN –∏ DOC_ID: `/users/current/`, `/documents/optimized/`, `/headless/documents/{id}/versions/new_from_edit/`.
   - E2E: —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å feed, –∑–∞–≥—Ä—É–∑–∫–∞ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏.
4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è V5 (—ç—Ç–æ—Ç –æ—Ç—á—ë—Ç + BACKEND/FRONTEND_ANALYSIS_V5):**
   - –ü–æ–º–µ—Ç–∏—Ç—å V4 —É—Å—Ç–∞—Ä–µ–≤—à–µ–π, –¥–µ—Ä–∂–∞—Ç—å V5 –≤ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏.

---

## 4) –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –±–∞–≥–∏ –∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

- **Tainted Canvas**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (MediaEditorModal —Ä–∏—Å—É–µ—Ç –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ blob, —Å—Ç–∞–≤–∏—Ç `crossOrigin='anonymous'`).
- **new_from_edit**: –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –∫–æ–Ω–≤–µ—Ä—Å–∏—é —Ñ–æ—Ä–º–∞—Ç–∞ (JPEG/PNG –∏ —Ç.–¥.); –ø—Ä–∏ –æ—à–∏–±–∫–µ Pillow –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `conversion_failed`.
- **Favorites/My Uploads**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –Ω–∞ –±—ç–∫–µ–Ω–¥–µ; —Ñ—Ä–æ–Ω—Ç –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ `/headless/favorites/`, `/headless/documents/my_uploads/`.

---

## 5) –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

- [ ] –í–∫–ª—é—á–∏—Ç—å BFF –∏ –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å headless password/change –≤ UI
- [ ] –î–æ–±–∞–≤–∏—Ç—å headless activity/feed –≤ —Å–µ—Ä–≤–∏—Å –∏ UI
- [ ] –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è metadata (documentTypeService) –ø–µ—Ä–µ–¥ upload
- [ ] Upload UI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥ —Ç–∏–ø–æ–≤ (required_metadata)
- [ ] E2E —Å–º–æ–∫–∏ –Ω–∞ headless endpoints –∑–µ–ª—ë–Ω—ã–µ
- [ ] V4 –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ–º–µ—á–µ–Ω—ã —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏, V5 ‚Äî —Ç–µ–∫—É—â–∏–µ

---

**–ò—Ç–æ–≥:** –ë—ç–∫–µ–Ω–¥ —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç headless —Å–ª–æ–π –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö self-service —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤. –î—Ä–µ–π—Ñ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏: –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã –Ω–∞ headless, –¥–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å ACL/UX –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ ‚Äî –ø—Ä–æ–≥–Ω–∞—Ç—å —Å–º–æ–∫–∏ `verify_api.sh` –∏ E2E.  

**–î–∞—Ç–∞:** 08 –¥–µ–∫–∞–±—Ä—è 2025  
**–ê–≤—Ç–æ—Ä:** Lead Software Architect


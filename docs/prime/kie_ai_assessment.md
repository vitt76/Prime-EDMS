# Оценка провайдера Kie.ai для OCR Prime EDMS

## Источники требований

- `docs/api_surface.md` — фиксирует ожидание единого AI-пайплайна DAM и хранение расшифровок в `DocumentAIAnalysis`.
- `docs/spa_api_requirements.md` — описывает сценарий извлечения текста и метаданных для SPA (универсальная загрузка, массовые операции, единые ACL).

Из этих документов следуют базовые критерии для нового провайдера:

1. **Форматы изображений** — не менее JPEG/PNG, желательно PDF превью.
2. **Локализация** — RU/EN (BCP-47) и перевод распознанного текста.
3. **SLA** — стабильное API (≥99% аптайма) и возможность фоновых ретраев Celery.
4. **Безопасность** — bearer-токен, отсутствие постоянного хранения контента у третьей стороны.
5. **Очереди/Callback’и** — желательно webhook или polling, чтобы вписаться в `DocumentAIAnalysis` без активного ожидания.

## Возможности из открытой документации Kie.ai

| Критерий | Что есть в требовании | Что заявлено Kie.ai | Риски / вопросы |
| --- | --- | --- | --- |
| Аптайм и масштаб | ≥99% и высокая параллельность | Официально заявлено 99.9% uptime, «High Concurrency», 24/7 support ([docs.kie.ai](https://docs.kie.ai/)) | Требуется подтверждение SLA в договоре |
| Модель тарификации | Предсказуемая стоимость | «Flexible point-based pricing» ([docs.kie.ai](https://docs.kie.ai/)) | Нужно проверить цены за OCR, т.к. в доках упор на генерацию |
| Поддержка OCR | Распознавание содержимого изображений | Публичные разделы документации перечисляют видео/аудио/изображения, но нет прямого OCR-эндпоинта ([docs.kie.ai](https://docs.kie.ai/)) | Высокий риск: требуется уточнить наличие vision-to-text / translation API |
| Загрузка файлов | Multipart, >10 МБ | Есть `POST /api/file-stream-upload` (Cloudflare R2) с `fileStream`, `uploadPath`, `fileName` и Bearer-ключом; ответ содержит `downloadUrl` ([kieai.redpandaai.co/api/file-stream-upload](https://kieai.redpandaai.co/api/file-stream-upload)) | Нужно хранилище R2 под нас + политика удаления временных файлов |
| Callbacks | Желательно webhook | Описанных callback’ов нет; основной сценарий — polling `downloadUrl` или синхронный ответ | Придётся строить синхронный вызов внутри Celery-задачи |
| Локализация | RU/EN + перевод | Документация подтверждает «Secure Integration» и общие AI API, но не перечисляет языковые возможности OCR | Нужен ответ саппорта по поддерживаемым языкам |

## Вывод

- **Подходит условно**: есть стабильная инфраструктура, авторизация по Bearer, отдельный upload API и заявленная 99.9% доступность.
- **Не хватает подтверждения OCR**: в публичных разделах нет явного vision-to-text эндпоинта. Для полноценной интеграции требуется:
  - получить техническую спецификацию OCR/translation метода (название endpoint, payload, структура ответа);
  - согласовать квоты и стоимость распознавания;
  - уточнить сроки удаления файлов из временного хранилища Cloudflare R2.
- **Риск**: без OCR-API Kie.ai сейчас может выступать только как прокси к сторонним моделям (например, Flux Kontext или GPT-4o для генеративных задач), что не закрывает сценарий «перевод изображения в текст» из Prime EDMS.

До получения этих уточнений интеграцию стоит держать за фичефлагом и предусмотреть graceful fallback к существующим провайдерам.

